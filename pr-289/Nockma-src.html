<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"><meta charset="UTF-8"><link href="https://anoma.github.io/nspec/pr-289/assets/css/juvix-catppuchin.css" rel="stylesheet" type="text/css"><link href="https://anoma.github.io/nspec/pr-289/assets/css/latte.css" rel="stylesheet" type="text/css"><link href="https://anoma.github.io/nspec/pr-289/assets/css/juvix-source.css" rel="stylesheet" type="text/css"><script src="https://anoma.github.io/nspec/pr-289/assets/js/highlight.js" type="text/javascript"></script><div id="package-header"><span class="caption"></span></div><pre id="src-content"><span class="ju-keyword">module</span> <span id="Nockma:0"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:0" class="ju-code-link ju-module"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:0" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">Nockma</span></span></a></span></a></span></span><span class="ju-delimiter">;</span>

<span class="ju-keyword">import</span> <span id="prelude:0"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:0" class="ju-code-link ju-module"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:0" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">prelude</span></span></a></span></a></span></span> <span class="ju-keyword">open</span><span class="ju-delimiter">;</span>
<span class="ju-keyword">import</span> <span id="Stdlib.Data.Nat:0"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Nat-src.html#Stdlib.Data.Nat:0" class="ju-code-link ju-module"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Nat-src.html#Stdlib.Data.Nat:0" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">Stdlib.Data.Nat</span></span></a></span></a></span></span> <span class="ju-keyword">open</span><span class="ju-delimiter">;</span>
<span class="ju-keyword">import</span> <span id="Stdlib.Data.List:0"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/List-src.html#Stdlib.Data.List:0" class="ju-code-link ju-module"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/List-src.html#Stdlib.Data.List:0" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">Stdlib.Data.List</span></span></a></span></a></span></span> <span class="ju-keyword">open</span><span class="ju-delimiter">;</span>
<span class="ju-keyword">import</span> <span id="arch.system.state.resource_machine.notes.function_formats.transactionfunction:0"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/arch/system/state/resource_machine/notes/function_formats/transactionfunction-src.html#arch.system.state.resource_machine.notes.function_formats.transactionfunction:0" class="ju-code-link ju-module"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/arch/system/state/resource_machine/notes/function_formats/transactionfunction-src.html#arch.system.state.resource_machine.notes.function_formats.transactionfunction:0" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">arch.system.state.resource_machine.notes.function_formats.transactionfunction</span></span></a></span></a></span></span> <span class="ju-keyword">open</span><span class="ju-delimiter">;</span>
<span class="ju-comment">-- Operation codes for Nockma:</span>
<span class="ju-comment">-- 0: Slash (/)</span>
<span class="ju-comment">-- 1: Constant: Returns operand unchanged</span>
<span class="ju-comment">-- 2: Apply/Ap/S:</span>
<span class="ju-comment">-- 3: Cell test (?): Tests if noun is cell</span>
<span class="ju-comment">-- 4: Increment (+): Add 1 to atom</span>
<span class="ju-comment">-- 5: Equality test (=): Compare nouns</span>
<span class="ju-comment">-- 6: If-then-else</span>
<span class="ju-comment">-- 7: Compose</span>
<span class="ju-comment">-- 8: Extend subject</span>
<span class="ju-comment">-- 9: Invoke (call function by arm name)</span>
<span class="ju-comment">-- 10: Pound (#)</span>
<span class="ju-comment">-- 11: Match: Case split on Cells vs Atoms</span>
<span class="ju-comment">-- 12: Scry (read storage)</span>

<span class="ju-comment">-- Basic Nock types</span>
<span class="ju-keyword">type</span> <span id="Nockma:1"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">|</span> <span id="Nockma:2"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor">Atom</span></a></span></a></span></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span> <span class="ju-keyword">-&gt;</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span>
  <span class="ju-keyword">|</span> <span id="Nockma:3"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span></a></span></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span> <span class="ju-keyword">-&gt;</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span> <span class="ju-keyword">-&gt;</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span><span class="ju-delimiter">;</span>

<span class="ju-keyword">terminating</span>
<span id="Nockma:5"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:5" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:5" class="ju-code-link ju-function"><span class="ju-function">nounEq</span></a></span></a></span></span> <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:28" class="ju-code-link ju-var"><span class="ju-var">n1</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:29" class="ju-code-link ju-var"><span class="ju-var">n2</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Bool</span></a></span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:7" class="ju-code-link ju-var"><span class="ju-constructor">mkPair</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:28" class="ju-code-link ju-var"><span class="ju-var">n1</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:29" class="ju-code-link ju-var"><span class="ju-var">n2</span></a></span> <span class="ju-keyword">of</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:7" class="ju-code-link ju-var"><span class="ju-constructor">mkPair</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span id="Nockma:30"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:30" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:30" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span id="Nockma:31"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:31" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:31" class="ju-code-link ju-var"><span class="ju-var">y</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:30" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Eq-src.html#Stdlib.Trait.Eq:7" class="ju-code-link ju-function"><span class="ju-function">==</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:31" class="ju-code-link ju-var"><span class="ju-var">y</span></a></span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:7" class="ju-code-link ju-var"><span class="ju-constructor">mkPair</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span id="Nockma:32"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:32" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:32" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span></a></span></span> <span id="Nockma:33"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:33" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:33" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span id="Nockma:34"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:34" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:34" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span></a></span></span> <span id="Nockma:35"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:35" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:35" class="ju-code-link ju-var"><span class="ju-var">d</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:5" class="ju-code-link ju-function"><span class="ju-function">nounEq</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:32" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:34" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Bool/Base-src.html#Stdlib.Data.Bool.Base:3" class="ju-code-link ju-function"><span class="ju-function">&amp;&amp;</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:5" class="ju-code-link ju-function"><span class="ju-function">nounEq</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:33" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:35" class="ju-code-link ju-var"><span class="ju-var">d</span></a></span>
    <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:3" class="ju-code-link ju-constructor"><span class="ju-constructor">false</span></a></span><span class="ju-delimiter">;</span>

<span class="ju-keyword">instance</span>
<span id="Nockma:37"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:37" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:37" class="ju-code-link ju-function"><span class="ju-function">EqNoun</span></a></span></a></span></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Eq-src.html#Stdlib.Trait.Eq:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Eq</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span> <span class="ju-keyword">:=</span>
  <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Eq-src.html#Stdlib.Trait.Eq:2" class="ju-code-link ju-constructor"><span class="ju-constructor">mkEq</span></a></span><span class="ju-keyword">@</span><span class="ju-delimiter">{</span>
    <span id="Nockma:36"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:36" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:36" class="ju-code-link ju-function"><span class="ju-function">eq</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:5" class="ju-code-link ju-function"><span class="ju-function">nounEq</span></a></span><span class="ju-delimiter">;</span>
  <span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>

<span class="ju-comment">-- Helper to convert storage values to Nouns</span>
<span class="ju-keyword">axiom</span> <span id="Nockma:6"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:6" class="ju-code-link ju-axiom"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:6" class="ju-code-link ju-axiom"><span class="ju-axiom">convertToNoun</span></a></span></a></span></span> <span class="ju-keyword">:</span> <span class="ju-delimiter">{</span><span id="Nockma:38"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:38" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:38" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span></a></span></span> <span class="ju-keyword">:</span> <span class="ju-keyword">Type</span><span class="ju-delimiter">}</span> <span class="ju-keyword">-&gt;</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:38" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span> <span class="ju-keyword">-&gt;</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span><span class="ju-delimiter">;</span>

<span class="ju-comment">-- Helper to convert Nouns to storage values</span>
<span class="ju-keyword">axiom</span> <span id="Nockma:7"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:7" class="ju-code-link ju-axiom"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:7" class="ju-code-link ju-axiom"><span class="ju-axiom">convertFromNoun</span></a></span></a></span></span> <span class="ju-keyword">:</span> <span class="ju-delimiter">{</span><span id="Nockma:39"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:39" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:39" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span></a></span></span> <span class="ju-keyword">:</span> <span class="ju-keyword">Type</span><span class="ju-delimiter">}</span> <span class="ju-keyword">-&gt;</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span> <span class="ju-keyword">-&gt;</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:24" class="ju-code-link ju-var"><span class="ju-inductive">Option</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:39" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span><span class="ju-delimiter">;</span>

<span class="ju-keyword">type</span> <span id="Nockma:8"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:8" class="ju-code-link ju-inductive"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:8" class="ju-code-link ju-inductive"><span class="ju-inductive">ScryOp</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">|</span> <span id="Nockma:9"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:9" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:9" class="ju-code-link ju-constructor"><span class="ju-constructor">Direct</span></a></span></a></span></span>
  <span class="ju-keyword">|</span> <span id="Nockma:10"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:10" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:10" class="ju-code-link ju-constructor"><span class="ju-constructor">Index</span></a></span></a></span></span><span class="ju-delimiter">;</span>

<span class="ju-keyword">type</span> <span id="Nockma:11"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:11" class="ju-code-link ju-inductive"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:11" class="ju-code-link ju-inductive"><span class="ju-inductive">Storage</span></a></span></a></span></span> <span id="Nockma:40"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:40" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:40" class="ju-code-link ju-var"><span class="ju-var">addr</span></a></span></a></span></span> <span id="Nockma:41"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:41" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:41" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
  <span id="Nockma:12"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:12" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:12" class="ju-code-link ju-constructor"><span class="ju-constructor">mkStorage</span></a></span></a></span></span><span class="ju-keyword">@</span><span class="ju-delimiter">{</span>
    <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:42" class="ju-code-link ju-var"><span class="ju-var">readDirect</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:40" class="ju-code-link ju-var"><span class="ju-var">addr</span></a></span> <span class="ju-keyword">-&gt;</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:24" class="ju-code-link ju-var"><span class="ju-inductive">Option</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:41" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span><span class="ju-delimiter">;</span>
    <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:43" class="ju-code-link ju-var"><span class="ju-var">readIndex</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:41" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span> <span class="ju-keyword">-&gt;</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:24" class="ju-code-link ju-var"><span class="ju-inductive">Option</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:41" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span><span class="ju-delimiter">;</span>
  <span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>

<span class="ju-keyword">axiom</span> <span id="Nockma:13"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:13" class="ju-code-link ju-axiom"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:13" class="ju-code-link ju-axiom"><span class="ju-axiom">externalStorage</span></a></span></a></span></span> <span class="ju-keyword">:</span> <span class="ju-delimiter">{</span><span id="Nockma:44"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:44" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:44" class="ju-code-link ju-var"><span class="ju-var">addr</span></a></span></a></span></span> <span id="Nockma:45"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:45" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:45" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span></a></span></span> <span class="ju-keyword">:</span> <span class="ju-keyword">Type</span><span class="ju-delimiter">}</span> <span class="ju-keyword">-&gt;</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:11" class="ju-code-link ju-inductive"><span class="ju-inductive">Storage</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:44" class="ju-code-link ju-var"><span class="ju-var">addr</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:45" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span><span class="ju-delimiter">;</span>

<span class="ju-keyword">type</span> <span id="Nockma:14"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:14" class="ju-code-link ju-inductive"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:14" class="ju-code-link ju-inductive"><span class="ju-inductive">NockOp</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">|</span> <span id="Nockma:15"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:15" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:15" class="ju-code-link ju-constructor"><span class="ju-constructor">Slash</span></a></span></a></span></span>
  <span class="ju-comment">-- /</span>
  <span class="ju-keyword">|</span> <span id="Nockma:16"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:16" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:16" class="ju-code-link ju-constructor"><span class="ju-constructor">Constant</span></a></span></a></span></span>
  <span class="ju-comment">-- Returns operand unchanged</span>
  <span class="ju-keyword">|</span> <span id="Nockma:17"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:17" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:17" class="ju-code-link ju-constructor"><span class="ju-constructor">Apply</span></a></span></a></span></span>
  <span class="ju-keyword">|</span> <span id="Nockma:18"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:18" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:18" class="ju-code-link ju-constructor"><span class="ju-constructor">CellTest</span></a></span></a></span></span>
  <span class="ju-comment">-- ?</span>
  <span class="ju-keyword">|</span> <span id="Nockma:19"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:19" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:19" class="ju-code-link ju-constructor"><span class="ju-constructor">Increment</span></a></span></a></span></span>
  <span class="ju-comment">-- +</span>
  <span class="ju-keyword">|</span> <span id="Nockma:20"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:20" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:20" class="ju-code-link ju-constructor"><span class="ju-constructor">EqualOp</span></a></span></a></span></span>
  <span class="ju-comment">-- =</span>
  <span class="ju-keyword">|</span> <span id="Nockma:21"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:21" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:21" class="ju-code-link ju-constructor"><span class="ju-constructor">IfThenElse</span></a></span></a></span></span>
  <span class="ju-comment">-- 6</span>
  <span class="ju-keyword">|</span> <span id="Nockma:22"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:22" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:22" class="ju-code-link ju-constructor"><span class="ju-constructor">Compose</span></a></span></a></span></span>
  <span class="ju-comment">-- 7</span>
  <span class="ju-keyword">|</span> <span id="Nockma:23"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:23" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:23" class="ju-code-link ju-constructor"><span class="ju-constructor">Extend</span></a></span></a></span></span>
  <span class="ju-comment">-- 8</span>
  <span class="ju-keyword">|</span> <span id="Nockma:24"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:24" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:24" class="ju-code-link ju-constructor"><span class="ju-constructor">Invoke</span></a></span></a></span></span>
  <span class="ju-comment">-- 9</span>
  <span class="ju-keyword">|</span> <span id="Nockma:25"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:25" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:25" class="ju-code-link ju-constructor"><span class="ju-constructor">Pound</span></a></span></a></span></span>
  <span class="ju-comment">-- #</span>
  <span class="ju-keyword">|</span> <span id="Nockma:26"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:26" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:26" class="ju-code-link ju-constructor"><span class="ju-constructor">Match</span></a></span></a></span></span>
  <span class="ju-comment">-- 11</span>
  <span class="ju-keyword">|</span> <span id="Nockma:27"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:27" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:27" class="ju-code-link ju-constructor"><span class="ju-constructor">Scry</span></a></span></a></span></span><span class="ju-delimiter">;</span>
<span id="Nockma:51"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:51" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:51" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- 12</span>

opOr</span></a></span></a></span></span> <span class="ju-delimiter">{</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:55" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span> <span class="ju-keyword">:</span> <span class="ju-keyword">Type</span><span class="ju-delimiter">}</span> <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:56" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:57" class="ju-code-link ju-var"><span class="ju-var">m</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:24" class="ju-code-link ju-var"><span class="ju-inductive">Option</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:55" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:24" class="ju-code-link ju-var"><span class="ju-inductive">Option</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:55" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:56" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span> <span class="ju-keyword">of</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:26" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:57" class="ju-code-link ju-var"><span class="ju-var">m</span></a></span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:25" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="Nockma:58"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:58" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:58" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:25" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:58" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span><span class="ju-delimiter">;</span>
<span id="Nockma:52"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:52" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:52" class="ju-code-link ju-function"><span class="ju-function">
parseOp</span></a></span></a></span></span> <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:59" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:24" class="ju-code-link ju-var"><span class="ju-inductive">Option</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:14" class="ju-code-link ju-inductive"><span class="ju-inductive">NockOp</span></a></span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">let</span>
    <span id="Nockma:62"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:62" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:62" class="ju-code-link ju-function"><span class="ju-function">test</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:60"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:60" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:60" class="ju-code-link ju-var"><span class="ju-var">m</span></a></span></a></span></span> <span id="Nockma:61"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:61" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:61" class="ju-code-link ju-var"><span class="ju-var">op</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
        <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:59" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Eq-src.html#Stdlib.Trait.Eq:7" class="ju-code-link ju-function"><span class="ju-function">==</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:60" class="ju-code-link ju-var"><span class="ju-var">m</span></a></span> <span class="ju-keyword">of</span>
          <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:2" class="ju-code-link ju-constructor"><span class="ju-constructor">true</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:25" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:61" class="ju-code-link ju-var"><span class="ju-var">op</span></a></span>
          <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:3" class="ju-code-link ju-constructor"><span class="ju-constructor">false</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:26" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
  <span class="ju-keyword">in</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Foldable/Monomorphic-src.html#Stdlib.Trait.Foldable.Monomorphic:14" class="ju-code-link ju-function"><span class="ju-function">foldr</span></a></span>
    <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:51" class="ju-code-link ju-function"><span class="ju-function">opOr</span></a></span>
    <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:26" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
    <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/List/Base-src.html#Stdlib.Data.List.Base:26" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>zipWith</span></a></span>
      <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:62" class="ju-code-link ju-function"><span class="ju-function">test</span></a></span>
      <span class="ju-keyword">[</span><span class="ju-number">0</span><span class="ju-delimiter">;</span> <span class="ju-number">1</span><span class="ju-delimiter">;</span> <span class="ju-number">2</span><span class="ju-delimiter">;</span> <span class="ju-number">3</span><span class="ju-delimiter">;</span> <span class="ju-number">4</span><span class="ju-delimiter">;</span> <span class="ju-number">5</span><span class="ju-delimiter">;</span> <span class="ju-number">6</span><span class="ju-delimiter">;</span> <span class="ju-number">7</span><span class="ju-delimiter">;</span> <span class="ju-number">8</span><span class="ju-delimiter">;</span> <span class="ju-number">9</span><span class="ju-delimiter">;</span> <span class="ju-number">10</span><span class="ju-delimiter">;</span> <span class="ju-number">11</span><span class="ju-delimiter">;</span> <span class="ju-number">12</span><span class="ju-keyword">]</span>
      <span class="ju-keyword">[</span>
        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:15" class="ju-code-link ju-constructor"><span class="ju-constructor">Slash</span></a></span><span class="ju-delimiter">;</span>
        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:16" class="ju-code-link ju-constructor"><span class="ju-constructor">Constant</span></a></span><span class="ju-delimiter">;</span>
        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:17" class="ju-code-link ju-constructor"><span class="ju-constructor">Apply</span></a></span><span class="ju-delimiter">;</span>
        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:18" class="ju-code-link ju-constructor"><span class="ju-constructor">CellTest</span></a></span><span class="ju-delimiter">;</span>
        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:19" class="ju-code-link ju-constructor"><span class="ju-constructor">Increment</span></a></span><span class="ju-delimiter">;</span>
        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:20" class="ju-code-link ju-constructor"><span class="ju-constructor">EqualOp</span></a></span><span class="ju-delimiter">;</span>
        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:21" class="ju-code-link ju-constructor"><span class="ju-constructor">IfThenElse</span></a></span><span class="ju-delimiter">;</span>
        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:22" class="ju-code-link ju-constructor"><span class="ju-constructor">Compose</span></a></span><span class="ju-delimiter">;</span>
        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:23" class="ju-code-link ju-constructor"><span class="ju-constructor">Extend</span></a></span><span class="ju-delimiter">;</span>
        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:24" class="ju-code-link ju-constructor"><span class="ju-constructor">Invoke</span></a></span><span class="ju-delimiter">;</span>
        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:25" class="ju-code-link ju-constructor"><span class="ju-constructor">Pound</span></a></span><span class="ju-delimiter">;</span>
        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:26" class="ju-code-link ju-constructor"><span class="ju-constructor">Match</span></a></span><span class="ju-delimiter">;</span>
        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:27" class="ju-code-link ju-constructor"><span class="ju-constructor">Scry</span></a></span><span class="ju-delimiter">;</span>
      <span class="ju-keyword">]</span><span class="ju-delimiter">)</span><span class="ju-delimiter">;</span>

<span class="ju-comment">-- Monad to encompass gas consumption and error handling.</span>
<span class="ju-keyword">type</span> <span id="Nockma:53"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:53" class="ju-code-link ju-inductive"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:53" class="ju-code-link ju-inductive"><span class="ju-inductive">GasState</span></a></span></a></span></span> <span id="Nockma:63"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:63" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:63" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span id="Nockma:54"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:54" class="ju-code-link ju-constructor"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:54" class="ju-code-link ju-constructor"><span class="ju-constructor">mkGasState</span></a></span></a></span></span><span class="ju-keyword">@</span><span class="ju-delimiter">{</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:64" class="ju-code-link ju-var"><span class="ju-var">runGasState</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span> <span class="ju-keyword">-&gt;</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Result</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/String-src.html#Juvix.Builtin.V1.String:1" class="ju-code-link ju-inductive"><span class="ju-axiom">String</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Pair/Base-src.html#Stdlib.Data.Pair.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>Pair</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:63" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>

<span class="ju-keyword">instance</span>
<span id="Nockma:104"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:104" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:104" class="ju-code-link ju-function"><span class="ju-function">GasStateMonad</span></a></span></a></span></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Monad</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:53" class="ju-code-link ju-inductive"><span class="ju-inductive">GasState</span></a></span> <span class="ju-keyword">:=</span>
  <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:2" class="ju-code-link ju-constructor"><span class="ju-constructor">mkMonad</span></a></span><span class="ju-keyword">@</span><span class="ju-delimiter">{</span>
    <span id="Nockma:96"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:96" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:96" class="ju-code-link ju-function"><span class="ju-function">applicative</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Applicative-src.html#Stdlib.Trait.Applicative:2" class="ju-code-link ju-constructor"><span class="ju-constructor">mkApplicative</span></a></span><span class="ju-keyword">@</span><span class="ju-delimiter">{</span>
        <span id="Nockma:82"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:82" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:82" class="ju-code-link ju-function"><span class="ju-function">functor</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Functor/Polymorphic-src.html#Stdlib.Trait.Functor.Polymorphic:2" class="ju-code-link ju-constructor"><span class="ju-constructor">mkFunctor</span></a></span><span class="ju-keyword">@</span><span class="ju-delimiter">{</span>
            <span id="Nockma:81"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:81" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:81" class="ju-code-link ju-function"><span class="ju-function">map</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
              <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:75"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:75" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:75" class="ju-code-link ju-var"><span class="ju-var">f</span></a></span></a></span></span> <span id="Nockma:76"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:76" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:76" class="ju-code-link ju-var"><span class="ju-var">s</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:54" class="ju-code-link ju-constructor"><span class="ju-constructor">mkGasState</span></a></span>
                  <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:77"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:77" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:77" class="ju-code-link ju-var"><span class="ju-var">gas</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                    <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:65" class="ju-code-link ju-function"><span class="ju-function">GasState<span class="ju-delimiter">.</span>runGasState</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:76" class="ju-code-link ju-var"><span class="ju-var">s</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:77" class="ju-code-link ju-var"><span class="ju-var">gas</span></a></span> <span class="ju-keyword">of</span>
                      <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:3" class="ju-code-link ju-constructor"><span class="ju-constructor">ok</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:7" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="Nockma:78"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:78" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:78" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span></a></span></span> <span id="Nockma:79"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:79" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:79" class="ju-code-link ju-var"><span class="ju-var">remaining</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:3" class="ju-code-link ju-constructor"><span class="ju-constructor">ok</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:7" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:75" class="ju-code-link ju-var"><span class="ju-var"><span class="ju-delimiter">(</span>f</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:78" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:79" class="ju-code-link ju-var"><span class="ju-var">remaining</span></a></span><span class="ju-delimiter">)</span>
                      <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:2" class="ju-code-link ju-constructor"><span class="ju-constructor">error</span></a></span> <span id="Nockma:80"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:80" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:80" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:2" class="ju-code-link ju-constructor"><span class="ju-constructor">error</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:80" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
          <span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
        <span id="Nockma:85"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:85" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:85" class="ju-code-link ju-function"><span class="ju-function">pure</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:83"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:83" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:83" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:54" class="ju-code-link ju-constructor"><span class="ju-constructor">mkGasState</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:84"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:84" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:84" class="ju-code-link ju-var"><span class="ju-var">gas</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:3" class="ju-code-link ju-constructor"><span class="ju-constructor">ok</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:7" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:83" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:84" class="ju-code-link ju-var"><span class="ju-var">gas</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
        <span id="Nockma:95"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:95" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:95" class="ju-code-link ju-function"><span class="ju-function">ap</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
          <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:86"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:86" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:86" class="ju-code-link ju-var"><span class="ju-var">sf</span></a></span></a></span></span> <span id="Nockma:87"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:87" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:87" class="ju-code-link ju-var"><span class="ju-var">sa</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
            <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:54" class="ju-code-link ju-constructor"><span class="ju-constructor">mkGasState</span></a></span>
              <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:88"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:88" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:88" class="ju-code-link ju-var"><span class="ju-var">gas</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:65" class="ju-code-link ju-function"><span class="ju-function">GasState<span class="ju-delimiter">.</span>runGasState</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:86" class="ju-code-link ju-var"><span class="ju-var">sf</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:88" class="ju-code-link ju-var"><span class="ju-var">gas</span></a></span> <span class="ju-keyword">of</span>
                  <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:3" class="ju-code-link ju-constructor"><span class="ju-constructor">ok</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:7" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="Nockma:89"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:89" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:89" class="ju-code-link ju-var"><span class="ju-var">f</span></a></span></a></span></span> <span id="Nockma:90"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:90" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:90" class="ju-code-link ju-var"><span class="ju-var">remaining</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
                    <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:65" class="ju-code-link ju-function"><span class="ju-function">GasState<span class="ju-delimiter">.</span>runGasState</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:87" class="ju-code-link ju-var"><span class="ju-var">sa</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:90" class="ju-code-link ju-var"><span class="ju-var">remaining</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
                      <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:3" class="ju-code-link ju-constructor"><span class="ju-constructor">ok</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:7" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="Nockma:91"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:91" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:91" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span></a></span></span> <span id="Nockma:92"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:92" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:92" class="ju-code-link ju-var"><span class="ju-var">final</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:3" class="ju-code-link ju-constructor"><span class="ju-constructor">ok</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:7" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:89" class="ju-code-link ju-var"><span class="ju-var"><span class="ju-delimiter">(</span>f</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:91" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:92" class="ju-code-link ju-var"><span class="ju-var">final</span></a></span><span class="ju-delimiter">)</span>
                      <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:2" class="ju-code-link ju-constructor"><span class="ju-constructor">error</span></a></span> <span id="Nockma:93"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:93" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:93" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:2" class="ju-code-link ju-constructor"><span class="ju-constructor">error</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:93" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span>
                    <span class="ju-delimiter">}</span>
                  <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:2" class="ju-code-link ju-constructor"><span class="ju-constructor">error</span></a></span> <span id="Nockma:94"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:94" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:94" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:2" class="ju-code-link ju-constructor"><span class="ju-constructor">error</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:94" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
      <span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
    <span id="Nockma:103"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:103" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:103" class="ju-code-link ju-function"><span class="ju-function">bind</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:97"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:97" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:97" class="ju-code-link ju-var"><span class="ju-var">ma</span></a></span></a></span></span> <span id="Nockma:98"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:98" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:98" class="ju-code-link ju-var"><span class="ju-var">f</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:54" class="ju-code-link ju-constructor"><span class="ju-constructor">mkGasState</span></a></span>
          <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:99"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:99" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:99" class="ju-code-link ju-var"><span class="ju-var">gas</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
            <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:65" class="ju-code-link ju-function"><span class="ju-function">GasState<span class="ju-delimiter">.</span>runGasState</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:97" class="ju-code-link ju-var"><span class="ju-var">ma</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:99" class="ju-code-link ju-var"><span class="ju-var">gas</span></a></span> <span class="ju-keyword">of</span>
              <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:3" class="ju-code-link ju-constructor"><span class="ju-constructor">ok</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:7" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="Nockma:100"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:100" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:100" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span></a></span></span> <span id="Nockma:101"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:101" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:101" class="ju-code-link ju-var"><span class="ju-var">remaining</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:65" class="ju-code-link ju-function"><span class="ju-function">GasState<span class="ju-delimiter">.</span>runGasState</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:98" class="ju-code-link ju-var"><span class="ju-var"><span class="ju-delimiter">(</span>f</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:100" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:101" class="ju-code-link ju-var"><span class="ju-var">remaining</span></a></span>
              <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:2" class="ju-code-link ju-constructor"><span class="ju-constructor">error</span></a></span> <span id="Nockma:102"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:102" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:102" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:2" class="ju-code-link ju-constructor"><span class="ju-constructor">error</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:102" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
  <span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
<span id="Nockma:67"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">
err</span></a></span></a></span></span> <span class="ju-delimiter">{</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:105" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span> <span class="ju-keyword">:</span> <span class="ju-keyword">Type</span><span class="ju-delimiter">}</span> <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:106" class="ju-code-link ju-var"><span class="ju-var">str</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/String-src.html#Juvix.Builtin.V1.String:1" class="ju-code-link ju-inductive"><span class="ju-axiom">String</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:53" class="ju-code-link ju-inductive"><span class="ju-inductive">GasState</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:105" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:54" class="ju-code-link ju-constructor"><span class="ju-constructor">mkGasState</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:2" class="ju-code-link ju-constructor"><span class="ju-constructor">error</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:106" class="ju-code-link ju-var"><span class="ju-var">str</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
<span id="Nockma:68"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:68" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:68" class="ju-code-link ju-function"><span class="ju-function">
<span class="ju-comment">-- Gas cost values for each operation type</span>
<span class="ju-comment">-- These are made up for demo purposes</span>
getGasCost</span></a></span></a></span></span> <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:107" class="ju-code-link ju-var"><span class="ju-var">cost</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:14" class="ju-code-link ju-inductive"><span class="ju-inductive">NockOp</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:107" class="ju-code-link ju-var"><span class="ju-var">cost</span></a></span> <span class="ju-keyword">of</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:15" class="ju-code-link ju-constructor"><span class="ju-constructor">Slash</span></a></span> <span class="ju-keyword">:=</span> <span class="ju-number">1</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:18" class="ju-code-link ju-constructor"><span class="ju-constructor">CellTest</span></a></span> <span class="ju-keyword">:=</span> <span class="ju-number">1</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:19" class="ju-code-link ju-constructor"><span class="ju-constructor">Increment</span></a></span> <span class="ju-keyword">:=</span> <span class="ju-number">1</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:20" class="ju-code-link ju-constructor"><span class="ju-constructor">EqualOp</span></a></span> <span class="ju-keyword">:=</span> <span class="ju-number">2</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:21" class="ju-code-link ju-constructor"><span class="ju-constructor">IfThenElse</span></a></span> <span class="ju-keyword">:=</span> <span class="ju-number">3</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:22" class="ju-code-link ju-constructor"><span class="ju-constructor">Compose</span></a></span> <span class="ju-keyword">:=</span> <span class="ju-number">2</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:23" class="ju-code-link ju-constructor"><span class="ju-constructor">Extend</span></a></span> <span class="ju-keyword">:=</span> <span class="ju-number">2</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:24" class="ju-code-link ju-constructor"><span class="ju-constructor">Invoke</span></a></span> <span class="ju-keyword">:=</span> <span class="ju-number">3</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:25" class="ju-code-link ju-constructor"><span class="ju-constructor">Pound</span></a></span> <span class="ju-keyword">:=</span> <span class="ju-number">1</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:27" class="ju-code-link ju-constructor"><span class="ju-constructor">Scry</span></a></span> <span class="ju-keyword">:=</span> <span class="ju-number">10</span>
    <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="ju-number">0</span><span class="ju-delimiter">;</span>
<span id="Nockma:69"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:69" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:69" class="ju-code-link ju-function"><span class="ju-function">
consume</span></a></span></a></span></span> <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:108" class="ju-code-link ju-var"><span class="ju-var">op</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:14" class="ju-code-link ju-inductive"><span class="ju-inductive">NockOp</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:53" class="ju-code-link ju-inductive"><span class="ju-inductive">GasState</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Unit/Base-src.html#Stdlib.Data.Unit.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Unit</span></a></span> <span class="ju-keyword">:=</span>
  <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:54" class="ju-code-link ju-constructor"><span class="ju-constructor">mkGasState</span></a></span>
    <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:109"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:109" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:109" class="ju-code-link ju-var"><span class="ju-var">gas</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">let</span>
        <span id="Nockma:110"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:110" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:110" class="ju-code-link ju-function"><span class="ju-function">cost</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:68" class="ju-code-link ju-function"><span class="ju-function">getGasCost</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:108" class="ju-code-link ju-var"><span class="ju-var">op</span></a></span><span class="ju-delimiter">;</span>
      <span class="ju-keyword">in</span> <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:110" class="ju-code-link ju-function"><span class="ju-function">cost</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Ord-src.html#Stdlib.Trait.Ord:24" class="ju-code-link ju-function"><span class="ju-function">&gt;</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:109" class="ju-code-link ju-var"><span class="ju-var">gas</span></a></span> <span class="ju-keyword">of</span>
           <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:2" class="ju-code-link ju-constructor"><span class="ju-constructor">true</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:2" class="ju-code-link ju-constructor"><span class="ju-constructor">error</span></a></span> <span class="ju-string">&quot;Out of gas&quot;</span>
           <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:3" class="ju-code-link ju-constructor"><span class="ju-constructor">false</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:3" class="ju-code-link ju-constructor"><span class="ju-constructor">ok</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:7" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Unit/Base-src.html#Stdlib.Data.Unit.Base:2" class="ju-code-link ju-constructor"><span class="ju-constructor">unit</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:7" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>sub</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:109" class="ju-code-link ju-var"><span class="ju-var">gas</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:110" class="ju-code-link ju-function"><span class="ju-function">cost</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
<span id="Nockma:70"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:70" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:70" class="ju-code-link ju-function"><span class="ju-function">
<span class="ju-comment">-- Implementation of storage read operations (scrying)</span>
scry</span></a></span></a></span></span>
  <span class="ju-delimiter">{</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:111" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span> <span class="ju-keyword">:</span> <span class="ju-keyword">Type</span><span class="ju-delimiter">}</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:112" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:11" class="ju-code-link ju-inductive"><span class="ju-inductive">Storage</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:111" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:113" class="ju-code-link ju-var"><span class="ju-var">op</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:8" class="ju-code-link ju-inductive"><span class="ju-inductive">ScryOp</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:114" class="ju-code-link ju-var"><span class="ju-var">addr</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Result</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/String-src.html#Juvix.Builtin.V1.String:1" class="ju-code-link ju-inductive"><span class="ju-axiom">String</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:113" class="ju-code-link ju-var"><span class="ju-var">op</span></a></span> <span class="ju-keyword">of</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:9" class="ju-code-link ju-constructor"><span class="ju-constructor">Direct</span></a></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:47" class="ju-code-link ju-function"><span class="ju-function">Storage<span class="ju-delimiter">.</span>readDirect</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:112" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:114" class="ju-code-link ju-var"><span class="ju-var">addr</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:25" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="Nockma:115"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:115" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:115" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:3" class="ju-code-link ju-constructor"><span class="ju-constructor">ok</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:6" class="ju-code-link ju-axiom"><span class="ju-axiom"><span class="ju-delimiter">(</span>convertToNoun</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:115" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span><span class="ju-delimiter">)</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:26" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:2" class="ju-code-link ju-constructor"><span class="ju-constructor">error</span></a></span> <span class="ju-string">&quot;Direct storage read failed&quot;</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:10" class="ju-code-link ju-constructor"><span class="ju-constructor">Index</span></a></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:47" class="ju-code-link ju-function"><span class="ju-function">Storage<span class="ju-delimiter">.</span>readDirect</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:112" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:114" class="ju-code-link ju-var"><span class="ju-var">addr</span></a></span> <span class="ju-keyword">of</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:25" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="Nockma:116"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:116" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:116" class="ju-code-link ju-var"><span class="ju-var">indexFn</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
          <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:48" class="ju-code-link ju-function"><span class="ju-function">Storage<span class="ju-delimiter">.</span>readIndex</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:112" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:116" class="ju-code-link ju-var"><span class="ju-var">indexFn</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
            <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:25" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="Nockma:117"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:117" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:117" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:3" class="ju-code-link ju-constructor"><span class="ju-constructor">ok</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:6" class="ju-code-link ju-axiom"><span class="ju-axiom"><span class="ju-delimiter">(</span>convertToNoun</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:117" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span><span class="ju-delimiter">)</span>
            <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:26" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:2" class="ju-code-link ju-constructor"><span class="ju-constructor">error</span></a></span> <span class="ju-string">&quot;Index computation failed&quot;</span>
          <span class="ju-delimiter">}</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:26" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:2" class="ju-code-link ju-constructor"><span class="ju-constructor">error</span></a></span> <span class="ju-string">&quot;Index function not found&quot;</span><span class="ju-delimiter">;</span>

<span class="ju-comment">-- Helper for slash (/) operations</span>
<span class="ju-keyword">terminating</span>
<span id="Nockma:71"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:71" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:71" class="ju-code-link ju-function"><span class="ju-function">slash</span></a></span></a></span></span>
  <span class="ju-delimiter">{</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:118" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span> <span class="ju-keyword">:</span> <span class="ju-keyword">Type</span><span class="ju-delimiter">}</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:119" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:11" class="ju-code-link ju-inductive"><span class="ju-inductive">Storage</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:118" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:120" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:121" class="ju-code-link ju-var"><span class="ju-var">subject</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:53" class="ju-code-link ju-inductive"><span class="ju-inductive">GasState</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:120" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span> <span class="ju-keyword">of</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor">Atom</span></a></span> <span id="Nockma:122"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:122" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:122" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:122" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Eq-src.html#Stdlib.Trait.Eq:7" class="ju-code-link ju-function"><span class="ju-function">==</span></a></span> <span class="ju-number">1</span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:2" class="ju-code-link ju-constructor"><span class="ju-constructor">true</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Applicative-src.html#Stdlib.Trait.Applicative:11" class="ju-code-link ju-function"><span class="ju-function">pure</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:121" class="ju-code-link ju-var"><span class="ju-var">subject</span></a></span>
        <span class="ju-comment">-- Rule: /[1 a] -&gt; a</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:3" class="ju-code-link ju-constructor"><span class="ju-constructor">false</span></a></span> <span class="ju-keyword">:=</span>
          <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:122" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Eq-src.html#Stdlib.Trait.Eq:7" class="ju-code-link ju-function"><span class="ju-function">==</span></a></span> <span class="ju-number">2</span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
            <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:2" class="ju-code-link ju-constructor"><span class="ju-constructor">true</span></a></span> <span class="ju-keyword">:=</span>
              <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:121" class="ju-code-link ju-var"><span class="ju-var">subject</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
                <span class="ju-comment">-- Rule: /[2 a b] -&gt; a</span>
                <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span id="Nockma:123"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:123" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:123" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span></a></span></span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Applicative-src.html#Stdlib.Trait.Applicative:11" class="ju-code-link ju-function"><span class="ju-function">pure</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:123" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span>
                <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Cannot take slash of atom&quot;</span>
              <span class="ju-delimiter">}</span>
            <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:3" class="ju-code-link ju-constructor"><span class="ju-constructor">false</span></a></span> <span class="ju-keyword">:=</span>
              <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:122" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Eq-src.html#Stdlib.Trait.Eq:7" class="ju-code-link ju-function"><span class="ju-function">==</span></a></span> <span class="ju-number">3</span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
                <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:2" class="ju-code-link ju-constructor"><span class="ju-constructor">true</span></a></span> <span class="ju-keyword">:=</span>
                  <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:121" class="ju-code-link ju-var"><span class="ju-var">subject</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
                    <span class="ju-comment">-- Rule: /[3 a b] -&gt; b</span>
                    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span class="ju-keyword">_</span> <span id="Nockma:124"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:124" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:124" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Applicative-src.html#Stdlib.Trait.Applicative:11" class="ju-code-link ju-function"><span class="ju-function">pure</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:124" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span>
                    <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Cannot take slash of atom&quot;</span>
                  <span class="ju-delimiter">}</span>
                <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:3" class="ju-code-link ju-constructor"><span class="ju-constructor">false</span></a></span> <span class="ju-keyword">:=</span>
                  <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/DivMod-src.html#Stdlib.Trait.DivMod:7" class="ju-code-link ju-function"><span class="ju-function">mod</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:122" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span> <span class="ju-number">2</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Eq-src.html#Stdlib.Trait.Eq:7" class="ju-code-link ju-function"><span class="ju-function">==</span></a></span> <span class="ju-number">0</span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
                    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:2" class="ju-code-link ju-constructor"><span class="ju-constructor">true</span></a></span> <span class="ju-keyword">:=</span>
                      <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:69" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Rule: /[(a + a) b] -&gt; /[2 /[a b]]</span>
                          consume</span></a></span>
                          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:15" class="ju-code-link ju-constructor"><span class="ju-constructor">Slash</span></a></span>
                        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span class="ju-keyword">_</span> <span class="ju-keyword">:=</span>
                          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:71" class="ju-code-link ju-function"><span class="ju-function">slash</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:119" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/DivMod-src.html#Stdlib.Trait.DivMod:6" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>div</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:122" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span> <span class="ju-number">2</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:121" class="ju-code-link ju-var"><span class="ju-var">subject</span></a></span>
                            <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:125"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:125" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:125" class="ju-code-link ju-var"><span class="ju-var">res</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                              <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:69" class="ju-code-link ju-function"><span class="ju-function">consume</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:15" class="ju-code-link ju-constructor"><span class="ju-constructor">Slash</span></a></span>
                                <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:71" class="ju-code-link ju-function"><span class="ju-function">slash</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:119" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">2</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:125" class="ju-code-link ju-var"><span class="ju-var">res</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span>
                    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:3" class="ju-code-link ju-constructor"><span class="ju-constructor">false</span></a></span> <span class="ju-keyword">:=</span>
                      <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:69" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Rule: /[(a + a + 1) b] -&gt; /[3 /[a b]]</span>
                          consume</span></a></span>
                          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:15" class="ju-code-link ju-constructor"><span class="ju-constructor">Slash</span></a></span>
                        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span class="ju-keyword">_</span> <span class="ju-keyword">:=</span>
                          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:71" class="ju-code-link ju-function"><span class="ju-function">slash</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:119" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/DivMod-src.html#Stdlib.Trait.DivMod:6" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>div</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:122" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span> <span class="ju-number">2</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:121" class="ju-code-link ju-var"><span class="ju-var">subject</span></a></span>
                            <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:126"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:126" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:126" class="ju-code-link ju-var"><span class="ju-var">res</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                              <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:69" class="ju-code-link ju-function"><span class="ju-function">consume</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:15" class="ju-code-link ju-constructor"><span class="ju-constructor">Slash</span></a></span>
                                <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:71" class="ju-code-link ju-function"><span class="ju-function">slash</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:119" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">3</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:126" class="ju-code-link ju-var"><span class="ju-var">res</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span>
                  <span class="ju-delimiter">}</span>
              <span class="ju-delimiter">}</span>
          <span class="ju-delimiter">}</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Slash must be atom&quot;</span><span class="ju-delimiter">;</span>

<span class="ju-comment">-- Helper for pound (#) operations</span>
<span class="ju-keyword">terminating</span>
<span id="Nockma:72"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:72" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:72" class="ju-code-link ju-function"><span class="ju-function">pound</span></a></span></a></span></span>
  <span class="ju-delimiter">{</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:127" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span> <span class="ju-keyword">:</span> <span class="ju-keyword">Type</span><span class="ju-delimiter">}</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:128" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:11" class="ju-code-link ju-inductive"><span class="ju-inductive">Storage</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:127" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:129" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:130" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:131" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:53" class="ju-code-link ju-inductive"><span class="ju-inductive">GasState</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:129" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span> <span class="ju-keyword">of</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor">Atom</span></a></span> <span id="Nockma:132"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:132" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:132" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:132" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Eq-src.html#Stdlib.Trait.Eq:7" class="ju-code-link ju-function"><span class="ju-function">==</span></a></span> <span class="ju-number">1</span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:2" class="ju-code-link ju-constructor"><span class="ju-constructor">true</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Applicative-src.html#Stdlib.Trait.Applicative:11" class="ju-code-link ju-function"><span class="ju-function">pure</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:130" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span>
        <span class="ju-comment">-- Rule: #[1 a b] -&gt; a</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:3" class="ju-code-link ju-constructor"><span class="ju-constructor">false</span></a></span> <span class="ju-keyword">:=</span>
          <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/DivMod-src.html#Stdlib.Trait.DivMod:7" class="ju-code-link ju-function"><span class="ju-function">mod</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:132" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span> <span class="ju-number">2</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Eq-src.html#Stdlib.Trait.Eq:7" class="ju-code-link ju-function"><span class="ju-function">==</span></a></span> <span class="ju-number">0</span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
            <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:2" class="ju-code-link ju-constructor"><span class="ju-constructor">true</span></a></span> <span class="ju-keyword">:=</span>
              <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:131" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
                <span class="ju-comment">-- Rule: #[(a + a) b c] -&gt; #[a [b /[(a + a + 1) c]] c]</span>
                <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span class="ju-keyword">_</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span>
                  <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:69" class="ju-code-link ju-function"><span class="ju-function">consume</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:15" class="ju-code-link ju-constructor"><span class="ju-constructor">Slash</span></a></span>
                    <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span class="ju-keyword">_</span> <span class="ju-keyword">:=</span>
                      <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:71" class="ju-code-link ju-function"><span class="ju-function">slash</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:128" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-delimiter">(</span><span class="ju-number">2</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Trait/Natural-src.html#Juvix.Builtin.V1.Trait.Natural:9" class="ju-code-link ju-function"><span class="ju-function">*</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/DivMod-src.html#Stdlib.Trait.DivMod:6" class="ju-code-link ju-function"><span class="ju-function">div</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:132" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span> <span class="ju-number">2</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Trait/Natural-src.html#Juvix.Builtin.V1.Trait.Natural:8" class="ju-code-link ju-function"><span class="ju-function">+</span></a></span> <span class="ju-number">1</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:131" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span>
                        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:133"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:133" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:133" class="ju-code-link ju-var"><span class="ju-var">slashResult</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:69" class="ju-code-link ju-function"><span class="ju-function">consume</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:25" class="ju-code-link ju-constructor"><span class="ju-constructor">Pound</span></a></span>
                            <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span class="ju-keyword">_</span> <span class="ju-keyword">:=</span>
                              <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:72" class="ju-code-link ju-function"><span class="ju-function">pound</span></a></span>
                                <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:128" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span>
                                <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/DivMod-src.html#Stdlib.Trait.DivMod:6" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>div</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:132" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span> <span class="ju-number">2</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
                                <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:130" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:133" class="ju-code-link ju-var"><span class="ju-var">slashResult</span></a></span><span class="ju-delimiter">)</span>
                                <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:131" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span>
                <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Invalid pound target&quot;</span>
              <span class="ju-delimiter">}</span>
            <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:3" class="ju-code-link ju-constructor"><span class="ju-constructor">false</span></a></span> <span class="ju-keyword">:=</span>
              <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:131" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
                <span class="ju-comment">-- Rule: #[(a + a + 1) b c] -&gt; #[a [/[(a + a) c] b] c]</span>
                <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span class="ju-keyword">_</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span>
                  <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:69" class="ju-code-link ju-function"><span class="ju-function">consume</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:15" class="ju-code-link ju-constructor"><span class="ju-constructor">Slash</span></a></span>
                    <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span class="ju-keyword">_</span> <span class="ju-keyword">:=</span>
                      <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:71" class="ju-code-link ju-function"><span class="ju-function">slash</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:128" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-delimiter">(</span><span class="ju-number">2</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Trait/Natural-src.html#Juvix.Builtin.V1.Trait.Natural:9" class="ju-code-link ju-function"><span class="ju-function">*</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/DivMod-src.html#Stdlib.Trait.DivMod:6" class="ju-code-link ju-function"><span class="ju-function">div</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:132" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span> <span class="ju-number">2</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:131" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span>
                        <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:134"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:134" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:134" class="ju-code-link ju-var"><span class="ju-var">slashResult</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:69" class="ju-code-link ju-function"><span class="ju-function">consume</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:25" class="ju-code-link ju-constructor"><span class="ju-constructor">Pound</span></a></span>
                            <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span class="ju-keyword">_</span> <span class="ju-keyword">:=</span>
                              <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:72" class="ju-code-link ju-function"><span class="ju-function">pound</span></a></span>
                                <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:128" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span>
                                <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/DivMod-src.html#Stdlib.Trait.DivMod:6" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>div</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:132" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span> <span class="ju-number">2</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
                                <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:134" class="ju-code-link ju-var"><span class="ju-var">slashResult</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:130" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span><span class="ju-delimiter">)</span>
                                <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:131" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span>
                <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Invalid pound target&quot;</span>
              <span class="ju-delimiter">}</span>
          <span class="ju-delimiter">}</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Pound must be atom&quot;</span><span class="ju-delimiter">;</span>

<span class="ju-keyword">terminating</span>
<span id="Nockma:73"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:73" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:73" class="ju-code-link ju-function"><span class="ju-function">evalOp</span></a></span></a></span></span>
  <span class="ju-delimiter">{</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:135" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span> <span class="ju-keyword">:</span> <span class="ju-keyword">Type</span><span class="ju-delimiter">}</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:11" class="ju-code-link ju-inductive"><span class="ju-inductive">Storage</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:135" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:137" class="ju-code-link ju-var"><span class="ju-var">op</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:14" class="ju-code-link ju-inductive"><span class="ju-inductive">NockOp</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:139" class="ju-code-link ju-var"><span class="ju-var">args</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:53" class="ju-code-link ju-inductive"><span class="ju-inductive">GasState</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:137" class="ju-code-link ju-var"><span class="ju-var">op</span></a></span> <span class="ju-keyword">of</span>
    <span class="ju-comment">-- *[a 0 b] -&gt; /[b a]</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:15" class="ju-code-link ju-constructor"><span class="ju-constructor">Slash</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:71" class="ju-code-link ju-function"><span class="ju-function">slash</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:139" class="ju-code-link ju-var"><span class="ju-var">args</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span>

    <span class="ju-comment">-- *[a 1 b] -&gt; b</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:16" class="ju-code-link ju-constructor"><span class="ju-constructor">Constant</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Applicative-src.html#Stdlib.Trait.Applicative:11" class="ju-code-link ju-function"><span class="ju-function">pure</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:139" class="ju-code-link ju-var"><span class="ju-var">args</span></a></span>

    <span class="ju-comment">-- *[a 2 b c] -&gt; *[*[a b] *[a c]]</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:17" class="ju-code-link ju-constructor"><span class="ju-constructor">Apply</span></a></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:139" class="ju-code-link ju-var"><span class="ju-var">args</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span id="Nockma:140"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:140" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:140" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span></a></span></span> <span id="Nockma:141"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:141" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:141" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:140" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span><span class="ju-delimiter">)</span>
            <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:142"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:142" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:142" class="ju-code-link ju-var"><span class="ju-var">r1</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
              <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:141" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:143"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:143" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:143" class="ju-code-link ju-var"><span class="ju-var">r2</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:142" class="ju-code-link ju-var"><span class="ju-var">r1</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:143" class="ju-code-link ju-var"><span class="ju-var">r2</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span>
        <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Invalid apply args&quot;</span>
      <span class="ju-delimiter">}</span>

    <span class="ju-comment">-- *[a 3 b] -&gt; ?*[a b]</span>
    <span class="ju-comment">-- ?[a b] -&gt; 0</span>
    <span class="ju-comment">-- ?a -&gt; 1</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:18" class="ju-code-link ju-constructor"><span class="ju-constructor">CellTest</span></a></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:139" class="ju-code-link ju-var"><span class="ju-var">args</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span id="Nockma:144"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:144" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:144" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span></a></span></span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:144" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span><span class="ju-delimiter">)</span>
            <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:145"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:145" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:145" class="ju-code-link ju-var"><span class="ju-var">res</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
              <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:145" class="ju-code-link ju-var"><span class="ju-var">res</span></a></span> <span class="ju-keyword">of</span>
                <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span class="ju-keyword">_</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Applicative-src.html#Stdlib.Trait.Applicative:11" class="ju-code-link ju-function"><span class="ju-function">pure</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">0</span><span class="ju-delimiter">)</span>
                <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Applicative-src.html#Stdlib.Trait.Applicative:11" class="ju-code-link ju-function"><span class="ju-function">pure</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">1</span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span>
        <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Invalid cell test args&quot;</span>
      <span class="ju-delimiter">}</span>

    <span class="ju-comment">-- *[a 4 b] -&gt; +*[a b]</span>
    <span class="ju-comment">-- +[a b] -&gt; +[a b]</span>
    <span class="ju-comment">-- +a -&gt; 1 + a</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:19" class="ju-code-link ju-constructor"><span class="ju-constructor">Increment</span></a></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:139" class="ju-code-link ju-var"><span class="ju-var">args</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span id="Nockma:146"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:146" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:146" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span></a></span></span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:146" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span><span class="ju-delimiter">)</span>
            <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:147"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:147" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:147" class="ju-code-link ju-var"><span class="ju-var">res</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
              <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:147" class="ju-code-link ju-var"><span class="ju-var">res</span></a></span> <span class="ju-keyword">of</span>
                <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor">Atom</span></a></span> <span id="Nockma:148"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:148" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:148" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Applicative-src.html#Stdlib.Trait.Applicative:11" class="ju-code-link ju-function"><span class="ju-function">pure</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>suc</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:148" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
                <span class="ju-keyword">|</span> <span id="Nockma:149"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:149" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:149" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Applicative-src.html#Stdlib.Trait.Applicative:11" class="ju-code-link ju-function"><span class="ju-function">pure</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:149" class="ju-code-link ju-var"><span class="ju-var">x</span></a></span><span class="ju-comment">-- +[a b] -&gt; +[a b] case</span>
            <span class="ju-delimiter">}</span>
        <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Invalid increment args&quot;</span>
      <span class="ju-delimiter">}</span>

    <span class="ju-comment">-- *[a 5 b c] -&gt; =*[a b] *[a c]</span>
    <span class="ju-comment">-- =[a a] -&gt; 0</span>
    <span class="ju-comment">-- =[a b] -&gt; 1</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:20" class="ju-code-link ju-constructor"><span class="ju-constructor">EqualOp</span></a></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:139" class="ju-code-link ju-var"><span class="ju-var">args</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span id="Nockma:150"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:150" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:150" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span></a></span></span> <span id="Nockma:151"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:151" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:151" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:150" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span><span class="ju-delimiter">)</span>
            <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:152"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:152" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:152" class="ju-code-link ju-var"><span class="ju-var">r1</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
              <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:151" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span><span class="ju-delimiter">)</span>
                <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:153"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:153" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:153" class="ju-code-link ju-var"><span class="ju-var">r2</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                  <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Applicative-src.html#Stdlib.Trait.Applicative:11" class="ju-code-link ju-function"><span class="ju-function">pure</span></a></span>
                    <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span>
                      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:5" class="ju-code-link ju-function"><span class="ju-function">nounEq</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:152" class="ju-code-link ju-var"><span class="ju-var">r1</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:153" class="ju-code-link ju-var"><span class="ju-var">r2</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
                        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:2" class="ju-code-link ju-constructor"><span class="ju-constructor">true</span></a></span> <span class="ju-keyword">:=</span> <span class="ju-number">0</span>
                        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:3" class="ju-code-link ju-constructor"><span class="ju-constructor">false</span></a></span> <span class="ju-keyword">:=</span> <span class="ju-number">1</span>
                      <span class="ju-delimiter">}</span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span>
        <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Invalid equality args&quot;</span>
      <span class="ju-delimiter">}</span>

    <span class="ju-comment">-- *[a 6 b c d] -&gt; *[a *[[c d] 0 *[[2 3] 0 *[a 4 4 b]]]]</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:21" class="ju-code-link ju-constructor"><span class="ju-constructor">IfThenElse</span></a></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:139" class="ju-code-link ju-var"><span class="ju-var">args</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span id="Nockma:154"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:154" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:154" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span></a></span></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span id="Nockma:155"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:155" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:155" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span></a></span></span> <span id="Nockma:156"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:156" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:156" class="ju-code-link ju-var"><span class="ju-var">d</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">4</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">4</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:154" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
            <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:157"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:157" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:157" class="ju-code-link ju-var"><span class="ju-var">r1</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
              <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">2</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">3</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">0</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:157" class="ju-code-link ju-var"><span class="ju-var">r1</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
                <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:158"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:158" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:158" class="ju-code-link ju-var"><span class="ju-var">r2</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                  <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:155" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:156" class="ju-code-link ju-var"><span class="ju-var">d</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">0</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:158" class="ju-code-link ju-var"><span class="ju-var">r2</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
                    <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:159"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:159" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:159" class="ju-code-link ju-var"><span class="ju-var">r3</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:159" class="ju-code-link ju-var"><span class="ju-var">r3</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span>
        <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Invalid if-then-else args&quot;</span>
      <span class="ju-delimiter">}</span>

    <span class="ju-comment">-- *[a 7 b c] -&gt; *[*[a b] c]</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:22" class="ju-code-link ju-constructor"><span class="ju-constructor">Compose</span></a></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:139" class="ju-code-link ju-var"><span class="ju-var">args</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span id="Nockma:160"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:160" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:160" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span></a></span></span> <span id="Nockma:161"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:161" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:161" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:160" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:162"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:162" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:162" class="ju-code-link ju-var"><span class="ju-var">r</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:162" class="ju-code-link ju-var"><span class="ju-var">r</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:161" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span>
        <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Invalid compose args&quot;</span>
      <span class="ju-delimiter">}</span>

    <span class="ju-comment">-- *[a 8 b c] -&gt; *[[*[a b] a] c]</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:23" class="ju-code-link ju-constructor"><span class="ju-constructor">Extend</span></a></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:139" class="ju-code-link ju-var"><span class="ju-var">args</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span id="Nockma:163"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:163" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:163" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span></a></span></span> <span id="Nockma:164"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:164" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:164" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:163" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:165"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:165" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:165" class="ju-code-link ju-var"><span class="ju-var">r</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:165" class="ju-code-link ju-var"><span class="ju-var">r</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:164" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span>
        <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Invalid extend args&quot;</span>
      <span class="ju-delimiter">}</span>

    <span class="ju-comment">-- *[a 9 b c] -&gt; *[*[a c] 2 [0 1] 0 b]</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:24" class="ju-code-link ju-constructor"><span class="ju-constructor">Invoke</span></a></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:139" class="ju-code-link ju-var"><span class="ju-var">args</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span id="Nockma:166"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:166" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:166" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span></a></span></span> <span id="Nockma:167"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:167" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:167" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:167" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span><span class="ju-delimiter">)</span>
            <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:168"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:168" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:168" class="ju-code-link ju-var"><span class="ju-var">core</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
              <span class="ju-keyword">let</span>
                <span id="Nockma:169"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:169" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:169" class="ju-code-link ju-function"><span class="ju-function">formula</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                  <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span>
                    <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">2</span><span class="ju-delimiter">)</span>
                    <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">0</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">1</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">0</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:166" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">;</span>
              <span class="ju-keyword">in</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:168" class="ju-code-link ju-var"><span class="ju-var">core</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:169" class="ju-code-link ju-function"><span class="ju-function">formula</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span>
        <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Invalid invoke args&quot;</span>
      <span class="ju-delimiter">}</span>

    <span class="ju-comment">-- *[a 10 [b c] d] -&gt; #[b *[a c] *[a d]]</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:25" class="ju-code-link ju-constructor"><span class="ju-constructor">Pound</span></a></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:139" class="ju-code-link ju-var"><span class="ju-var">args</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span id="Nockma:170"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:170" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:170" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span></a></span></span> <span id="Nockma:171"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:171" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:171" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span id="Nockma:172"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:172" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:172" class="ju-code-link ju-var"><span class="ju-var">d</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:171" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span><span class="ju-delimiter">)</span>
            <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:173"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:173" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:173" class="ju-code-link ju-var"><span class="ju-var">r1</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:172" class="ju-code-link ju-var"><span class="ju-var">d</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:174"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:174" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:174" class="ju-code-link ju-var"><span class="ju-var">r2</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:72" class="ju-code-link ju-function"><span class="ju-function">pound</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:170" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:173" class="ju-code-link ju-var"><span class="ju-var">r1</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:174" class="ju-code-link ju-var"><span class="ju-var">r2</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span>
        <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Invalid pound args&quot;</span>
      <span class="ju-delimiter">}</span>

    <span class="ju-comment">-- *[a 11 [b c] d] -&gt; *[[*[a c] *[a d]] 0 3]</span>
    <span class="ju-comment">-- *[a 11 b c] -&gt; *[a c]</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:26" class="ju-code-link ju-constructor"><span class="ju-constructor">Match</span></a></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:139" class="ju-code-link ju-var"><span class="ju-var">args</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span id="Nockma:175"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:175" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:175" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span></a></span></span> <span id="Nockma:176"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:176" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:176" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span id="Nockma:177"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:177" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:177" class="ju-code-link ju-var"><span class="ju-var">d</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:176" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span><span class="ju-delimiter">)</span>
            <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:178"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:178" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:178" class="ju-code-link ju-var"><span class="ju-var">r1</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
              <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:177" class="ju-code-link ju-var"><span class="ju-var">d</span></a></span><span class="ju-delimiter">)</span>
                <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:179"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:179" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:179" class="ju-code-link ju-var"><span class="ju-var">r2</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                  <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:178" class="ju-code-link ju-var"><span class="ju-var">r1</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:179" class="ju-code-link ju-var"><span class="ju-var">r2</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">0</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">3</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span class="ju-keyword">_</span> <span id="Nockma:180"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:180" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:180" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:180" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span><span class="ju-delimiter">)</span>
        <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Invalid pure pound args&quot;</span>
      <span class="ju-delimiter">}</span>

    <span class="ju-comment">-- *[a 12 b c d] -&gt; result &lt;- SCRY b c; *[a result d]</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:27" class="ju-code-link ju-constructor"><span class="ju-constructor">Scry</span></a></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:139" class="ju-code-link ju-var"><span class="ju-var">args</span></a></span> <span class="ju-keyword">of</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span id="Nockma:181"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:181" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:181" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span></a></span></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span id="Nockma:182"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:182" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:182" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span></a></span></span> <span id="Nockma:183"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:183" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:183" class="ju-code-link ju-var"><span class="ju-var">d</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- First evaluate b to get the opcode</span>
              nock</span></a></span>
              <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span>
              <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:181" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span>
            <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:184"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:184" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:184" class="ju-code-link ju-var"><span class="ju-var">opcode</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
              <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:184" class="ju-code-link ju-var"><span class="ju-var">opcode</span></a></span> <span class="ju-keyword">of</span>
                <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor">Atom</span></a></span> <span id="Nockma:185"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:185" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:185" class="ju-code-link ju-var"><span class="ju-var">opval</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                  <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Then evaluate c to get the address</span>
                      nock</span></a></span>
                      <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span>
                      <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:182" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span>
                    <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:186"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:186" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:186" class="ju-code-link ju-var"><span class="ju-var">addr</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:186" class="ju-code-link ju-var"><span class="ju-var">addr</span></a></span> <span class="ju-keyword">of</span>
                        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor">Atom</span></a></span> <span id="Nockma:187"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:187" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:187" class="ju-code-link ju-var"><span class="ju-var">addrVal</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                          <span class="ju-comment">-- Convert opcode to ScryOp</span>
                          <span class="ju-keyword">let</span>
                            <span id="Nockma:188"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:188" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:188" class="ju-code-link ju-function"><span class="ju-function">scryType</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                              <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:185" class="ju-code-link ju-var"><span class="ju-var">opval</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Eq-src.html#Stdlib.Trait.Eq:7" class="ju-code-link ju-function"><span class="ju-function">==</span></a></span> <span class="ju-number">0</span> <span class="ju-keyword">of</span>
                                <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:2" class="ju-code-link ju-constructor"><span class="ju-constructor">true</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:9" class="ju-code-link ju-constructor"><span class="ju-constructor">Direct</span></a></span>
                                <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Bool-src.html#Juvix.Builtin.V1.Bool:3" class="ju-code-link ju-constructor"><span class="ju-constructor">false</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:10" class="ju-code-link ju-constructor"><span class="ju-constructor">Index</span></a></span><span class="ju-delimiter">;</span>
                          <span class="ju-keyword">in</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:54" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-comment">-- Perform the scry operation and wrap result in GasState</span>
                            mkGasState</span></a></span>
                            <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:189"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:189" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:189" class="ju-code-link ju-var"><span class="ju-var">gas</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                              <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:70" class="ju-code-link ju-function"><span class="ju-function">scry</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:188" class="ju-code-link ju-function"><span class="ju-function">scryType</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:187" class="ju-code-link ju-var"><span class="ju-var">addrVal</span></a></span>
                                <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:190"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:190" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:190" class="ju-code-link ju-var"><span class="ju-var">scryResult</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                                  <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:65" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Continue evaluation with the scry result</span>
                                    GasState<span class="ju-delimiter">.</span>runGasState</span></a></span>
                                    <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:136" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:138" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:190" class="ju-code-link ju-var"><span class="ju-var">scryResult</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:183" class="ju-code-link ju-var"><span class="ju-var">d</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
                                    <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:189" class="ju-code-link ju-var"><span class="ju-var">gas</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span>
                        <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Scry address must be atom&quot;</span><span class="ju-delimiter">}</span>
                <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Scry type must be atom&quot;</span><span class="ju-delimiter">}</span>
        <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Invalid scry args&quot;</span><span class="ju-delimiter">;</span>

<span class="ju-comment">-- Core Nockma evaluator</span>
<span class="ju-keyword">terminating</span>
<span id="Nockma:74"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span></a></span></span> <span class="ju-delimiter">{</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:191" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span> <span class="ju-keyword">:</span> <span class="ju-keyword">Type</span><span class="ju-delimiter">}</span> <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:192" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:11" class="ju-code-link ju-inductive"><span class="ju-inductive">Storage</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:191" class="ju-code-link ju-var"><span class="ju-var">val</span></a></span><span class="ju-delimiter">)</span> <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:193" class="ju-code-link ju-var"><span class="ju-var">input</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:53" class="ju-code-link ju-inductive"><span class="ju-inductive">GasState</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:193" class="ju-code-link ju-var"><span class="ju-var">input</span></a></span> <span class="ju-keyword">of</span>
    <span class="ju-comment">-- Rule: *a -&gt; *a</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor">Atom</span></a></span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Applicative-src.html#Stdlib.Trait.Applicative:11" class="ju-code-link ju-function"><span class="ju-function">pure</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:193" class="ju-code-link ju-var"><span class="ju-var">input</span></a></span>

    <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span id="Nockma:194"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:194" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:194" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span></a></span></span> <span id="Nockma:195"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:195" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:195" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:195" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span> <span class="ju-keyword">of</span>
        
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span id="Nockma:196"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:196" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:196" class="ju-code-link ju-var"><span class="ju-var">first</span></a></span></a></span></span> <span id="Nockma:197"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:197" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:197" class="ju-code-link ju-var"><span class="ju-var">rest</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
          <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:196" class="ju-code-link ju-var"><span class="ju-var">first</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
            <span class="ju-comment">-- Rule: *[a [b c] d] -&gt; [*[a b c] *[a d]]</span>
            <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span id="Nockma:198"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:198" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:198" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span></a></span></span> <span id="Nockma:199"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:199" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:199" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
              <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:192" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:194" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:198" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:199" class="ju-code-link ju-var"><span class="ju-var">c</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
                <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:200"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:200" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:200" class="ju-code-link ju-var"><span class="ju-var">r1</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                  <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function">nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:192" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:194" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:197" class="ju-code-link ju-var"><span class="ju-var">rest</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:201"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:201" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:201" class="ju-code-link ju-var"><span class="ju-var">r2</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Applicative-src.html#Stdlib.Trait.Applicative:11" class="ju-code-link ju-function"><span class="ju-function">pure</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:200" class="ju-code-link ju-var"><span class="ju-var">r1</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:201" class="ju-code-link ju-var"><span class="ju-var">r2</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span><span class="ju-delimiter">}</span>

            <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor">Atom</span></a></span> <span id="Nockma:202"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:202" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:202" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
              <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:52" class="ju-code-link ju-function"><span class="ju-function">parseOp</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:202" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
                <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:25" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="Nockma:203"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:203" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:203" class="ju-code-link ju-var"><span class="ju-var">opcode</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                  <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:69" class="ju-code-link ju-function"><span class="ju-function">consume</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:203" class="ju-code-link ju-var"><span class="ju-var">opcode</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Trait/Monad-src.html#Stdlib.Trait.Monad:11" class="ju-code-link ju-function"><span class="ju-function">&gt;&gt;=</span></a></span> <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:73" class="ju-code-link ju-function"><span class="ju-function">evalOp</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:192" class="ju-code-link ju-var"><span class="ju-var">stor</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:203" class="ju-code-link ju-var"><span class="ju-var">opcode</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:194" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:197" class="ju-code-link ju-var"><span class="ju-var">rest</span></a></span><span class="ju-delimiter">}</span>
                <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:26" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Invalid operation&quot;</span>
              <span class="ju-delimiter">}</span>
          <span class="ju-delimiter">}</span>
        <span class="ju-keyword">|</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:67" class="ju-code-link ju-function"><span class="ju-function">err</span></a></span> <span class="ju-string">&quot;Invalid Nock expression&quot;</span><span class="ju-delimiter">;</span>

<span class="ju-keyword">instance</span>
<span id="Nockma:216"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:216" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:216" class="ju-code-link ju-function"><span class="ju-function">NockmaTransactionFunction</span></a></span></a></span></span>
  <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/arch/system/state/resource_machine/notes/function_formats/transactionfunction-src.html#arch.system.state.resource_machine.notes.function_formats.transactionfunction:1" class="ju-code-link ju-inductive"><span class="ju-inductive">TransactionFunction</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:24" class="ju-code-link ju-var"><span class="ju-inductive"><span class="ju-delimiter">(</span>Option</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span> <span class="ju-keyword">:=</span>
  <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/arch/system/state/resource_machine/notes/function_formats/transactionfunction-src.html#arch.system.state.resource_machine.notes.function_formats.transactionfunction:2" class="ju-code-link ju-constructor"><span class="ju-constructor">mkTransactionFunction</span></a></span><span class="ju-keyword">@</span><span class="ju-delimiter">{</span>
    <span id="Nockma:205"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:205" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:205" class="ju-code-link ju-function"><span class="ju-function">readStorage</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:204"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:204" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:204" class="ju-code-link ju-var"><span class="ju-var">addr</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">12</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">0</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:204" class="ju-code-link ju-var"><span class="ju-var">addr</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">1</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
    <span id="Nockma:207"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:207" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:207" class="ju-code-link ju-function"><span class="ju-function">readByIndex</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:206"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:206" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:206" class="ju-code-link ju-var"><span class="ju-var">prog</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">12</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">1</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Cell</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:206" class="ju-code-link ju-var"><span class="ju-var">prog</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Atom</span></a></span> <span class="ju-number">1</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
    <span id="Nockma:215"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:215" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:215" class="ju-code-link ju-function"><span class="ju-function">cost</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:208"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:208" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:208" class="ju-code-link ju-var"><span class="ju-var">prog</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
        <span class="ju-comment">-- Simple cost model: sums gas cost of all appearing operations</span>
        <span class="ju-keyword">let</span>
          <span class="ju-keyword">terminating</span>
          <span id="Nockma:209"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:209" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:209" class="ju-code-link ju-function"><span class="ju-function">countNodes</span></a></span></a></span></span> <span class="ju-delimiter">(</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:210" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span> <span class="ju-keyword">:=</span>
            <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:210" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span> <span class="ju-keyword">of</span>
              <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:2" class="ju-code-link ju-constructor"><span class="ju-constructor">Atom</span></a></span> <span id="Nockma:211"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:211" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:211" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                <span class="ju-keyword">case</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:52" class="ju-code-link ju-function"><span class="ju-function">parseOp</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:211" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
                  <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:25" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="Nockma:212"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:212" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:212" class="ju-code-link ju-var"><span class="ju-var">op</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:68" class="ju-code-link ju-function"><span class="ju-function">getGasCost</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:212" class="ju-code-link ju-var"><span class="ju-var">op</span></a></span>
                  <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:26" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="ju-number">0</span>
                <span class="ju-delimiter">}</span>
              <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:3" class="ju-code-link ju-constructor"><span class="ju-constructor">Cell</span></a></span> <span id="Nockma:213"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:213" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:213" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span></a></span></span> <span id="Nockma:214"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:214" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:214" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:209" class="ju-code-link ju-function"><span class="ju-function">countNodes</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:213" class="ju-code-link ju-var"><span class="ju-var">a</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Trait/Natural-src.html#Juvix.Builtin.V1.Trait.Natural:8" class="ju-code-link ju-function"><span class="ju-function">+</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:209" class="ju-code-link ju-function"><span class="ju-function">countNodes</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:214" class="ju-code-link ju-var"><span class="ju-var">b</span></a></span><span class="ju-delimiter">;</span>
        <span class="ju-keyword">in</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:209" class="ju-code-link ju-function"><span class="ju-function">countNodes</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:208" class="ju-code-link ju-var"><span class="ju-var">prog</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
  <span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>

<span class="ju-keyword">instance</span>
<span id="Nockma:223"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:223" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:223" class="ju-code-link ju-function"><span class="ju-function">NockmaVM</span></a></span></a></span></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/arch/system/state/resource_machine/notes/function_formats/transactionfunction-src.html#arch.system.state.resource_machine.notes.function_formats.transactionfunction:3" class="ju-code-link ju-inductive"><span class="ju-inductive">TransactionVM</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:24" class="ju-code-link ju-var"><span class="ju-inductive"><span class="ju-delimiter">(</span>Option</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Noun</span></a></span> <span class="ju-keyword">:=</span>
  <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/arch/system/state/resource_machine/notes/function_formats/transactionfunction-src.html#arch.system.state.resource_machine.notes.function_formats.transactionfunction:4" class="ju-code-link ju-constructor"><span class="ju-constructor">mkTransactionVM</span></a></span><span class="ju-keyword">@</span><span class="ju-delimiter">{</span>
    <span id="Nockma:217"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:217" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:217" class="ju-code-link ju-function"><span class="ju-function">txFunc</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:216" class="ju-code-link ju-function"><span class="ju-function">NockmaTransactionFunction</span></a></span><span class="ju-delimiter">;</span>
    <span id="Nockma:222"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:222" class="ju-code-link ju-function"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:222" class="ju-code-link ju-function"><span class="ju-function">eval</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="Nockma:218"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:218" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:218" class="ju-code-link ju-var"><span class="ju-var">prog</span></a></span></a></span></span> <span id="Nockma:219"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:219" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:219" class="ju-code-link ju-var"><span class="ju-var">gas</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
        <span class="ju-keyword">case</span>
          <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:65" class="ju-code-link ju-function"><span class="ju-function">GasState<span class="ju-delimiter">.</span>runGasState</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:74" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>nock</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:13" class="ju-code-link ju-axiom"><span class="ju-axiom"><span class="ju-delimiter">(</span>externalStorage</span></a></span> <span class="ju-delimiter">{</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span><span class="ju-delimiter">}</span> <span class="ju-delimiter">{</span><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Juvix/Builtin/V1/Nat/Base-src.html#Juvix.Builtin.V1.Nat.Base:1" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:218" class="ju-code-link ju-var"><span class="ju-var">prog</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:219" class="ju-code-link ju-var"><span class="ju-var">gas</span></a></span>
        <span class="ju-keyword">of</span>
          <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:3" class="ju-code-link ju-constructor"><span class="ju-constructor">ok</span></a></span> <span id="Nockma:220"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:220" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:220" class="ju-code-link ju-var"><span class="ju-var">result</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:3" class="ju-code-link ju-constructor"><span class="ju-constructor">ok</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/prelude-src.html#prelude:8" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>fst</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:220" class="ju-code-link ju-var"><span class="ju-var">result</span></a></span><span class="ju-delimiter">)</span>
          <span class="ju-keyword">|</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:2" class="ju-code-link ju-constructor"><span class="ju-constructor">error</span></a></span> <span id="Nockma:221"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:221" class="ju-code-link ju-var"><span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:221" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Stdlib/Data/Result/Base-src.html#Stdlib.Data.Result.Base:2" class="ju-code-link ju-constructor"><span class="ju-constructor">error</span></a></span> <span class="annot"><a href="https://anoma.github.io/nspec/pr-289/Nockma-src.html#Nockma:221" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
  <span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
</pre><footer><pre>Powered by <a href="https://juvix.org">Juvix </a><a href="https://github.com/anoma/juvix/commit/bebe3d1">0.6.8-bebe3d1</a></pre></footer><footer><pre>Last modified on 2024-12-19 15:54 UTC</pre></footer></html>