
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="The Anoma specs is a collection of documents that describe the architecture, design, and implementation of the Anoma Network." name="description"/>
<meta content="Anoma Foundation" name="author"/>
<link href="https://specs.anoma.net/pr-374/arch/system/state/resource_machine/notes/nockma.juvix.html" rel="canonical"/>
<link href="runnable.html" rel="prev"/>
<link href="nockma_runnable.html" rel="next"/>
<link href="../../../../../assets/logo.svg" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.12" name="generator"/>
<title>Nockma implementation - Anoma specs</title>
<link href="../../../../../assets/stylesheets/main.2afb09e1.min.css" rel="stylesheet"/>
<link href="../../../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
<link href="../../../../../assets/css/juvix-material-style.css" rel="stylesheet"/>
<link href="../../../../../assets/css/juvix-highlighting.css" rel="stylesheet"/>
<link href="../../../../../assets/css/juvix_codeblock_footer.css" rel="stylesheet"/>
<link href="../../../../../assets/css/latte-light.css" rel="stylesheet"/>
<link href="../../../../../assets/css/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../../../assets/javascripts/glightbox.min.js"></script></link></head>
<body data-md-color-accent="indigo" data-md-color-primary="white" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#nockma-implementation">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
<aside class="md-banner">
<div class="md-banner__inner md-grid md-typeset">
<button aria-label="Don't show this again" class="md-banner__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
            
            
  For updates follow <strong>@anoma</strong> on
  <a href="https://x.com/anoma" rel="me">
<span class="twemoji x-twitter">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"></path></svg>
</span>
<strong></strong>
</a>
  and discuss on our
  <a href="https://research.anoma.net">
<span class="twemoji discourse">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M225.9 32C103.3 32 0 130.5 0 252.1 0 256 .1 480 .1 480l225.8-.2c122.7 0 222.1-102.3 222.1-223.9S348.6 32 225.9 32M224 384c-19.4 0-37.9-4.3-54.4-12.1L88.5 392l22.9-75c-9.8-18.1-15.4-38.9-15.4-61 0-70.7 57.3-128 128-128s128 57.3 128 128-57.3 128-128 128"></path></svg>
</span>
<strong>forum</strong>
</a>
</div>
<script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script>
</aside>
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Anoma specs" class="md-header__button md-logo" data-md-component="logo" href="../../../../../index.html" title="Anoma specs">
<img alt="logo" src="../../../../../assets/logo.svg"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
<span class="first-letter">A</span>noma 
              
                <span class="first-letter">s</span>pecs
              
              
                <span class="md-header__topic-version">(PR 374)</span>
</span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
              
                Nockma implementation
              
            </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme)" data-md-color-primary="white" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="red" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="white" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to system preference" class="md-option" data-md-color-accent="red" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to system preference">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M10.68 11.74a6 6 0 0 1-7.922-8.982 6 6 0 0 1 8.982 7.922l3.04 3.04a.749.749 0 0 1-.326 1.275.75.75 0 0 1-.734-.215ZM11.5 7a4.499 4.499 0 1 0-8.997 0A4.499 4.499 0 0 0 11.5 7"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M10.68 11.74a6 6 0 0 1-7.922-8.982 6 6 0 0 1 8.982 7.922l3.04 3.04a.749.749 0 0 1-.326 1.275.75.75 0 0 1-.734-.215ZM11.5 7a4.499 4.499 0 1 0-8.997 0A4.499 4.499 0 0 0 11.5 7"></path></svg>
<svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7.78 12.53a.75.75 0 0 1-1.06 0L2.47 8.28a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042L4.81 7h7.44a.75.75 0 0 1 0 1.5H4.81l2.97 2.97a.75.75 0 0 1 0 1.06"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/anoma/nspec" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    anoma/nspec
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<!--
  This is a modified version of the original mkdocs-material theme.
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->
<!-- Determine classes -->
<!-- Navigation -->
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<!-- Site title -->
<label class="md-nav__title" for="__drawer">
<a aria-label="Anoma specs" class="md-nav__button md-logo" data-md-component="logo" href="../../../../../index.html" title="Anoma specs">
<img alt="logo" src="../../../../../assets/logo.svg"/>
</a>
    Anoma specs
  </label>
<!-- List of Versions -->
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="https://specs.anoma.net/latest" target="_blank">
     Latest version ((PR 374))
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="https://specs.anoma.net/main">
        Development version
      </a>
</li>
</ul>
<!-- Navigation list -->
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../index.html">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg>
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../overview.html">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M24 18.714v4.8c0 .288-.192.48-.48.48h-4.8c-.288 0-.48-.192-.48-.48v-4.8c0-.288.192-.48.48-.48h1.92v-1.92h-8.16v1.92h1.92c.288 0 .48.192.48.48v4.8c0 .288-.192.48-.48.48H9.6c-.288 0-.48-.192-.48-.48v-4.8c0-.288.192-.48.48-.48h1.92v-1.92H3.36v1.92h1.92c.288 0 .48.192.48.48v4.8c0 .288-.192.48-.48.48H.48c-.288 0-.48-.192-.48-.48v-4.8c0-.288.192-.48.48-.48H2.4v-2.4c0-.288.192-.48.48-.48h8.64v-1.44h.96v1.44h8.64c.288 0 .48.192.48.48v2.4h1.92c.288 0 .48.192.48.48m-13.92 4.32h3.84v-3.84h-3.84zm-9.12 0H4.8v-3.84H.96Zm18.24 0h3.84v-3.84H19.2ZM6.24 9.642V3.546c0-.192.096-.336.24-.432L11.76.042a.8.8 0 0 1 .48 0l5.28 3.072c.144.096.24.24.24.432v6.096c0 .144-.096.288-.24.384l-5.28 3.072q-.096.048-.24.048t-.24-.048l-5.28-3.072c-.144-.096-.24-.24-.24-.384m10.56-.288V4.362l-4.32 2.496v4.992zm-9.6 0 4.32 2.496V6.858L7.2 4.362Zm.48-5.808L12 5.994l4.32-2.448L12 1.05Z"></path></svg>
<span class="md-ellipsis">
    Anoma architecture
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../changelog.html">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.5c-1.35-.85-3.8-1.5-5.5-1.5-1.65 0-3.35.3-4.75 1.05-.1.05-.15.05-.25.05-.25 0-.5-.25-.5-.5V6c.6-.45 1.25-.75 2-1 1.11-.35 2.33-.5 3.5-.5 1.95 0 4.05.4 5.5 1.5 1.45-1.1 3.55-1.5 5.5-1.5 1.17 0 2.39.15 3.5.5.75.25 1.4.55 2 1v14.6c0 .25-.25.5-.5.5-.1 0-.15 0-.25-.05-1.4-.75-3.1-1.05-4.75-1.05-1.7 0-4.15.65-5.5 1.5M12 8v11.5c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5V7c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5m1 3.5c1.11-.68 2.6-1 4.5-1 .91 0 1.76.09 2.5.28V9.23c-.87-.15-1.71-.23-2.5-.23q-2.655 0-4.5.84zm4.5.17c-1.71 0-3.21.26-4.5.79v1.69c1.11-.65 2.6-.99 4.5-.99 1.04 0 1.88.08 2.5.24v-1.5c-.87-.16-1.71-.23-2.5-.23m2.5 2.9c-.87-.16-1.71-.24-2.5-.24-1.83 0-3.33.27-4.5.8v1.69c1.11-.66 2.6-.99 4.5-.99 1.04 0 1.88.08 2.5.24z"></path></svg>
<span class="md-ellipsis">
    Changelog
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
<span class="md-ellipsis">
    Indexes
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Indexes
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../indexes/tags.html">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5.5 7A1.5 1.5 0 0 1 4 5.5 1.5 1.5 0 0 1 5.5 4 1.5 1.5 0 0 1 7 5.5 1.5 1.5 0 0 1 5.5 7m15.91 4.58-9-9C12.05 2.22 11.55 2 11 2H4c-1.11 0-2 .89-2 2v7c0 .55.22 1.05.59 1.41l8.99 9c.37.36.87.59 1.42.59s1.05-.23 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.56-.23-1.06-.59-1.42"></path></svg>
<span class="md-ellipsis">
    List of tags
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../indexes/modules.html">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 10h-2V8h2m0 5h-2v-2h2m-3-1h-2V8h2m0 5h-2v-2h2m0 6H8v-2h8m-9-5H5V8h2m0 5H5v-2h2m1 0h2v2H8m0-5h2v2H8m3 1h2v2h-2m0-5h2v2h-2m9-5H4c-1.11 0-2 .89-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2"></path></svg>
<span class="md-ellipsis">
    List of modules
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../../prelude.html">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm0 2h7v5h5v11H6zm2 8v2h8v-2zm0 4v2h5v-2z"></path></svg>
<span class="md-ellipsis">
    List of basic types
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
<span class="md-ellipsis">
    Node architecture
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Node architecture
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../node/concepts/engine.html">
<span class="md-ellipsis">
    Concepts
    
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../node/types/anoma_message.html">
<span class="md-ellipsis">
    Types
    
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../node/subsystems/hardware.html">
<span class="md-ellipsis">
    Subsystems
    
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../node/integration/simulator.html">
<span class="md-ellipsis">
    Integration
    
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
<span class="md-ellipsis">
    System architecture
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            System architecture
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../identity/identity.html">
<span class="md-ellipsis">
    Identity Architecture
    
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_6_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
<span class="md-ellipsis">
    State Architecture
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_6_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_2">
<span class="md-nav__icon md-icon"></span>
            State Architecture
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_6_2_1" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../index.html">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm0 2h7v5h5v11H6zm2 8v2h8v-2zm0 4v2h5v-2z"></path></svg>
<span class="md-ellipsis">
    Resource Machine
    
  </span>
</a>
<label class="md-nav__link" for="__nav_6_2_1" id="__nav_6_2_1_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_6_2_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_6_2_1">
<span class="md-nav__icon md-icon"></span>
            Resource Machine
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../primitive_interfaces/index.html">
<span class="md-ellipsis">
    Primitive interfaces
    
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../data_structures/resource/index.html">
<span class="md-ellipsis">
    Data structures
    
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../execution_flow/flow.html">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm0 2h7v5h5v11H6zm2 8v2h8v-2zm0 4v2h5v-2z"></path></svg>
<span class="md-ellipsis">
    Execution flow
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_6_2_1_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_2_1_5" id="__nav_6_2_1_5_label" tabindex="0">
<span class="md-ellipsis">
    Notes
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_6_2_1_5_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_6_2_1_5">
<span class="md-nav__icon md-icon"></span>
            Notes
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="roles_and_requirements.html">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm0 2h7v5h5v11H6zm2 8v2h8v-2zm0 4v2h5v-2z"></path></svg>
<span class="md-ellipsis">
    Roles and requirements
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="storage.html">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm0 2h7v5h5v11H6zm2 8v2h8v-2zm0 4v2h5v-2z"></path></svg>
<span class="md-ellipsis">
    Stored data format
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="function_formats/transaction_function_format.html">
<span class="md-ellipsis">
    Function formats
    
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="applications.html">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm0 2h7v5h5v11H6zm2 8v2h8v-2zm0 4v2h5v-2z"></path></svg>
<span class="md-ellipsis">
    Applications
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="runnable.html">
<span class="md-ellipsis">
    Runnable trait
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm0 2h7v5h5v11H6zm2 8v2h8v-2zm0 4v2h5v-2z"></path></svg>
<span class="md-ellipsis">
    Nockma implementation
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="nockma.html">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm0 2h7v5h5v11H6zm2 8v2h8v-2zm0 4v2h5v-2z"></path></svg>
<span class="md-ellipsis">
    Nockma implementation
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#core-data-types">
<span class="md-ellipsis">
      Core Data Types
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pretty-printer-for-noun">
<span class="md-ellipsis">
      Pretty-printer for Noun
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#storage-system-and-operation-types">
<span class="md-ellipsis">
      Storage System and Operation Types
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gas-state-monad">
<span class="md-ellipsis">
      Gas State Monad
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gas-management-and-storage-operations">
<span class="md-ellipsis">
      Gas Management and Storage Operations
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#helper-operations">
<span class="md-ellipsis">
      Helper Operations
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#operation-evaluator">
<span class="md-ellipsis">
      Operation Evaluator
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#core-nockma-evaluator">
<span class="md-ellipsis">
      Core Nockma Evaluator
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="nockma_runnable.html">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm0 2h7v5h5v11H6zm2 8v2h8v-2zm0 4v2h5v-2z"></path></svg>
<span class="md-ellipsis">
    Nockma runnable
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
<span class="md-ellipsis">
    Integrations
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            Integrations
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../integrations/adapters/index.html">
<span class="md-ellipsis">
    Protocol Adapters
    
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
<span class="md-ellipsis">
    Tutorials
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../../../tutorial/principles_and_guidelines.html">
<span class="md-ellipsis">
    Contributor guidelines
    
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#core-data-types">
<span class="md-ellipsis">
      Core Data Types
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pretty-printer-for-noun">
<span class="md-ellipsis">
      Pretty-printer for Noun
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#storage-system-and-operation-types">
<span class="md-ellipsis">
      Storage System and Operation Types
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gas-state-monad">
<span class="md-ellipsis">
      Gas State Monad
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gas-management-and-storage-operations">
<span class="md-ellipsis">
      Gas Management and Storage Operations
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#helper-operations">
<span class="md-ellipsis">
      Helper Operations
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#operation-evaluator">
<span class="md-ellipsis">
      Operation Evaluator
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#core-nockma-evaluator">
<span class="md-ellipsis">
      Core Nockma Evaluator
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<!--
  This is a modified version of the original mkdocs-material theme.
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->
<!-- Tags -->
<!-- Actions -->
<!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->
<!-- Actions -->
<!-- Edit button -->
<a class="md-content__button md-icon" href="https://github.com/anoma/nspec/edit/main/docs/arch/system/state/resource_machine/notes/nockma.juvix.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6 2c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-1.9l10-10V8l-6-6zm7 1.5L18.5 9H13zm7.1 9.5c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-2 1.8L12 20.9V23h2.1l6.1-6.1z"></path></svg>
</a>
<!-- View button -->
<a class="md-content__button md-icon" href="https://github.com/anoma/nspec/raw/main/docs/arch/system/state/resource_machine/notes/nockma.juvix.md" title="View source of this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.56 18H3.44C2.65 18 2 17.37 2 16.59V7.41C2 6.63 2.65 6 3.44 6h17.12c.79 0 1.44.63 1.44 1.41v9.18c0 .78-.65 1.41-1.44 1.41M6.81 15.19v-3.66l1.92 2.35 1.92-2.35v3.66h1.93V8.81h-1.93l-1.92 2.35-1.92-2.35H4.89v6.38zM19.69 12h-1.92V8.81h-1.92V12h-1.93l2.89 3.28z"></path></svg>
</a>
<!-- If the page source ends with .juvix.md, we show a button to view the raw code -->
<a class="md-content__button md-icon" href="arch/system/state/resource_machine/notes/nockma-src.html" title="View Raw Juvix Code">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8 3a2 2 0 0 0-2 2v4a2 2 0 0 1-2 2H3v2h1a2 2 0 0 1 2 2v4a2 2 0 0 0 2 2h2v-2H8v-5a2 2 0 0 0-2-2 2 2 0 0 0 2-2V5h2V3m6 0a2 2 0 0 1 2 2v4a2 2 0 0 0 2 2h1v2h-1a2 2 0 0 0-2 2v4a2 2 0 0 1-2 2h-2v-2h2v-5a2 2 0 0 1 2-2 2 2 0 0 1-2-2V5h-2V3z"></path></svg>
</a>
<!--
  Hack: check whether the content contains a h1 headline. If it doesn't, the
  page title (or respectively site name) is used as the main headline.
-->
<!-- Page content -->
<details class="quote">
<summary>Juvix imports</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-0-1">module arch.system.state.resource_machine.notes.nockma;
</span><span id="__ispan-0-2">import prelude open;
</span><span id="__ispan-0-3">import Stdlib.Data.Nat open;
</span><span id="__ispan-0-4">import Stdlib.Data.List open;
</span><span id="__ispan-0-5">import Stdlib.Trait.Show open;
</span></code></pre></div>
</details>
<h1 id="nockma-implementation">Nockma Implementation<a class="headerlink" href="#nockma-implementation" title="Anchor link to this section for reference">¶</a></h1>
<table>
<thead>
<tr>
<th>Operation Code</th>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Slash (/)</td>
<td>Address/path selection</td>
</tr>
<tr>
<td>1</td>
<td>Constant</td>
<td>Returns operand unchanged</td>
</tr>
<tr>
<td>2</td>
<td>Apply/Ap/S</td>
<td>Function application</td>
</tr>
<tr>
<td>3</td>
<td>Cell test (?)</td>
<td>Tests if noun is cell</td>
</tr>
<tr>
<td>4</td>
<td>Increment (+)</td>
<td>Add 1 to atom</td>
</tr>
<tr>
<td>5</td>
<td>Equality test (=)</td>
<td>Compare nouns</td>
</tr>
<tr>
<td>6</td>
<td>If-then-else</td>
<td>Conditional execution</td>
</tr>
<tr>
<td>7</td>
<td>Compose</td>
<td>Function composition</td>
</tr>
<tr>
<td>8</td>
<td>Extend subject</td>
<td>Extends the subject</td>
</tr>
<tr>
<td>9</td>
<td>Invoke</td>
<td>Call function by arm name</td>
</tr>
<tr>
<td>10</td>
<td>Pound (#)</td>
<td>Handle operation</td>
</tr>
<tr>
<td>11</td>
<td>Match</td>
<td>Case split on Cells vs Atoms</td>
</tr>
<tr>
<td>12</td>
<td>Scry</td>
<td>Read storage</td>
</tr>
</tbody>
</table>
<h2 id="core-data-types">Core Data Types<a class="headerlink" href="#core-data-types" title="Anchor link to this section for reference">¶</a></h2>
<p>The fundamental data structures for Nockma implementation, including the <code>Noun</code>
type that represents all data in Nock, along with equality and display
instances.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-1-1">-- Basic Nock types
</span><span id="__ispan-1-2">type Noun :=
</span><span id="__ispan-1-3">  | Atom : Nat -&gt; Noun
</span><span id="__ispan-1-4">  | Cell : Noun -&gt; Noun -&gt; Noun;
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-2-1">terminating
</span><span id="__ispan-2-2">nounEq (n1 n2 : Noun) : Bool :=
</span><span id="__ispan-2-3">  case mkPair n1 n2 of {
</span><span id="__ispan-2-4">    | mkPair (Noun.Atom x) (Noun.Atom y) := x == y
</span><span id="__ispan-2-5">    | mkPair (Noun.Cell a b) (Noun.Cell c d) := nounEq a c &amp;&amp; nounEq b d
</span><span id="__ispan-2-6">    | _ := false
</span><span id="__ispan-2-7">  };
</span><span id="__ispan-2-8">
</span><span id="__ispan-2-9">instance EqNoun : Eq Noun := Eq.mk@{ isEqual := nounEq };
</span></code></pre></div>
<h2 id="pretty-printer-for-noun">Pretty-printer for Noun<a class="headerlink" href="#pretty-printer-for-noun" title="Anchor link to this section for reference">¶</a></h2>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-3-1">terminating
</span><span id="__ispan-3-2">showNoun (n : Noun) : String :=
</span><span id="__ispan-3-3">  case n of {
</span><span id="__ispan-3-4">    | Noun.Atom a := natToString a
</span><span id="__ispan-3-5">    | Noun.Cell l r := "[" ++str (showNoun l) ++str " " ++str (showNoun r) ++str "]"
</span><span id="__ispan-3-6">  };
</span><span id="__ispan-3-7">
</span><span id="__ispan-3-8">instance ShowNoun : Show Noun := Show.mk@{ show := showNoun };
</span></code></pre></div>
<h2 id="storage-system-and-operation-types">Storage System and Operation Types<a class="headerlink" href="#storage-system-and-operation-types" title="Anchor link to this section for reference">¶</a></h2>
<p>Storage abstraction for scrying operations and the enumeration of all Nock
operations with their corresponding opcodes.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-4-1">-- Helper to convert storage values to Nouns
</span><span id="__ispan-4-2">axiom convertToNoun : {val : Type} -&gt; val -&gt; Noun;
</span><span id="__ispan-4-3">-- Helper to convert Nouns to storage values
</span><span id="__ispan-4-4">axiom convertFromNoun : {val : Type} -&gt; Noun -&gt; Option val;
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-5-1">type ScryOp :=
</span><span id="__ispan-5-2">  | Direct
</span><span id="__ispan-5-3">  | Index;
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-6-1">type Storage addr val := mkStorage {
</span><span id="__ispan-6-2">  readDirect : addr -&gt; Option val;
</span><span id="__ispan-6-3">  readIndex : val -&gt; Option val
</span><span id="__ispan-6-4">};
</span><span id="__ispan-6-5">
</span><span id="__ispan-6-6">emptyStorage {addr val : Type} : Storage addr val :=
</span><span id="__ispan-6-7">  Storage.mkStorage@{
</span><span id="__ispan-6-8">    readDirect := \{_ := none};
</span><span id="__ispan-6-9">    readIndex := \{_ := none};
</span><span id="__ispan-6-10">  };
</span><span id="__ispan-6-11">
</span><span id="__ispan-6-12">axiom externalStorage : {addr val : Type} -&gt; Storage addr val;
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-7-1">type NockOp :=
</span><span id="__ispan-7-2">  | Slash -- /
</span><span id="__ispan-7-3">  | Constant -- Returns operand unchanged
</span><span id="__ispan-7-4">  | Apply
</span><span id="__ispan-7-5">  | CellTest -- ?
</span><span id="__ispan-7-6">  | Increment -- +
</span><span id="__ispan-7-7">  | EqualOp -- =
</span><span id="__ispan-7-8">  | IfThenElse -- 6
</span><span id="__ispan-7-9">  | Compose -- 7
</span><span id="__ispan-7-10">  | Extend -- 8
</span><span id="__ispan-7-11">  | Invoke -- 9
</span><span id="__ispan-7-12">  | Pound -- #
</span><span id="__ispan-7-13">  | Match -- 11
</span><span id="__ispan-7-14">  | Scry; -- 12
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-8-1">opOr {A : Type} (n m : Option A) : Option A :=
</span><span id="__ispan-8-2">  case n of {
</span><span id="__ispan-8-3">    | none := m
</span><span id="__ispan-8-4">    | (some n) := some n
</span><span id="__ispan-8-5">  };
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-9-1">parseOp (n : Nat) : Option NockOp :=
</span><span id="__ispan-9-2">  let test := \{m op :=
</span><span id="__ispan-9-3">    case (n == m) of {
</span><span id="__ispan-9-4">      | true := some op
</span><span id="__ispan-9-5">      | false := none
</span><span id="__ispan-9-6">    }} in
</span><span id="__ispan-9-7">  foldr opOr none
</span><span id="__ispan-9-8">    (zipWith test
</span><span id="__ispan-9-9">      [0; 1; 2; 3; 4; 5; 6; 7; 8; 9; 10; 11; 12]
</span><span id="__ispan-9-10">      [NockOp.Slash; NockOp.Constant; NockOp.Apply; NockOp.CellTest; NockOp.Increment;
</span><span id="__ispan-9-11">      NockOp.EqualOp; NockOp.IfThenElse; NockOp.Compose; NockOp.Extend; NockOp.Invoke;
</span><span id="__ispan-9-12">      NockOp.Pound; NockOp.Match; NockOp.Scry]);
</span></code></pre></div>
<h2 id="gas-state-monad">Gas State Monad<a class="headerlink" href="#gas-state-monad" title="Anchor link to this section for reference">¶</a></h2>
<p>A monadic framework for tracking gas consumption and handling errors during Nock
evaluation. This ensures computations can be bounded and failures can be
properly handled.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-10-1">-- Monad to encompass gas consumption and error handling.
</span><span id="__ispan-10-2">type GasState A := mk {
</span><span id="__ispan-10-3">  runGasState : Nat -&gt; Result String (Pair A Nat)
</span><span id="__ispan-10-4">};
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-11-1">instance
</span><span id="__ispan-11-2">GasStateMonad : Monad GasState := Monad.mk@{
</span><span id="__ispan-11-3">  applicative := Applicative.mk@{
</span><span id="__ispan-11-4">    functor := Functor.mk@{
</span><span id="__ispan-11-5">      map := \{f s := GasState.mk \{gas :=
</span><span id="__ispan-11-6">        case GasState.runGasState s gas of {
</span><span id="__ispan-11-7">          | ok (mkPair x remaining) := ok (mkPair (f x) remaining)
</span><span id="__ispan-11-8">          | error e := error e
</span><span id="__ispan-11-9">        }}
</span><span id="__ispan-11-10">    }};
</span><span id="__ispan-11-11">    pure := \{x := GasState.mk \{gas := ok (mkPair x gas)}};
</span><span id="__ispan-11-12">    ap := \{sf sa := GasState.mk \{gas :=
</span><span id="__ispan-11-13">      case GasState.runGasState sf gas of {
</span><span id="__ispan-11-14">        | ok (mkPair f remaining) :=
</span><span id="__ispan-11-15">          case GasState.runGasState sa remaining of {
</span><span id="__ispan-11-16">            | ok (mkPair x final) := ok (mkPair (f x) final)
</span><span id="__ispan-11-17">            | error e := error e
</span><span id="__ispan-11-18">          }
</span><span id="__ispan-11-19">        | error e := error e
</span><span id="__ispan-11-20">      }}
</span><span id="__ispan-11-21">    }
</span><span id="__ispan-11-22">  };
</span><span id="__ispan-11-23">  bind := \{ma f := GasState.mk \{gas :=
</span><span id="__ispan-11-24">    case GasState.runGasState ma gas of {
</span><span id="__ispan-11-25">      | ok (mkPair a remaining) := GasState.runGasState (f a) remaining
</span><span id="__ispan-11-26">      | error e := error e
</span><span id="__ispan-11-27">    }}
</span><span id="__ispan-11-28">  }
</span><span id="__ispan-11-29">};
</span><span id="__ispan-11-30">
</span><span id="__ispan-11-31">err {A : Type} (str : String) : GasState A := GasState.mk \{_ := error str};
</span></code></pre></div>
<h2 id="gas-management-and-storage-operations">Gas Management and Storage Operations<a class="headerlink" href="#gas-management-and-storage-operations" title="Anchor link to this section for reference">¶</a></h2>
<p>Functions for managing computational costs and implementing storage read
operations (scrying) that allow Nock programs to interact with external data.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-12-1">-- Gas cost values for each operation type
</span><span id="__ispan-12-2">-- These are made up for demo purposes
</span><span id="__ispan-12-3">getGasCost (cost : NockOp) : Nat :=
</span><span id="__ispan-12-4">  case cost of {
</span><span id="__ispan-12-5">    | NockOp.Slash := 1
</span><span id="__ispan-12-6">    | NockOp.CellTest := 1
</span><span id="__ispan-12-7">    | NockOp.Increment := 1
</span><span id="__ispan-12-8">    | NockOp.EqualOp := 2
</span><span id="__ispan-12-9">    | NockOp.IfThenElse := 3
</span><span id="__ispan-12-10">    | NockOp.Compose := 2
</span><span id="__ispan-12-11">    | NockOp.Extend := 2
</span><span id="__ispan-12-12">    | NockOp.Invoke := 3
</span><span id="__ispan-12-13">    | NockOp.Pound := 1
</span><span id="__ispan-12-14">    | NockOp.Scry := 10
</span><span id="__ispan-12-15">    | _ := 0
</span><span id="__ispan-12-16">  };
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-13-1">consume (op : NockOp) : GasState Unit :=
</span><span id="__ispan-13-2">  GasState.mk \{gas :=
</span><span id="__ispan-13-3">  let cost := getGasCost op in
</span><span id="__ispan-13-4">  case cost &gt; gas of {
</span><span id="__ispan-13-5">    | true := error "Out of gas"
</span><span id="__ispan-13-6">    | false := ok (mkPair unit (sub gas cost))
</span><span id="__ispan-13-7">  }};
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-14-1">-- Implementation of storage read operations (scrying)
</span><span id="__ispan-14-2">scry {val : Type} (stor : Storage Nat val) (op : ScryOp) (addr : Nat) : Result String Noun :=
</span><span id="__ispan-14-3">  case op of {
</span><span id="__ispan-14-4">    | ScryOp.Direct := case Storage.readDirect stor addr of {
</span><span id="__ispan-14-5">      | some val := ok (convertToNoun val)
</span><span id="__ispan-14-6">      | none := error "Direct storage read failed"
</span><span id="__ispan-14-7">    }
</span><span id="__ispan-14-8">    | ScryOp.Index := case Storage.readDirect stor addr of {
</span><span id="__ispan-14-9">      | some indexFn := case Storage.readIndex stor indexFn of {
</span><span id="__ispan-14-10">        | some val := ok (convertToNoun val)
</span><span id="__ispan-14-11">        | none := error "Index computation failed"
</span><span id="__ispan-14-12">      }
</span><span id="__ispan-14-13">      | none := error "Index function not found"
</span><span id="__ispan-14-14">    }
</span><span id="__ispan-14-15">  };
</span></code></pre></div>
<h2 id="helper-operations">Helper Operations<a class="headerlink" href="#helper-operations" title="Anchor link to this section for reference">¶</a></h2>
<p>Implementation of the fundamental slash (<code>/</code>) and pound (<code>#</code>) operations that
provide tree navigation and editing capabilities respectively.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-15-1">-- Helper for slash (/) operations
</span><span id="__ispan-15-2">terminating
</span><span id="__ispan-15-3">slash {val : Type} (stor : Storage Nat val) (n : Noun) (subject : Noun) : GasState Noun :=
</span><span id="__ispan-15-4">  case n of {
</span><span id="__ispan-15-5">    | Noun.Atom x := case x == 1 of {
</span><span id="__ispan-15-6">      | true := pure subject -- Rule: /[1 a] -&gt; a
</span><span id="__ispan-15-7">      | false := case x == 2 of {
</span><span id="__ispan-15-8">        | true := case subject of { -- Rule: /[2 a b] -&gt; a
</span><span id="__ispan-15-9">          | Noun.Cell a _ := pure a
</span><span id="__ispan-15-10">          | _ := err ("Cannot take slash (/2) of atom: " ++str (showNoun subject))
</span><span id="__ispan-15-11">        }
</span><span id="__ispan-15-12">        | false := case x == 3 of {
</span><span id="__ispan-15-13">          | true := case subject of { -- Rule: /[3 a b] -&gt; b
</span><span id="__ispan-15-14">            | Noun.Cell _ b := pure b
</span><span id="__ispan-15-15">            | _ := err ("Cannot take slash (/3) of atom: " ++str (showNoun subject))
</span><span id="__ispan-15-16">          }
</span><span id="__ispan-15-17">          | false := case (mod x 2) == 0 of {
</span><span id="__ispan-15-18">            | true :=  -- Rule: /[(a + a) b] -&gt; /[2 /[a b]]
</span><span id="__ispan-15-19">                consume NockOp.Slash &gt;&gt;= \{_ :=
</span><span id="__ispan-15-20">                slash stor (Noun.Atom (div x 2)) subject &gt;&gt;= \{res :=
</span><span id="__ispan-15-21">                consume NockOp.Slash &gt;&gt;= \{_ :=
</span><span id="__ispan-15-22">                slash stor (Noun.Atom 2) res
</span><span id="__ispan-15-23">                }}}
</span><span id="__ispan-15-24">            | false := -- Rule: /[(a + a + 1) b] -&gt; /[3 /[a b]]
</span><span id="__ispan-15-25">                consume NockOp.Slash &gt;&gt;= \{_ :=
</span><span id="__ispan-15-26">                slash stor (Noun.Atom (div x 2)) subject &gt;&gt;= \{res :=
</span><span id="__ispan-15-27">                consume NockOp.Slash &gt;&gt;= \{_ :=
</span><span id="__ispan-15-28">                slash stor (Noun.Atom 3) res
</span><span id="__ispan-15-29">                }}}
</span><span id="__ispan-15-30">          }
</span><span id="__ispan-15-31">        }
</span><span id="__ispan-15-32">      }
</span><span id="__ispan-15-33">    }
</span><span id="__ispan-15-34">    | _ := err ("Slash axis must be atom, got: " ++str (showNoun n))
</span><span id="__ispan-15-35">  };
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-16-1">-- Helper for pound (#) operations
</span><span id="__ispan-16-2">terminating
</span><span id="__ispan-16-3">pound {val : Type} (stor : Storage Nat val) (n : Noun) (b : Noun) (c : Noun) : GasState Noun :=
</span><span id="__ispan-16-4">  case n of {
</span><span id="__ispan-16-5">    | Noun.Atom x := case x == 1 of {
</span><span id="__ispan-16-6">      | true := pure b  -- Rule: #[1 a b] -&gt; a
</span><span id="__ispan-16-7">      | false := case mod x 2 == 0 of {
</span><span id="__ispan-16-8">        | true := case c of { -- Rule: #[(a + a) b c] -&gt; #[a [b /[(a + a + 1) c]] c]
</span><span id="__ispan-16-9">          | Noun.Cell _ _ :=
</span><span id="__ispan-16-10">            consume NockOp.Slash &gt;&gt;= \{_ :=
</span><span id="__ispan-16-11">            slash stor (Noun.Atom ((2 * div x 2) + 1)) c &gt;&gt;= \{slashResult :=
</span><span id="__ispan-16-12">            consume NockOp.Pound &gt;&gt;= \{_ :=
</span><span id="__ispan-16-13">            pound stor (Noun.Atom (div x 2)) (Noun.Cell b slashResult) c
</span><span id="__ispan-16-14">            }}}
</span><span id="__ispan-16-15">          | _ := err ("Invalid pound target (must be cell): " ++str (showNoun c))
</span><span id="__ispan-16-16">        }
</span><span id="__ispan-16-17">        | false := case c of { -- Rule: #[(a + a + 1) b c] -&gt; #[a [/[(a + a) c] b] c]
</span><span id="__ispan-16-18">          | Noun.Cell _ _ :=
</span><span id="__ispan-16-19">            consume NockOp.Slash &gt;&gt;= \{_ :=
</span><span id="__ispan-16-20">            slash stor (Noun.Atom (2 * div x 2)) c &gt;&gt;= \{slashResult :=
</span><span id="__ispan-16-21">            consume NockOp.Pound &gt;&gt;= \{_ :=
</span><span id="__ispan-16-22">            pound stor (Noun.Atom (div x 2)) (Noun.Cell slashResult b) c
</span><span id="__ispan-16-23">            }}}
</span><span id="__ispan-16-24">          | _ := err ("Invalid pound target (must be cell): " ++str (showNoun c))
</span><span id="__ispan-16-25">        }
</span><span id="__ispan-16-26">      }
</span><span id="__ispan-16-27">    }
</span><span id="__ispan-16-28">    | _ := err ("Pound axis must be atom, got: " ++str (showNoun n))
</span><span id="__ispan-16-29">  };
</span></code></pre></div>
<h2 id="operation-evaluator">Operation Evaluator<a class="headerlink" href="#operation-evaluator" title="Anchor link to this section for reference">¶</a></h2>
<p>The main dispatcher that handles evaluation of each Nock operation according to
the Nock specification. Each case implements one of the 13 fundamental Nock
operations.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-17-1">terminating
</span><span id="__ispan-17-2">evalOp
</span><span id="__ispan-17-3">  {val : Type} (stor : Storage Nat val) (op : NockOp) (a : Noun) (args : Noun) : GasState Noun :=
</span><span id="__ispan-17-4">  case op of {
</span><span id="__ispan-17-5">    -- *[a 0 b] -&gt; /[b a]
</span><span id="__ispan-17-6">    | NockOp.Slash := slash stor args a
</span><span id="__ispan-17-7">
</span><span id="__ispan-17-8">    -- *[a 1 b] -&gt; b
</span><span id="__ispan-17-9">    | NockOp.Constant := pure args
</span><span id="__ispan-17-10">
</span><span id="__ispan-17-11">    -- *[a 2 b c] -&gt; *[*[a b] *[a c]]
</span><span id="__ispan-17-12">    | NockOp.Apply := case args of {
</span><span id="__ispan-17-13">      | Noun.Cell b c :=
</span><span id="__ispan-17-14">        nock stor (Noun.Cell a b) &gt;&gt;= \{r1 :=
</span><span id="__ispan-17-15">        nock stor (Noun.Cell a c) &gt;&gt;= \{r2 :=
</span><span id="__ispan-17-16">        nock stor (Noun.Cell r1 r2)
</span><span id="__ispan-17-17">        }}
</span><span id="__ispan-17-18">      | _ := err ("Invalid apply (2) args (must be cell): " ++str (showNoun args))
</span><span id="__ispan-17-19">    }
</span><span id="__ispan-17-20">
</span><span id="__ispan-17-21">    -- *[a 3 b] -&gt; ?*[a b]
</span><span id="__ispan-17-22">    -- ?[a b] -&gt; 0
</span><span id="__ispan-17-23">    -- ?a -&gt; 1
</span><span id="__ispan-17-24">    | NockOp.CellTest := case args of {
</span><span id="__ispan-17-25">      | Noun.Cell b _ :=
</span><span id="__ispan-17-26">        nock stor (Noun.Cell a b) &gt;&gt;= \{res :=
</span><span id="__ispan-17-27">        case res of {
</span><span id="__ispan-17-28">          | Noun.Cell _ _ := pure (Noun.Atom 0)
</span><span id="__ispan-17-29">          | _ := pure (Noun.Atom 1)
</span><span id="__ispan-17-30">        }
</span><span id="__ispan-17-31">        }
</span><span id="__ispan-17-32">      | _ := err ("Invalid cell test (3) args (must be cell): " ++str (showNoun args))
</span><span id="__ispan-17-33">    }
</span><span id="__ispan-17-34">
</span><span id="__ispan-17-35">    -- *[a 4 b] -&gt; +*[a b]
</span><span id="__ispan-17-36">    -- +[a b] -&gt; error (specs say this should loop infinitely?)
</span><span id="__ispan-17-37">    -- +a -&gt; 1 + a
</span><span id="__ispan-17-38">    | NockOp.Increment :=
</span><span id="__ispan-17-39">        -- First, evaluate the argument expression *[subject args]
</span><span id="__ispan-17-40">        nock stor (Noun.Cell a args) &gt;&gt;= \{res :=
</span><span id="__ispan-17-41">          -- Then, check if the result is an atom and increment it
</span><span id="__ispan-17-42">          case res of {
</span><span id="__ispan-17-43">            | (Noun.Atom n) := pure (Noun.Atom (suc n))
</span><span id="__ispan-17-44">            | x := err ("Increment (4) target must be atom, got: " ++str (showNoun x))
</span><span id="__ispan-17-45">          }
</span><span id="__ispan-17-46">        }
</span><span id="__ispan-17-47">
</span><span id="__ispan-17-48">    -- *[a 5 b c] -&gt; =*[a b] *[a c]
</span><span id="__ispan-17-49">    -- =[a a] -&gt; 0
</span><span id="__ispan-17-50">    -- =[a b] -&gt; 1
</span><span id="__ispan-17-51">    | NockOp.EqualOp := case args of {
</span><span id="__ispan-17-52">      | Noun.Cell b c :=
</span><span id="__ispan-17-53">        nock stor (Noun.Cell a b) &gt;&gt;= \{r1 :=
</span><span id="__ispan-17-54">        nock stor (Noun.Cell a c) &gt;&gt;= \{r2 :=
</span><span id="__ispan-17-55">        pure (Noun.Atom (case nounEq r1 r2 of {
</span><span id="__ispan-17-56">              | true := 0
</span><span id="__ispan-17-57">              | false := 1
</span><span id="__ispan-17-58">            }))
</span><span id="__ispan-17-59">        }}
</span><span id="__ispan-17-60">      | _ := err ("Invalid equality (5) args (must be cell): " ++str (showNoun args))
</span><span id="__ispan-17-61">    }
</span><span id="__ispan-17-62">
</span><span id="__ispan-17-63">    -- *[a 6 b c d] -&gt; *[a *[[c d] 0 *[[2 3] 0 *[a 4 4 b]]]]
</span><span id="__ispan-17-64">    | NockOp.IfThenElse := case args of {
</span><span id="__ispan-17-65">      | Noun.Cell b (Noun.Cell c d) :=
</span><span id="__ispan-17-66">        nock stor (Noun.Cell a (Noun.Cell (Noun.Atom 4) (Noun.Cell (Noun.Atom 4) b))) &gt;&gt;= \{r1 :=
</span><span id="__ispan-17-67">        nock stor (Noun.Cell (Noun.Cell (Noun.Atom 2) (Noun.Atom 3)) (Noun.Cell (Noun.Atom 0) r1)) &gt;&gt;= \{r2 :=
</span><span id="__ispan-17-68">        nock stor (Noun.Cell (Noun.Cell c d) (Noun.Cell (Noun.Atom 0) r2)) &gt;&gt;= \{r3 :=
</span><span id="__ispan-17-69">        nock stor (Noun.Cell a r3)
</span><span id="__ispan-17-70">        }}}
</span><span id="__ispan-17-71">      | _ := err ("Invalid if-then-else (6) args (must be [b [c d]]): " ++str (showNoun args))
</span><span id="__ispan-17-72">    }
</span><span id="__ispan-17-73">
</span><span id="__ispan-17-74">    -- *[a 7 b c] -&gt; *[*[a b] c]
</span><span id="__ispan-17-75">    | NockOp.Compose := case args of {
</span><span id="__ispan-17-76">      | Noun.Cell b c :=
</span><span id="__ispan-17-77">        nock stor (Noun.Cell a b) &gt;&gt;= \{r :=
</span><span id="__ispan-17-78">        nock stor (Noun.Cell r c)
</span><span id="__ispan-17-79">        }
</span><span id="__ispan-17-80">      | _ := err ("Invalid compose (7) args (must be cell): " ++str (showNoun args))
</span><span id="__ispan-17-81">    }
</span><span id="__ispan-17-82">
</span><span id="__ispan-17-83">    -- *[a 8 b c] -&gt; *[[*[a b] a] c]
</span><span id="__ispan-17-84">    | NockOp.Extend := case args of {
</span><span id="__ispan-17-85">      | Noun.Cell b c :=
</span><span id="__ispan-17-86">        nock stor (Noun.Cell a b) &gt;&gt;= \{r :=
</span><span id="__ispan-17-87">        nock stor (Noun.Cell (Noun.Cell r a) c)
</span><span id="__ispan-17-88">        }
</span><span id="__ispan-17-89">      | _ := err ("Invalid extend (8) args (must be cell): " ++str (showNoun args))
</span><span id="__ispan-17-90">    }
</span><span id="__ispan-17-91">
</span><span id="__ispan-17-92">    -- *[a 9 b c] -&gt; *[*[a c] 2 [0 1] 0 b]
</span><span id="__ispan-17-93">    | NockOp.Invoke := case args of {
</span><span id="__ispan-17-94">      | Noun.Cell b c :=
</span><span id="__ispan-17-95">        nock stor (Noun.Cell a c) &gt;&gt;= \{core :=
</span><span id="__ispan-17-96">        let formula := Noun.Cell (Noun.Atom 2) (Noun.Cell (Noun.Cell (Noun.Atom 0) (Noun.Atom 1)) (Noun.Cell (Noun.Atom 0) b)) in
</span><span id="__ispan-17-97">        nock stor (Noun.Cell core formula)
</span><span id="__ispan-17-98">        }
</span><span id="__ispan-17-99">      | _ := err ("Invalid invoke (9) args (must be cell): " ++str (showNoun args))
</span><span id="__ispan-17-100">    }
</span><span id="__ispan-17-101">
</span><span id="__ispan-17-102">    -- *[a 10 [b c] d] -&gt; #[b *[a c] *[a d]]
</span><span id="__ispan-17-103">    | NockOp.Pound := case args of {
</span><span id="__ispan-17-104">      | Noun.Cell (Noun.Cell b c) d :=
</span><span id="__ispan-17-105">        nock stor (Noun.Cell a c) &gt;&gt;= \{r1 :=
</span><span id="__ispan-17-106">        nock stor (Noun.Cell a d) &gt;&gt;= \{r2 :=
</span><span id="__ispan-17-107">        pound stor b r1 r2
</span><span id="__ispan-17-108">        }}
</span><span id="__ispan-17-109">      | _ := err ("Invalid pound (10) args (must be [[b c] d]): " ++str (showNoun args))
</span><span id="__ispan-17-110">    }
</span><span id="__ispan-17-111">
</span><span id="__ispan-17-112">    -- *[a 11 [b c] d] -&gt; *[[*[a c] *[a d]] 0 3]
</span><span id="__ispan-17-113">    -- *[a 11 b c] -&gt; *[a c]
</span><span id="__ispan-17-114">    | NockOp.Match := case args of {
</span><span id="__ispan-17-115">      | Noun.Cell (Noun.Cell b c) d :=
</span><span id="__ispan-17-116">        nock stor (Noun.Cell a c) &gt;&gt;= \{r1 :=
</span><span id="__ispan-17-117">        nock stor (Noun.Cell a d) &gt;&gt;= \{r2 :=
</span><span id="__ispan-17-118">        nock stor (Noun.Cell (Noun.Cell r1 r2) (Noun.Cell (Noun.Atom 0) (Noun.Atom 3)))
</span><span id="__ispan-17-119">        }}
</span><span id="__ispan-17-120">      | Noun.Cell b c := nock stor (Noun.Cell a c) -- Corrected to take 'a' as subject
</span><span id="__ispan-17-121">      | _ := err ("Invalid match (11) args (must be cell): " ++str (showNoun args))
</span><span id="__ispan-17-122">    }
</span><span id="__ispan-17-123">
</span><span id="__ispan-17-124">    -- *[a 12 b c d] -&gt; result &lt;- SCRY b c; *[a result d]
</span><span id="__ispan-17-125">    | Scry := case args of {
</span><span id="__ispan-17-126">      | Noun.Cell b (Noun.Cell c d) :=
</span><span id="__ispan-17-127">          -- First evaluate b to get the opcode
</span><span id="__ispan-17-128">          nock stor b &gt;&gt;= \{opcode :=
</span><span id="__ispan-17-129">            case opcode of {
</span><span id="__ispan-17-130">              | Noun.Atom opval :=
</span><span id="__ispan-17-131">                  -- Then evaluate c to get the address
</span><span id="__ispan-17-132">                  nock stor c &gt;&gt;= \{addr :=
</span><span id="__ispan-17-133">                    case addr of {
</span><span id="__ispan-17-134">                      | Noun.Atom addrVal :=
</span><span id="__ispan-17-135">                          -- Convert opcode to ScryOp
</span><span id="__ispan-17-136">                          let scryType := case opval == 0 of {
</span><span id="__ispan-17-137">                            | true := ScryOp.Direct
</span><span id="__ispan-17-138">                            | false := ScryOp.Index
</span><span id="__ispan-17-139">                          } in
</span><span id="__ispan-17-140">                          -- Perform the scry operation and wrap result in GasState
</span><span id="__ispan-17-141">                          GasState.mk \{gas :=
</span><span id="__ispan-17-142">                            scry stor scryType addrVal &gt;&gt;= \{scryResult :=
</span><span id="__ispan-17-143">                            -- Continue evaluation with the scry result
</span><span id="__ispan-17-144">                            GasState.runGasState (nock stor (Noun.Cell a (Noun.Cell scryResult d))) gas
</span><span id="__ispan-17-145">                            }
</span><span id="__ispan-17-146">                          }
</span><span id="__ispan-17-147">                      | _ := err ("Scry address must be atom, got: " ++str (showNoun addr))
</span><span id="__ispan-17-148">                    }
</span><span id="__ispan-17-149">                  }
</span><span id="__ispan-17-150">              | _ := err ("Scry type must be atom, got: " ++str (showNoun opcode))
</span><span id="__ispan-17-151">            }
</span><span id="__ispan-17-152">          }
</span><span id="__ispan-17-153">      | _ := err ("Invalid scry (12) args (must be [b [c d]]): " ++str (showNoun args))
</span><span id="__ispan-17-154">    }
</span><span id="__ispan-17-155">  };
</span></code></pre></div>
<h2 id="core-nockma-evaluator">Core Nockma Evaluator<a class="headerlink" href="#core-nockma-evaluator" title="Anchor link to this section for reference">¶</a></h2>
<p>The main entry point for Nock evaluation. This function handles the parsing of
Nock expressions and dispatches to the appropriate operation evaluators.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__ispan-18-1">-- Core Nockma evaluator
</span><span id="__ispan-18-2">terminating
</span><span id="__ispan-18-3">nock {val : Type} (stor : Storage Nat val) (input : Noun) : GasState Noun :=
</span><span id="__ispan-18-4">  case input of {
</span><span id="__ispan-18-5">    -- Rule: *a -&gt; *a
</span><span id="__ispan-18-6">    | Noun.Atom n := err ("Cannot evaluate atom as program: " ++str (showNoun (Noun.Atom n)))
</span><span id="__ispan-18-7">
</span><span id="__ispan-18-8">    | Noun.Cell a b := case b of {
</span><span id="__ispan-18-9">
</span><span id="__ispan-18-10">      | Noun.Cell first rest := case first of {
</span><span id="__ispan-18-11">        -- Rule: *[a [b c] d] -&gt; [*[a b c] *[a d]]
</span><span id="__ispan-18-12">        | Noun.Cell b c :=
</span><span id="__ispan-18-13">          nock stor (Noun.Cell a (Noun.Cell b c)) &gt;&gt;= \{r1 :=
</span><span id="__ispan-18-14">          nock stor (Noun.Cell a rest) &gt;&gt;= \{r2 :=
</span><span id="__ispan-18-15">          pure (Noun.Cell r1 r2)
</span><span id="__ispan-18-16">          }}
</span><span id="__ispan-18-17">
</span><span id="__ispan-18-18">        | Noun.Atom n := case parseOp n of {
</span><span id="__ispan-18-19">          | some opcode := consume opcode &gt;&gt;= \{_ :=
</span><span id="__ispan-18-20">              evalOp stor opcode a rest -- Evaluate [subject rest] with opcode n
</span><span id="__ispan-18-21">            }
</span><span id="__ispan-18-22">          | none := err ("Invalid operation code: " ++str (natToString n) ++str " in formula: " ++str (showNoun b))
</span><span id="__ispan-18-23">        }
</span><span id="__ispan-18-24">      }
</span><span id="__ispan-18-25">      -- Rule: *[a b] where b is an atom is an error
</span><span id="__ispan-18-26">      | Noun.Atom bn := err ("Formula cannot be an atom: " ++str (showNoun (Noun.Atom bn)) ++str " in input: " ++str (showNoun input))
</span><span id="__ispan-18-27">    }
</span><span id="__ispan-18-28">  };
</span></code></pre></div>
<!-- list_wikilinks -->
<!-- Source file information -->
<!-- Was this page helpful? -->
<!-- Comment system -->
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Runnable trait" class="md-footer__link md-footer__link--prev" href="runnable.html">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M7.78 12.53a.75.75 0 0 1-1.06 0L2.47 8.28a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042L4.81 7h7.44a.75.75 0 0 1 0 1.5H4.81l2.97 2.97a.75.75 0 0 1 0 1.06"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                Runnable trait
              </div>
</div>
</a>
<a aria-label="Next: Nockma runnable" class="md-footer__link md-footer__link--next" href="nockma_runnable.html">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                Nockma runnable
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8.22 2.97a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.042-.018.75.75 0 0 1-.018-1.042l2.97-2.97H3.75a.75.75 0 0 1 0-1.5h7.44L8.22 4.03a.75.75 0 0 1 0-1.06"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      © 2025 <a href="https://anoma.net">Anoma Foundation</a>
</div>
<strong>Version: (PR 374) - Updated: June 03,
    2025 at 06:17 AM UTC</strong>
<br/>
<strong>Latest version: <a href="https://specs.anoma.net/latest">
    https://specs.anoma.net/latest</a></strong>
<br/>
<strong>Development version: <a href="https://specs.anoma.net/main">
    https://specs.anoma.net/main</a></strong>
<br/>
<strong>Anoma Official Resources:</strong>
<small> <a href="https://anoma.net/" target="_blank">Website</a> | <a href="https://art.anoma.net" target="_blank">Research</a> | <a href="https://anoma.net/blog" target="_blank">Blog</a> | <a href="https://anoma.net/talks" target="_blank">Talks</a> </small>
<br/>
<strong>For Specification Authors:</strong>
<small>
<a href="https://specs.anoma.net/pr-374/indexes/tags.html">Tags</a>
    | <a href="https://specs.anoma.net/pr-374/indexes/links.html">Quick links</a>
    | <a href="https://specs.anoma.net/pr-374/indexes/juvix_modules.html">Juvix modules</a>
    | <a href="https://specs.anoma.net/pr-374/tutorial/index.html">Guides</a>
</small>
</div>
<div class="md-social">
<a class="md-social__link" href="https://x.com/anoma" rel="noopener" target="_blank" title="x.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"></path></svg>
</a>
<a class="md-social__link" href="https://github.com/anoma" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
<a class="md-social__link" href="https://anoma.net/blog" rel="noopener" target="_blank" title="anoma.net">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M192 32c0 17.7 14.3 32 32 32 123.7 0 224 100.3 224 224 0 17.7 14.3 32 32 32s32-14.3 32-32C512 128.9 383.1 0 224 0c-17.7 0-32 14.3-32 32m0 96c0 17.7 14.3 32 32 32 70.7 0 128 57.3 128 128 0 17.7 14.3 32 32 32s32-14.3 32-32c0-106-86-192-192-192-17.7 0-32 14.3-32 32m-96 16c0-26.5-21.5-48-48-48S0 117.5 0 144v224c0 79.5 64.5 144 144 144s144-64.5 144-144-64.5-144-144-144h-16v96h16c26.5 0 48 21.5 48 48s-21.5 48-48 48-48-21.5-48-48z"></path></svg>
</a>
<a class="md-social__link" href="https://research.anoma.net" rel="noopener" target="_blank" title="research.anoma.net">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M225.9 32C103.3 32 0 130.5 0 252.1 0 256 .1 480 .1 480l225.8-.2c122.7 0 222.1-102.3 222.1-223.9S348.6 32 225.9 32M224 384c-19.4 0-37.9-4.3-54.4-12.1L88.5 392l22.9-75c-9.8-18.1-15.4-38.9-15.4-61 0-70.7 57.3-128 128-128s128 57.3 128 128-57.3 128-128 128"></path></svg>
</a>
<a class="md-social__link" href="https://youtube.com/anoma" rel="noopener" target="_blank" title="youtube.com">
<svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305m-317.51 213.508V175.185l142.739 81.205z"></path></svg>
</a>
<a class="md-social__link" href="mailto:arts@heliax.dev" rel="noopener" target="_blank" title="">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../../../..", "features": ["announce.dismiss", "content.code.annotate", "content.code.copy", "content.tooltips", "content.action.edit", "content.action.view", "search.highlight", "search.suggest", "search.sharing", "navigation.instant.preview", "navigation.tracking", "navigation.prune", "navigation.indexes", "navigation.sections", "navigation.footer", "navigation.path", "toc.follow"], "search": "../../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../../../../assets/javascripts/bundle.c8b220af.min.js"></script>
<script src="../../../../../assets/js/extra.js"></script>
<script src="../../../../../assets/js/highlight.js"></script>
<script src="../../../../../assets/js/mathjax.js"></script>
<script src="../../../../../assets/js/tex-svg-full.js"></script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>