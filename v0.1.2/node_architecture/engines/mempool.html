
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The Anoma Specification is a collection of documents that describe the architecture, design, and implementation of the Anoma Network.">
      
      
        <meta name="author" content="Anoma Foundation">
      
      
        <link rel="canonical" href="https://anoma.github.io/nspec/v2/node_architecture/engines/mempool.html">
      
      
      
      
      <link rel="icon" href="../../assets/logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.37">
    
    
      
        <title>Mempool - Anoma Specification</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Open Sans";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/timeago.css">
    
      <link rel="stylesheet" href="../../assets/css/style.css">
    
      <link rel="stylesheet" href="../../assets/css/juvix-highlighting.css">
    
      <link rel="stylesheet" href="../../assets/css/juvix_codeblock_footer.css">
    
      <link rel="stylesheet" href="../../assets/css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Mempool - Anoma Specification" >
      
        <meta  property="og:description"  content="The Anoma Specification is a collection of documents that describe the architecture, design, and implementation of the Anoma Network." >
      
        <meta  property="og:image"  content="https://anoma.github.io/nspec/v2/assets/images/social/node_architecture/engines/mempool.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://anoma.github.io/nspec/v2/node_architecture/engines/mempool.html" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Mempool - Anoma Specification" >
      
        <meta  name="twitter:description"  content="The Anoma Specification is a collection of documents that describe the architecture, design, and implementation of the Anoma Network." >
      
        <meta  name="twitter:image"  content="https://anoma.github.io/nspec/v2/assets/images/social/node_architecture/engines/mempool.png" >
      
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mempool" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
              </button>
            
            
  For updates follow <strong>@anoma</strong> on
  <a rel="me" href="https://x.com/anoma">
    <span class="twemoji x-twitter">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg>
    </span>
    <strong></strong>
  </a>
  and discuss on our
  <a href="https://research.anoma.net">
    <span class="twemoji discourse">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M225.9 32C103.3 32 0 130.5 0 252.1 0 256 .1 480 .1 480l225.8-.2c122.7 0 222.1-102.3 222.1-223.9S348.6 32 225.9 32M224 384c-19.4 0-37.9-4.3-54.4-12.1L88.5 392l22.9-75c-9.8-18.1-15.4-38.9-15.4-61 0-70.7 57.3-128 128-128s128 57.3 128 128-57.3 128-128 128"/></svg>
    </span>
    <strong>forum</strong>
  </a>

          </div>
          
            <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script>
          
        </aside>
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest official version.
  <a href="../../..">
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="Anoma Specification" class="md-header__button md-logo" aria-label="Anoma Specification" data-md-component="logo">
      
  <img src="../../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Anoma Specification
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Mempool
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="red"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="red"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            <!--
  Copyright (c) 2016-2024 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->



<!-- Navigation tabs -->
<nav
  class="md-tabs"
  aria-label="Tabs"
  data-md-component="tabs"
>
  <div class="md-grid">
    <ul class="md-tabs__list">
      
      
            
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html" class="md-tabs__link">
        
  
    
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
    
  
  Home

      </a>
    </li>
  

        
      
      
            
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../scope/index.html" class="md-tabs__link">
          
  
    
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 3c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2zm10.78 2H19v12.18c-.26-.8-1.31-1.39-2.2-1.39h-1v-3a1 1 0 0 0-1-1h-6v-2h2a1 1 0 0 0 1-1v-2h2c1.03 0 1.87-.79 1.98-1.79M5 10.29l4.8 4.5v1a2 2 0 0 0 2 2V19H5z"/></svg>
    
  
  Scope

        </a>
      </li>
    
  

        
      
      
            
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../basic_abstractions/index.html" class="md-tabs__link">
          
  
    
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm0 2h7v5h5v11H6zm2 8v2h8v-2zm0 4v2h5v-2z"/></svg>
    
  
  Basic Abstractions

        </a>
      </li>
    
  

        
      
      
            
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../architecture/index.html" class="md-tabs__link">
          
  
    
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 18.714v4.8c0 .288-.192.48-.48.48h-4.8c-.288 0-.48-.192-.48-.48v-4.8c0-.288.192-.48.48-.48h1.92v-1.92h-8.16v1.92h1.92c.288 0 .48.192.48.48v4.8c0 .288-.192.48-.48.48H9.6c-.288 0-.48-.192-.48-.48v-4.8c0-.288.192-.48.48-.48h1.92v-1.92H3.36v1.92h1.92c.288 0 .48.192.48.48v4.8c0 .288-.192.48-.48.48H.48c-.288 0-.48-.192-.48-.48v-4.8c0-.288.192-.48.48-.48H2.4v-2.4c0-.288.192-.48.48-.48h8.64v-1.44h.96v1.44h8.64c.288 0 .48.192.48.48v2.4h1.92c.288 0 .48.192.48.48m-13.92 4.32h3.84v-3.84h-3.84zm-9.12 0H4.8v-3.84H.96Zm18.24 0h3.84v-3.84H19.2ZM6.24 9.642V3.546c0-.192.096-.336.24-.432L11.76.042a.8.8 0 0 1 .48 0l5.28 3.072c.144.096.24.24.24.432v6.096c0 .144-.096.288-.24.384l-5.28 3.072q-.096.048-.24.048t-.24-.048l-5.28-3.072c-.144-.096-.24-.24-.24-.384m10.56-.288V4.362l-4.32 2.496v4.992zm-9.6 0 4.32 2.496V6.858L7.2 4.362Zm.48-5.808L12 5.994l4.32-2.448L12 1.05Z"/></svg>
    
  
  Protocol Architecture

        </a>
      </li>
    
  

        
      
      
            
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../application_architecture/index.html" class="md-tabs__link">
          
  
    
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 20h4v-4h-4m0-2h4v-4h-4m-6-2h4V4h-4m6 4h4V4h-4m-6 10h4v-4h-4m-6 4h4v-4H4m0 10h4v-4H4m6 4h4v-4h-4M4 8h4V4H4z"/></svg>
    
  
  Application Architecture

        </a>
      </li>
    
  

        
      
      
            
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../implementation/index.html" class="md-tabs__link">
          
  
    
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.793 16.575c0 3.752-2.927 7.426-7.743 7.426-5.249 0-7.843-3.71-7.843-8.29 0-5.21 3.892-12.952 8-15.647a.397.397 0 0 1 .61.371 9.72 9.72 0 0 0 1.694 6.518c.522.795 1.092 1.478 1.763 2.352.94 1.227 1.637 1.906 2.644 3.842l.015.028a7.1 7.1 0 0 1 .86 3.4"/></svg>
    
  
  Implementation

        </a>
      </li>
    
  

        
      
      
      
      
      
      
      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Anoma Specification" class="md-nav__button md-logo" aria-label="Anoma Specification" data-md-component="logo">
      
  <img src="../../assets/logo.svg" alt="logo">

    </a>
    Anoma Specification
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../scope/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Scope
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../basic_abstractions/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Basic Abstractions
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../architecture/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Protocol Architecture
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../application_architecture/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Application Architecture
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../implementation/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Implementation
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../indexes/links.html" class="md-nav__link">
        
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg>
  
  <span class="md-ellipsis">
    Quick links
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../indexes/juvix_modules.html" class="md-nav__link">
        
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 10h-2V8h2m0 5h-2v-2h2m-3-1h-2V8h2m0 5h-2v-2h2m0 6H8v-2h8m-9-5H5V8h2m0 5H5v-2h2m1 0h2v2H8m0-5h2v2H8m3 1h2v2h-2m0-5h2v2h-2m9-5H4c-1.11 0-2 .89-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2"/></svg>
  
  <span class="md-ellipsis">
    Juvix modules
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
          
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../tutorial/index.html" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Tutorials for contributors
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heterogeneous-narwhal" class="md-nav__link">
    <span class="md-ellipsis">
      Heterogeneous Narwhal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Heterogeneous Narwhal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workers" class="md-nav__link">
    <span class="md-ellipsis">
      Workers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primaries" class="md-nav__link">
    <span class="md-ellipsis">
      Primaries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vocabulary" class="md-nav__link">
    <span class="md-ellipsis">
      Vocabulary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heterogeneous-narwhal-availability-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      Heterogeneous Narwhal Availability Protocol
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Heterogeneous Narwhal Availability Protocol">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#batches-and-worker-hashes" class="md-nav__link">
    <span class="md-ellipsis">
      Batches and Worker Hashes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signed-quorums-and-headers" class="md-nav__link">
    <span class="md-ellipsis">
      Signed Quorums and Headers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heterogeneous-narwhal-integrity-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      Heterogeneous Narwhal Integrity Protocol
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dag-properties" class="md-nav__link">
    <span class="md-ellipsis">
      DAG Properties
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DAG Properties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fair-broadcast" class="md-nav__link">
    <span class="md-ellipsis">
      Fair Broadcast
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fair Broadcast">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#any-block-for-learner-a-referenced-by-a-weak-quorum-for-learner-a-will-after-3-rounds-be-transitively-referenced-by-all-future-blocks-of-learners-entangled-with-a" class="md-nav__link">
    <span class="md-ellipsis">
      Any block for learner A referenced by a weak quorum for learner A will, after 3 rounds, be (transitively) referenced by all future blocks of learners entangled with A.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consensus" class="md-nav__link">
    <span class="md-ellipsis">
      Consensus
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Consensus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#choosing-a-total-order" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing a total order
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="mempool">Mempool<a class="headerlink" href="#mempool" title="Permanent link">&para;</a></h1>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>Validators run the mempool protocol.
They receive transactions from clients, store them, and make them available for the <a href="execution.html#execution-engine">execution engine</a> to read.
The mempool protocol, which is based on <a href="https://arxiv.org/abs/2105.11827">Narwhal</a> also produces a <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph">DAG</a> of <em>headers</em>, which reference batches of transactions (via hash), and prove that those transactions are available for the <a href="execution.html#execution-engine">execution engine</a>.
These headers are ultimately what the <a href="consensus_v1.html#consensus">consensus</a> decides on, in order to establish a total order of transactions.</p>
<h2 id="heterogeneous-narwhal">Heterogeneous Narwhal<a class="headerlink" href="#heterogeneous-narwhal" title="Permanent link">&para;</a></h2>
<p>The core idea here is that we run an instance of Narwhal for each learner.
For chimera chains, an "atomic batch" of transactions can be stored in any involved learner's Narwhal.</p>
<p>We also make 2 key changes:</p>
<ul>
<li>The availability proofs must show that any transaction is sufficiently available for all learners.
This should not be a problem, since in Heterogeneous Paxos, for any connected learner graph, any learner's quorum is a weak quorum for all learners.</li>
<li>Whenever a validator's Narwhal primary produces a batch, it must link in that batch not only to a quorum of that learner's block headers from the prior round, but also to the most recent batch this validator has produced <em>for any learner</em>.
This ensures that, within a finite number of rounds (3, I think), any transaction batch referenced by a weak quorum of batches in its own Narwhal will be (transitively) referenced by all batches in all Narwhals for entangled learners.</li>
</ul>
<h3 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h3>
<p>Like <a href="https://arxiv.org/abs/2105.11827">Narwhal</a>, Heterogeneous Narwhal Validators have multiple concurrent processes (which can even run on separate machines).
Each validator has one <em>primary</em> process and many <em>worker</em> processes.
When a client submits a transaction, they first send it to a worker process.</p>
<h4 id="workers">Workers<a class="headerlink" href="#workers" title="Permanent link">&para;</a></h4>
<p>Worker processes ensure transactions are available.
Transactions are batched, and erasure-coded (possibly simply replicated) across a <em>weak quorum for every learner</em> of workers, and only signed hashes of those batches are sent to primaries.
This separates the high-bandwidth work of replicating transactions from the ordering work of the primaries.</p>
<h4 id="primaries">Primaries<a class="headerlink" href="#primaries" title="Permanent link">&para;</a></h4>
<p>Primary processes establish a partial order of transaction batches (and by extension transactions), in the form of a structured DAG.
The DAG proceeds in <em>rounds</em> for each learner: each primary produces at most one block for each (correct) learner in each round.
That block references blocks from prior rounds.</p>
<p>Primaries assemble headers (both their own and for other primaries) from collections of worker hashes, and references to prior blocks.
They then sign votes, stating that they will not vote for conflicting headers, and (optionally) that their workers have indeed stored the referenced transactions.
Primaries collect votes concerning their own headers, producing blocks: aggregated signatures showing a header is unique.</p>
<p>More formally, we present the Heterogeneous Narwhal protocol as the composition of two crucial pieces: the Heterogeneous Narwhal Availability protocol, and the Heterogeneous Narwhal Integrity protocol.</p>
<h3 id="vocabulary">Vocabulary<a class="headerlink" href="#vocabulary" title="Permanent link">&para;</a></h3>
<ul>
<li><em>Learner</em>s dictate trust decisions: just like in Heterogeneous Paxos, we use a Learner Graph. In diagrams, we usually represent learners with colors (red and blue).</li>
<li><a class="glightbox" href="quorum.svg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="quorum.svg" alt="quorum" height="12pt"/></a> <em>Quorum</em>: a set of validators sufficient for a Learner to make blocks. Each Learner has a set of quorums.</li>
<li><em>Intact Learner</em>: any 2 quorums for an Intact Learner have a correct validator in their intersection. Most of our guarantees apply only to Intact Learners.</li>
<li><em>Entangled Learners</em>: a pair of learners <em>A</em> and <em>B</em> are entangled if, for any quorum <em>Qa</em> of <em>A</em>, and any quorum <em>Qb</em> of <em>B</em>, the intersection of <em>Qa</em> and <em>Qb</em> contains a correct validator.
Some guarantees apply pairwise to Entangled Learners: they are, in a sense, guaranteed to agree on stuff.</li>
<li><a class="glightbox" href="weak_quorum.svg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="weak_quorum.svg" alt="weak quorum" height="12pt"/></a> <em>Weak Quorum</em>: a set of validators that intersects every quorum. Weak Quorums are Learner-specific, so when we say <em>weak quorum for every learner</em> we mean a set of validators that intersects every quorum of every Learner.</li>
<li><a class="glightbox" href="transaction.svg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="transaction.svg" alt="transaction" height="12pt"/></a> <em>Transaction</em>: data from clients to be ordered. We do not specify how it's formatted.</li>
<li><em>Batch</em>: a set of transactions collected by a Worker.</li>
<li><a class="glightbox" href="erasure_share.svg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="erasure_share.svg" alt="erasure share" height="12pt"/></a> <em>Erasure Share</em>: data transmitted to a weak quorum of listening workers, such that any Quorum of validators can re-construct the original data (Transaction or Batch of Transactions).</li>
<li><a class="glightbox" href="worker_hash.svg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="worker_hash.svg" alt="worker hash" height="12pt"/></a> <em>Worker Hash</em>: a signed digest of a batch of transactions collected by (and signed) by a worker.</li>
<li><a class="glightbox" href="header.svg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="header.svg" alt="header" height="12pt"/></a> <em>Header</em>s have:</li>
<li>an associated Primary (who "created" this header)</li>
<li>a set of Worker Hashes (from workers on the same validator as this primary)</li>
<li>an Availability Certificate for the previous Header issued by this primary</li>
<li>at most one Signed Quorum for each Learner</li>
<li><a class="glightbox" href="availability_certificate.svg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="availability_certificate.svg" alt="availability certificate" height="12pt"/></a> <em>Availability Certificate</em>: an aggregation of signatures from a Weak Quorum attesting that everything referenced by a particular Header is available. Must include a signature from the Header's primary.</li>
<li><a class="glightbox" href="block.svg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="block.svg" alt="block" height="12pt"/></a> <em>Block</em>: an aggregation of Header signatures from a quorum of a specific learner attesting that they will not attest to any conflicting header. Also includes an Availability Certificate. Should include all signatures a primary has gathered for that header at the time (signatures in the Availability Certificate count).</li>
<li><a class="glightbox" href="signed_quorum.svg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img src="signed_quorum.svg" alt="signed quorum" height="12pt"/></a> <em>Signed Quorum</em>: a quorum of blocks with the same learner and round, signed by a primary. These are referenced in headers.</li>
</ul>
<p><a class="glightbox" href="https://anoma.github.io/nspec/v2/images/data_structure.svg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Data Structure" src="https://anoma.github.io/nspec/v2/images/data_structure.svg" /></a></p>
<h2 id="heterogeneous-narwhal-availability-protocol">Heterogeneous Narwhal Availability Protocol<a class="headerlink" href="#heterogeneous-narwhal-availability-protocol" title="Permanent link">&para;</a></h2>
<p><a class="glightbox" href="https://anoma.github.io/nspec/v2/images/workers.svg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Availability Protocol Time-Space Diagram" src="https://anoma.github.io/nspec/v2/images/workers.svg" /></a>
(note the giant curly-brace represents a Weak Quorum of validators)</p>
<h3 id="batches-and-worker-hashes">Batches and Worker Hashes<a class="headerlink" href="#batches-and-worker-hashes" title="Permanent link">&para;</a></h3>
<p>When a worker has collected a batch of transactions, it transmits erasure shares (possibly full copies) of those transactions to other workers on a <em>weak quorum for every learner</em> of validators.
What's important about this erasure coding is that any Quorum of any Learner can reconstruct every transaction.
Furthermore, workers must be able to verify that they are in fact storing the correct Erasure Share of the data referenced in the Worker Hash.
One way to accomplish this is to transmit a complete copy of all the data to an entire Weak Quorum for every Learner.</p>
<p>In fact, rather than wait until a batch is complete to start transmitting, workers can stream erasure shares as they receive transactions.
When it has completed a batch, a worker also transmits a signed <em>Worker Hash</em> to those other workers, and its own primary.
We do not specify when workers should complete batches, but perhaps it should be after some timeout, or perhaps primaries should signal workers to complete batches. Batches should not be empty.</p>
<h3 id="signed-quorums-and-headers">Signed Quorums and Headers<a class="headerlink" href="#signed-quorums-and-headers" title="Permanent link">&para;</a></h3>
<p>Primaries ultimately produce blocks for each round, for each Learner, and send those blocks to other Primaries.
When a primary for validator <code>V</code> has received blocks for learner <code>L</code> and round <code>R</code> from an entire quorum of validators for learner <code>L</code>, it signs that collection, producing a <em>Signed Quorum</em> object, which identifies the validator <code>V</code>, the learner <code>L</code>, and the round <code>R</code>.
The Signed Quorum is then broadcast (or erasure coded) to primaries on a <em>weak quorum for every learner</em> of validators.
Much like batches, it is important that any Quorum for any Learner can re-construct the entire Signed Quorum.</p>
<p>Periodically, each primary <code>P</code> produces <em>Headers</em>.
Each Header contains:</p>
<ul>
<li>a set of signed Worker Hashes, all signed by <code>P</code>'s validator</li>
<li>a hash referencing at most one Signed Quorum per Learner, all signed  by <code>P</code></li>
<li>an <em>Availability Certificate</em> (we'll get to how those are made shortly) for the previous Header <code>P</code> issued.
Headers should be relatively small.
Each primary then sends the header to all the other primaries.</li>
</ul>
<p>When a Primary receives a Header, it can produce an <em>Availability Vote</em> (which is a digital signature) iff
- the primary has stored its share of all Signed Quorums referenced,
- the primary has received messages from its workers indicating that they have stored their shares of all the Batches referenced
The Availability Votes are then transmitted to the Header's Primary.</p>
<p>When a primary receives Availability Votes for a Header from a weak quorum for every learner, it can aggregate those signatures to produce an <em>Availability Certificate</em>, which proves that the Header (and its contents) are available to any Quorum.
Availability Certificates should be small.
Note that, if primaries broadcast Availability Certificates as soon as they produce them, other primaries may have all the components necessary to "receive" a Header even before the Header's Primary actually sends it.
Specifically, they may have:</p>
<ul>
<li>Signed Batch Headers from their listening Workers</li>
<li>Signed Quorum shares received earlier from the Primary</li>
<li>Availability Certificate received earlier from the Primary</li>
</ul>
<h2 id="heterogeneous-narwhal-integrity-protocol">Heterogeneous Narwhal Integrity Protocol<a class="headerlink" href="#heterogeneous-narwhal-integrity-protocol" title="Permanent link">&para;</a></h2>
<p>So far, only Signed Quorums have been Learner-specific: everything else requires a weak quorum for every learner.
However, in the Integrity Protocol, almost everything is Learner-specific.
Furthermore, Workers are not involved in the Integrity Protocol: only Primaries.
<a class="glightbox" href="https://anoma.github.io/nspec/v2/images/primaries.svg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Integrity Protocol Time-Space Diagram" src="https://anoma.github.io/nspec/v2/images/primaries.svg" /></a>
Each Header <code>H</code> features a predecessor <code>H'</code>: the availability certificate in <code>H</code> references the header <code>H'</code>.
When a Primary receives a Header <code>H</code>, it can produce an <em>Integrity Vote</em> iff it has not produced an Integrity vote for any other Header with the same predecessor as <code>H</code>
In essence, this means that each correct Primary signs, for each other (even incorrect) Primary, a unique chain of Headers.
This will ensure that no primary can produce conflicting blocks for entangled Learners.
Integrity Votes are transmitted back to the Primary associated with the Header.
In practice, a Integrity and Availability votes may be combined for Primaries who can cast both.</p>
<p>For each Header it produces, a Primary can calculate its <em>Learner Vector</em>: this represents, for each Learner, the highest round number of any quorum referenced in this Header or its ancestors (its predecessor, of its predecessor's predecessor, etc.).
If, for some Learner <code>L</code>, a header <code>H</code> has a greater round number <code>R</code> in its <em>Learner Vector</em> for <code>L</code> than did <code>H</code>'s predecessor, then the Primary can produce a <em>Block</em> for learner <code>R</code> and round <code>L</code>.
Intuitively, a Primary produces a block whenever it gets a quorum for a Learner in a latest round.</p>
<p>A block for learner <code>L</code> includes an Availability Certificate, as well as an aggregated signature formed from the Integrity Votes of (at least) a quorum (for learner <code>L</code>) for the same Header.
Blocks are transmitted to all other Primaries, who use them to form Signed Quorums.</p>
<p>If a Primary uses the same Header to make blocks for multiple Learners, each block it produces must use a superset of signatures as the previous. This ensures that if the Primary produces a block for Learner A and then a block for learner B, the Block for learner B effectively includes the block for learner A.
We can use this when we later establish a total ordering: any reference to the learner B block also effectively references the learner A block.</p>
<p>Here is an example timeline of a Primary producing headers, availability certificates, and blocks.
Blocks are colour coded by learner and include a round number.
Headers display <em>Learner Vectors</em>.
<a class="glightbox" href="https://anoma.github.io/nspec/v2/images/primary_timeline.svg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Single Primary Timeline" src="https://anoma.github.io/nspec/v2/images/primary_timeline.svg" /></a></p>
<h2 id="dag-properties">DAG Properties<a class="headerlink" href="#dag-properties" title="Permanent link">&para;</a></h2>
<p>Independently, the blocks for each Learner form a DAG with the same properties as in the original Narwhal:
<a class="glightbox" href="https://anoma.github.io/nspec/v2/images/quorums_blue_5_red_0.svg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Blue DAG" src="https://anoma.github.io/nspec/v2/images/quorums_blue_5_red_0.svg" /></a>
(In these diagrams, blocks reference prior blocks from the same Primary; I just didn't draw those arrows)</p>
<p>Note that blocks reference a quorum of blocks from the previous round.
This does not require that the same primary produced a block for the previous round.
In round 5, Primary 3 can produce a block if it has received a quorum of round 4 blocks from other Primaries.</p>
<p>Of course, primaries do not necessarily produce blocks for the same round at the same literal time.
Here we see primaries producing blocks for round 3 for red learner at different times, depending on when they finish batches, or receive a round 2 quorum, or enough votes:
<a class="glightbox" href="https://anoma.github.io/nspec/v2/images/quorums_blue_0_red_3.svg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Blue DAG" src="https://anoma.github.io/nspec/v2/images/quorums_blue_0_red_3.svg" /></a>
In Heterogeneous Narwhal, these two DAGs are being created simultaneously (using the same sequence of Headers from each Primary, and many of the same Votes):
<a class="glightbox" href="https://anoma.github.io/nspec/v2/images/quorums_blue_5_red_3.svg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Blue and Red DAG" src="https://anoma.github.io/nspec/v2/images/quorums_blue_5_red_3.svg" /></a>
Note that round numbers for different learners do not have to be close to each other.
Red round 3 blocks are produced after blue round 5 blocks, and that's ok.</p>
<p>Furthermore, rounds of different learners are not totally ordered.
Red round 3 cannot really be said to happen before, or after, blue round 4.</p>
<h3 id="fair-broadcast">Fair Broadcast<a class="headerlink" href="#fair-broadcast" title="Permanent link">&para;</a></h3>
<p>In Homogeneous Narwhal, any block which is referenced by a weak quorum in the following round will be (transitively) referenced by all blocks thereafter. Heterogeneous Narwhal has analogous guarantees:</p>
<h4 id="any-block-for-learner-a-referenced-by-a-weak-quorum-for-learner-a-will-after-3-rounds-be-transitively-referenced-by-all-future-blocks-of-learners-entangled-with-a">Any block for learner <code>A</code>  referenced by a weak quorum for learner <code>A</code> will, after 3 rounds, be (transitively) referenced by all future blocks of learners entangled with <code>A</code>.<a class="headerlink" href="#any-block-for-learner-a-referenced-by-a-weak-quorum-for-learner-a-will-after-3-rounds-be-transitively-referenced-by-all-future-blocks-of-learners-entangled-with-a" title="Permanent link">&para;</a></h4>
<p>Specifically, such a block <code>B</code> in round <code>R</code>, will be (transitively) referenced by all <code>A</code>-blocks in round <code>R+2</code>.</p>
<p>Consider the first round for learner <code>B</code> using at least a quorum of headers either used in <code>A</code> round <code>R+2</code> or after their primaries' headers for <code>A</code> round <code>R+2</code>.
Given that Learner <code>B</code> is entangled with <code>A</code>, any <code>B</code>-quorum for this round will be a descendant of an <code>A</code>-block from round <code>R+2</code>, and therefore, of <code>B</code>.</p>
<h2 id="consensus">Consensus<a class="headerlink" href="#consensus" title="Permanent link">&para;</a></h2>
<p><a class="glightbox" href="https://anoma.github.io/nspec/v2/images/leader_path_3.svg" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Leader Path" src="https://anoma.github.io/nspec/v2/images/leader_path_3.svg" /></a></p>
<p>In order to establish a total order of transactions, we use <a href="consensus_v1.html#consensus">Heterogeneous Paxos</a> to decide on an ever-growing path through the DAG (for each Learner).
Heterogeneous Paxos guarantees that, if two Learners are <em>entangled</em>, they will decide on the same path.
In order to guarantee liveness (and fairness) for each Learner's transactions, we require that:</p>
<p><em>For any accurate learner <code>L</code>, if one of <code>L</code>'s quorums remains live, and an entire quorum of <code>L</code> issues blocks for round <code>R</code>, consensus will eventually append one of <code>L</code>'s round-<code>R</code> blocks, or one of its descendants, to <code>L</code>'s path.</em></p>
<p>Crucially, if two learners are not entangled, and their blocks never reference each other, consensus should not forever choose blocks exclusively from one learner.
This does require a minimal amount of fairness from consensus itself: as long as blocks for learner <code>L</code> keep getting proposed (indefinitely), consensus should eventually append one of them to the path.</p>
<h3 id="choosing-a-total-order">Choosing a total order<a class="headerlink" href="#choosing-a-total-order" title="Permanent link">&para;</a></h3>
<p>Given a consensus-defined path, we can impose a total order on all transactions which are ancestors of any block in the path.
We require only that, given some block <code>B</code> in the path, all transactions which are ancestors of <code>B</code> are ordered before all transactions which are not ancestors of <code>B</code>.
Among the transactiosn which are ancestors of <code>B</code> but not of its predecessor in the path, total order can be imposed by some arbitrary deterministic function.</p>
<!-- list_wikilinks -->

<!-- mermaid_wikilinks -->







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-08-06T20:14:36+02:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-08-06</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-03-24T00:41:13+01:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-03-24</span>
  </span>

    
    
    
  </aside>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12 21.35-1.45-1.32C5.4 15.36 2 12.27 2 8.5 2 5.41 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.08C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.41 22 8.5c0 3.77-3.4 6.86-8.55 11.53z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12 21.35-1.45-1.32C5.4 15.36 2 12.27 2 8.5 2 5.41 4.42 3 7.5 3c.67 0 1.32.12 1.94.33L13 9.35l-4 5zM16.5 3C19.58 3 22 5.41 22 8.5c0 3.77-3.4 6.86-8.55 11.53L12 21.35l-1-7 4.5-5-2.65-5.08C13.87 3.47 15.17 3 16.5 3"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              Thanks for your feedback! We'll try to improve this page in the future.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  <div class="md-copyright__highlight">
    &copy; 2024 <a href="https://anoma.net">Anoma Foundation</a> - Last updated: October 31, 2024 at 04:27 PM UTC
  </div>
  

  <ul>
    <li><a href="https://anoma.net/" target="_blank">Anoma Official Website</a> </li>
    <li><a href="https://art.anoma.net" target="_blank">Anoma Research Topics (ART)</a></li>
    <li><a href="https://anoma.net/blog" target="_blank">Anoma Blog</a></li>
    <li><a href="https://anoma.net/talks" target="_blank">Anoma Talks</a></li>
  </ul>
  <ul>
    <span class="md-copyright__highlight">Extra resources for Anoma
      Specification collaborators</span>
      
      <li><a href="https://anoma.github.io/nspec/v2/indexes/links.html">Quick links</a></li>
      <li><a href="https://anoma.github.io/nspec/v2/indexes/juvix_modules.html">Juvix modules</a></li>
      <li><a href="https://anoma.github.io/nspec/v2/tutorial/index.html">Markdown tutorials for writing Anoma
          Specification</a></li>
      <li><a href="https://anoma.github.io/nspec/v2/tutorial/engines/index.html">On engines in Anoma</a></li>
  </ul>
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://x.com/anoma" target="_blank" rel="noopener" title="x.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/anoma" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://anoma.net/blog" target="_blank" rel="noopener" title="anoma.net" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M192 32c0 17.7 14.3 32 32 32 123.7 0 224 100.3 224 224 0 17.7 14.3 32 32 32s32-14.3 32-32C512 128.9 383.1 0 224 0c-17.7 0-32 14.3-32 32m0 96c0 17.7 14.3 32 32 32 70.7 0 128 57.3 128 128 0 17.7 14.3 32 32 32s32-14.3 32-32c0-106-86-192-192-192-17.7 0-32 14.3-32 32m-96 16c0-26.5-21.5-48-48-48S0 117.5 0 144v224c0 79.5 64.5 144 144 144s144-64.5 144-144-64.5-144-144-144h-16v96h16c26.5 0 48 21.5 48 48s-21.5 48-48 48-48-21.5-48-48z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://research.anoma.net" target="_blank" rel="noopener" title="research.anoma.net" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M225.9 32C103.3 32 0 130.5 0 252.1 0 256 .1 480 .1 480l225.8-.2c122.7 0 222.1-102.3 222.1-223.9S348.6 32 225.9 32M224 384c-19.4 0-37.9-4.3-54.4-12.1L88.5 392l22.9-75c-9.8-18.1-15.4-38.9-15.4-61 0-70.7 57.3-128 128-128s128 57.3 128 128-57.3 128-128 128"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://youtube.com/anoma" target="_blank" rel="noopener" title="youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305m-317.51 213.508V175.185l142.739 81.205z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:arts@heliax.dev" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.path", "navigation.prune", "navigation.tabs", "navigation.sections", "navigation.indexes", "search.highlight", "search.suggest", "search.sharing", "toc.follow"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d6f25eb3.min.js"></script>
      
        <script src="../../js/timeago.min.js"></script>
      
        <script src="../../js/timeago_mkdocs_material.js"></script>
      
        <script src="../../assets/js/extra.js"></script>
      
        <script src="../../assets/js/highlight.js"></script>
      
        <script src="../../assets/js/mathjax.js"></script>
      
        <script src="../../assets/js/tex-svg-full.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>