<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"><meta charset="UTF-8"><link href="https://specs.anoma.net/pr-355/assets/css/juvix-catppuchin.css" rel="stylesheet" type="text/css"><link href="https://specs.anoma.net/pr-355/assets/css/latte-light.css" rel="stylesheet" type="text/css"><link href="https://specs.anoma.net/pr-355/assets/css/juvix-source.css" rel="stylesheet" type="text/css"><script src="https://specs.anoma.net/pr-355/assets/js/highlight.js" type="text/javascript"></script><div id="package-header"><span class="caption"></span></div><pre id="src-content"><span class="ju-keyword">module</span> <span id="arch.node.integration.simulator"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator" class="ju-code-link ju-module"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">arch.node.integration.simulator</span></span></a></span></a></span></span><span class="ju-delimiter">;</span>

<span class="ju-keyword">import</span> <span id="prelude"><span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#prelude" class="ju-code-link ju-module"><span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#prelude" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">prelude</span></span></a></span></a></span></span> <span class="ju-keyword">open</span><span class="ju-delimiter">;</span>

<span class="ju-keyword">open</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#OMap" class="ju-code-link ju-module"><span class="ju-module">OMap</span></a></span><span class="ju-delimiter">;</span>

<span class="ju-keyword">import</span> <span id="arch.node.types.basics"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/basics-src.html#arch.node.types.basics" class="ju-code-link ju-module"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/basics-src.html#arch.node.types.basics" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">arch.node.types.basics</span></span></a></span></a></span></span> <span class="ju-keyword">open</span> <span class="ju-keyword">public</span><span class="ju-delimiter">;</span>
<span class="ju-keyword">import</span> <span id="arch.node.types.messages"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#arch.node.types.messages" class="ju-code-link ju-module"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#arch.node.types.messages" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">arch.node.types.messages</span></span></a></span></a></span></span> <span class="ju-keyword">open</span> <span class="ju-keyword">public</span><span class="ju-delimiter">;</span>
<span class="ju-keyword">import</span> <span id="arch.node.types.identities"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/identities-src.html#arch.node.types.identities" class="ju-code-link ju-module"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/identities-src.html#arch.node.types.identities" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">arch.node.types.identities</span></span></a></span></a></span></span> <span class="ju-keyword">open</span><span class="ju-delimiter">;</span>
<span class="ju-keyword">import</span> <span id="arch.node.types.engine_config"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_config-src.html#arch.node.types.engine_config" class="ju-code-link ju-module"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_config-src.html#arch.node.types.engine_config" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">arch.node.types.engine_config</span></span></a></span></a></span></span> <span class="ju-keyword">open</span> <span class="ju-keyword">public</span><span class="ju-delimiter">;</span>
<span class="ju-keyword">import</span> <span id="arch.node.types.engine_environment"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_environment-src.html#arch.node.types.engine_environment" class="ju-code-link ju-module"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_environment-src.html#arch.node.types.engine_environment" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">arch.node.types.engine_environment</span></span></a></span></a></span></span> <span class="ju-keyword">open</span><span class="ju-delimiter">;</span>
<span class="ju-keyword">import</span> <span id="arch.node.types.engine_behaviour"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#arch.node.types.engine_behaviour" class="ju-code-link ju-module"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#arch.node.types.engine_behaviour" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">arch.node.types.engine_behaviour</span></span></a></span></a></span></span> <span class="ju-keyword">open</span><span class="ju-delimiter">;</span>
<span class="ju-keyword">import</span> <span id="arch.node.types.engine"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine-src.html#arch.node.types.engine" class="ju-code-link ju-module"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine-src.html#arch.node.types.engine" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">arch.node.types.engine</span></span></a></span></a></span></span> <span class="ju-keyword">open</span> <span class="ju-keyword">public</span><span class="ju-delimiter">;</span>
<span class="ju-keyword">import</span> <span id="arch.node.types.anoma_engines"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#arch.node.types.anoma_engines" class="ju-code-link ju-module"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#arch.node.types.anoma_engines" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">arch.node.types.anoma_engines</span></span></a></span></a></span></span> <span class="ju-keyword">open</span><span class="ju-delimiter">;</span>
<span class="ju-keyword">import</span> <span id="arch.node.types.anoma_message"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_message-src.html#arch.node.types.anoma_message" class="ju-code-link ju-module"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_message-src.html#arch.node.types.anoma_message" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">arch.node.types.anoma_message</span></span></a></span></a></span></span> <span class="ju-keyword">open</span><span class="ju-delimiter">;</span>
<span class="ju-keyword">import</span> <span id="arch.node.types.anoma_config"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_config-src.html#arch.node.types.anoma_config" class="ju-code-link ju-module"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_config-src.html#arch.node.types.anoma_config" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">arch.node.types.anoma_config</span></span></a></span></a></span></span> <span class="ju-keyword">open</span><span class="ju-delimiter">;</span>
<span class="ju-keyword">import</span> <span id="arch.node.types.anoma_environment"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_environment-src.html#arch.node.types.anoma_environment" class="ju-code-link ju-module"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_environment-src.html#arch.node.types.anoma_environment" class="ju-code-link ju-module"><span class="ju-module"><span class="ju-module">arch.node.types.anoma_environment</span></span></a></span></a></span></span> <span class="ju-keyword">open</span><span class="ju-delimiter">;</span>
<span id="MessageSelector"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#MessageSelector" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#MessageSelector" class="ju-code-link ju-function"><span class="ju-function">
<span class="ju-comment">-- Type for message selection strategy</span>
MessageSelector</span></a></span></a></span></span> <span class="ju-keyword">:</span> <span class="ju-keyword">Type</span> <span class="ju-keyword">:=</span>
  <span class="ju-delimiter">(</span><span id="arch.node.integration.simulator:23"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:23" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:23" class="ju-code-link ju-var"><span class="ju-var">messages</span></a></span></a></span></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List" class="ju-code-link ju-inductive"><span class="ju-inductive">List</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#EngineMsg" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>EngineMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_message-src.html#Msg" class="ju-code-link ju-inductive"><span class="ju-inductive">Msg</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
    <span class="ju-keyword">-&gt;</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#Option" class="ju-code-link ju-var"><span class="ju-inductive">Option</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Stdlib/Data/Pair/Base-src.html#Pair" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>Pair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#EngineMsg" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>EngineMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_message-src.html#Msg" class="ju-code-link ju-inductive"><span class="ju-inductive">Msg</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>List</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#EngineMsg" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>EngineMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_message-src.html#Msg" class="ju-code-link ju-inductive"><span class="ju-inductive">Msg</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">;</span>
<span id="selectFirstMessage"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#selectFirstMessage" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#selectFirstMessage" class="ju-code-link ju-function"><span class="ju-function">
<span class="ju-comment">-- Example selector that takes the first message in the list</span>
selectFirstMessage</span></a></span></a></span></span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:24" class="ju-code-link ju-var"><span class="ju-var">messages</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List" class="ju-code-link ju-inductive"><span class="ju-inductive">List</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#EngineMsg" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>EngineMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_message-src.html#Msg" class="ju-code-link ju-inductive"><span class="ju-inductive">Msg</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
  <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#Option" class="ju-code-link ju-var"><span class="ju-inductive">Option</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Stdlib/Data/Pair/Base-src.html#Pair" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>Pair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#EngineMsg" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>EngineMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_message-src.html#Msg" class="ju-code-link ju-inductive"><span class="ju-inductive">Msg</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>List</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#EngineMsg" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>EngineMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_message-src.html#Msg" class="ju-code-link ju-inductive"><span class="ju-inductive">Msg</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:24" class="ju-code-link ju-var"><span class="ju-var">messages</span></a></span> <span class="ju-keyword">of</span>
    <span class="ju-keyword">|</span> <span class="ju-delimiter">[</span><span class="ju-delimiter">]</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
    <span class="ju-keyword">|</span> <span id="arch.node.integration.simulator:25"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:25" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:25" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List.::" class="ju-code-link ju-constructor"><span class="ju-constructor">::</span></a></span> <span id="arch.node.integration.simulator:26"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:26" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:26" class="ju-code-link ju-var"><span class="ju-var">rest</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:25" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:26" class="ju-code-link ju-var"><span class="ju-var">rest</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">;</span>

<span class="ju-comment">-- Node type that contains a map from engine names to engines</span>
<span class="ju-keyword">type</span> <span id="Node"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#Node" class="ju-code-link ju-inductive"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#Node" class="ju-code-link ju-inductive"><span class="ju-inductive">Node</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
  <span id="Node.mkNode"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#Node.mkNode" class="ju-code-link ju-constructor"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#Node.mkNode" class="ju-code-link ju-constructor"><span class="ju-constructor">mkNode</span></a></span></a></span></span><span class="ju-keyword">@</span><span class="ju-delimiter">{</span>
    <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:28" class="ju-code-link ju-var"><span class="ju-var">engines</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#OMap.OMap" class="ju-code-link ju-inductive"><span class="ju-inductive">OMap</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/identities-src.html#EngineName" class="ju-code-link ju-var"><span class="ju-axiom">EngineName</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng" class="ju-code-link ju-inductive"><span class="ju-inductive">Eng</span></a></span><span class="ju-delimiter">;</span>
  <span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>

<span class="ju-comment">-- Network state contains all nodes, in-transit messages, and current time</span>
<span class="ju-keyword">type</span> <span id="NetworkState"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState" class="ju-code-link ju-inductive"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState" class="ju-code-link ju-inductive"><span class="ju-inductive">NetworkState</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
  <span id="NetworkState.mkNetworkState"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState.mkNetworkState" class="ju-code-link ju-constructor"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState.mkNetworkState" class="ju-code-link ju-constructor"><span class="ju-constructor">mkNetworkState</span></a></span></a></span></span><span class="ju-keyword">@</span><span class="ju-delimiter">{</span>
    <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:35" class="ju-code-link ju-var"><span class="ju-var">nodes</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#OMap.OMap" class="ju-code-link ju-inductive"><span class="ju-inductive">OMap</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/identities-src.html#NodeID" class="ju-code-link ju-var"><span class="ju-inductive">NodeID</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#Node" class="ju-code-link ju-inductive"><span class="ju-inductive">Node</span></a></span><span class="ju-delimiter">;</span>
    <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:36" class="ju-code-link ju-var"><span class="ju-var">messages</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List" class="ju-code-link ju-inductive"><span class="ju-inductive">List</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#EngineMsg" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>EngineMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_message-src.html#Msg" class="ju-code-link ju-inductive"><span class="ju-inductive">Msg</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">;</span>
    <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:37" class="ju-code-link ju-var"><span class="ju-var">currentTime</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/basics-src.html#Time" class="ju-code-link ju-function"><span class="ju-function">Time</span></a></span><span class="ju-delimiter">;</span>
    <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:38" class="ju-code-link ju-var"><span class="ju-var">incrementId</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/identities-src.html#NodeID" class="ju-code-link ju-var"><span class="ju-inductive">NodeID</span></a></span> <span class="ju-keyword">-&gt;</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/identities-src.html#NodeID" class="ju-code-link ju-var"><span class="ju-inductive">NodeID</span></a></span><span class="ju-delimiter">;</span>
    <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:39" class="ju-code-link ju-var"><span class="ju-var">nextId</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/identities-src.html#NodeID" class="ju-code-link ju-var"><span class="ju-inductive">NodeID</span></a></span><span class="ju-delimiter">;</span>
  <span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
<span id="executeGuardOutput"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#executeGuardOutput" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#executeGuardOutput" class="ju-code-link ju-function"><span class="ju-function">
<span class="ju-comment">-- Helper function to execute a guard output</span>
executeGuardOutput</span></a></span></a></span></span>
  <span class="ju-delimiter">{</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:45" class="ju-code-link ju-var"><span class="ju-var">C</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:46" class="ju-code-link ju-var"><span class="ju-var">S</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:47" class="ju-code-link ju-var"><span class="ju-var">B</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:48" class="ju-code-link ju-var"><span class="ju-var">H</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:49" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:50" class="ju-code-link ju-var"><span class="ju-var">AM</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:51" class="ju-code-link ju-var"><span class="ju-var">AC</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:52" class="ju-code-link ju-var"><span class="ju-var">AE</span></a></span> <span class="ju-keyword">:</span> <span class="ju-keyword">Type</span><span class="ju-delimiter">}</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:53" class="ju-code-link ju-var"><span class="ju-var">output</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#GuardOutput" class="ju-code-link ju-inductive"><span class="ju-inductive">GuardOutput</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:45" class="ju-code-link ju-var"><span class="ju-var">C</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:46" class="ju-code-link ju-var"><span class="ju-var">S</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:47" class="ju-code-link ju-var"><span class="ju-var">B</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:48" class="ju-code-link ju-var"><span class="ju-var">H</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:49" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:50" class="ju-code-link ju-var"><span class="ju-var">AM</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:51" class="ju-code-link ju-var"><span class="ju-var">AC</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:52" class="ju-code-link ju-var"><span class="ju-var">AE</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:54" class="ju-code-link ju-var"><span class="ju-var">eng</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine-src.html#Engine" class="ju-code-link ju-inductive"><span class="ju-inductive">Engine</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:45" class="ju-code-link ju-var"><span class="ju-var">C</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:46" class="ju-code-link ju-var"><span class="ju-var">S</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:47" class="ju-code-link ju-var"><span class="ju-var">B</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:48" class="ju-code-link ju-var"><span class="ju-var">H</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:49" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:50" class="ju-code-link ju-var"><span class="ju-var">AM</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:51" class="ju-code-link ju-var"><span class="ju-var">AC</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:52" class="ju-code-link ju-var"><span class="ju-var">AE</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:55" class="ju-code-link ju-var"><span class="ju-var">trigger</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#TimestampedTrigger" class="ju-code-link ju-inductive"><span class="ju-inductive">TimestampedTrigger</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:48" class="ju-code-link ju-var"><span class="ju-var">H</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:50" class="ju-code-link ju-var"><span class="ju-var">AM</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#Option" class="ju-code-link ju-var"><span class="ju-inductive">Option</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#ActionEffect" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>ActionEffect</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:46" class="ju-code-link ju-var"><span class="ju-var">S</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:47" class="ju-code-link ju-var"><span class="ju-var">B</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:48" class="ju-code-link ju-var"><span class="ju-var">H</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:50" class="ju-code-link ju-var"><span class="ju-var">AM</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:51" class="ju-code-link ju-var"><span class="ju-var">AC</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:52" class="ju-code-link ju-var"><span class="ju-var">AE</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:53" class="ju-code-link ju-var"><span class="ju-var">output</span></a></span> <span class="ju-keyword">of</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#GuardOutput.mk" class="ju-code-link ju-constructor"><span class="ju-constructor">GuardOutput<span class="ju-delimiter">.</span>mk</span></a></span><span class="ju-keyword">@</span><span class="ju-delimiter">{</span>action <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#ActionExec.Seq" class="ju-code-link ju-constructor"><span class="ju-constructor">ActionExec<span class="ju-delimiter">.</span>Seq</span></a></span> <span id="arch.node.integration.simulator:56"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:56" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:56" class="ju-code-link ju-var"><span class="ju-var">actions</span></a></span></a></span></span><span class="ju-delimiter">;</span> args <span class="ju-keyword">:=</span> <span id="arch.node.integration.simulator:57"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:57" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:57" class="ju-code-link ju-var"><span class="ju-var">args</span></a></span></a></span></span><span class="ju-delimiter">}</span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">let</span>
        <span class="ju-comment">-- Execute each action in sequence</span>
        <span class="ju-keyword">terminating</span>
        <span id="executeAction"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#executeAction" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#executeAction" class="ju-code-link ju-function"><span class="ju-function">executeAction</span></a></span></a></span></span>
          <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:59" class="ju-code-link ju-var"><span class="ju-var">acts</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List" class="ju-code-link ju-inductive"><span class="ju-inductive">List</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#Action" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>Action</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:45" class="ju-code-link ju-var"><span class="ju-var">C</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:46" class="ju-code-link ju-var"><span class="ju-var">S</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:47" class="ju-code-link ju-var"><span class="ju-var">B</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:48" class="ju-code-link ju-var"><span class="ju-var">H</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:49" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:50" class="ju-code-link ju-var"><span class="ju-var">AM</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:51" class="ju-code-link ju-var"><span class="ju-var">AC</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:52" class="ju-code-link ju-var"><span class="ju-var">AE</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
          <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:60" class="ju-code-link ju-var"><span class="ju-var">currentEnv</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_environment-src.html#EngineEnv" class="ju-code-link ju-inductive"><span class="ju-inductive">EngineEnv</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:46" class="ju-code-link ju-var"><span class="ju-var">S</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:47" class="ju-code-link ju-var"><span class="ju-var">B</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:48" class="ju-code-link ju-var"><span class="ju-var">H</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:50" class="ju-code-link ju-var"><span class="ju-var">AM</span></a></span><span class="ju-delimiter">)</span>
          <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#Option" class="ju-code-link ju-var"><span class="ju-inductive">Option</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#ActionEffect" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>ActionEffect</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:46" class="ju-code-link ju-var"><span class="ju-var">S</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:47" class="ju-code-link ju-var"><span class="ju-var">B</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:48" class="ju-code-link ju-var"><span class="ju-var">H</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:50" class="ju-code-link ju-var"><span class="ju-var">AM</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:51" class="ju-code-link ju-var"><span class="ju-var">AC</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:52" class="ju-code-link ju-var"><span class="ju-var">AE</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:59" class="ju-code-link ju-var"><span class="ju-var">acts</span></a></span> <span class="ju-keyword">of</span>
            <span class="ju-keyword">|</span> <span class="ju-delimiter">[</span><span class="ju-delimiter">]</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
            <span class="ju-keyword">|</span> <span id="arch.node.integration.simulator:61"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:61" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:61" class="ju-code-link ju-var"><span class="ju-var">act</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List.::" class="ju-code-link ju-constructor"><span class="ju-constructor">::</span></a></span> <span id="arch.node.integration.simulator:62"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:62" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:62" class="ju-code-link ju-var"><span class="ju-var">rest</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
              <span class="ju-keyword">case</span>
                <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:61" class="ju-code-link ju-var"><span class="ju-var">act</span></a></span>
                  <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#ActionInput.mk" class="ju-code-link ju-constructor"><span class="ju-constructor">ActionInput<span class="ju-delimiter">.</span>mk</span></a></span><span class="ju-keyword">@</span><span class="ju-delimiter">{</span>
                    <span id="arch.node.integration.simulator:69"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:69" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:69" class="ju-code-link ju-function"><span class="ju-function">args</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:57" class="ju-code-link ju-var"><span class="ju-var">args</span></a></span><span class="ju-delimiter">;</span>
                    <span id="arch.node.integration.simulator:70"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:70" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:70" class="ju-code-link ju-function"><span class="ju-function">cfg</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine-src.html#Engine.cfg" class="ju-code-link ju-function"><span class="ju-function">Engine<span class="ju-delimiter">.</span>cfg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:54" class="ju-code-link ju-var"><span class="ju-var">eng</span></a></span><span class="ju-delimiter">;</span>
                    <span id="arch.node.integration.simulator:71"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:71" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:71" class="ju-code-link ju-function"><span class="ju-function">env</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:60" class="ju-code-link ju-var"><span class="ju-var">currentEnv</span></a></span><span class="ju-delimiter">;</span>
                    <span id="arch.node.integration.simulator:72"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:72" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:72" class="ju-code-link ju-function"><span class="ju-function">trigger</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:55" class="ju-code-link ju-var"><span class="ju-var">trigger</span></a></span><span class="ju-delimiter">;</span>
                  <span class="ju-delimiter">}</span>
              <span class="ju-keyword">of</span>
                <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#executeAction" class="ju-code-link ju-function"><span class="ju-function">executeAction</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:62" class="ju-code-link ju-var"><span class="ju-var">rest</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:60" class="ju-code-link ju-var"><span class="ju-var">currentEnv</span></a></span>
                <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="arch.node.integration.simulator:63"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:63" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:63" class="ju-code-link ju-var"><span class="ju-var">effect</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                  <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#executeAction" class="ju-code-link ju-function"><span class="ju-function">executeAction</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:62" class="ju-code-link ju-var"><span class="ju-var">rest</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#ActionEffect.env" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>ActionEffect<span class="ju-delimiter">.</span>env</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:63" class="ju-code-link ju-var"><span class="ju-var">effect</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">of</span>
                    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:63" class="ju-code-link ju-var"><span class="ju-var">effect</span></a></span>
                    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="arch.node.integration.simulator:64"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:64" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:64" class="ju-code-link ju-var"><span class="ju-var">nextEffect</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                      <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span>
                        <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#ActionEffect.mk" class="ju-code-link ju-constructor"><span class="ju-constructor">ActionEffect<span class="ju-delimiter">.</span>mk</span></a></span><span class="ju-keyword">@</span><span class="ju-delimiter">{</span>
                          <span id="arch.node.integration.simulator:65"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:65" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:65" class="ju-code-link ju-function"><span class="ju-function">env</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#ActionEffect.env" class="ju-code-link ju-function"><span class="ju-function">ActionEffect<span class="ju-delimiter">.</span>env</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:64" class="ju-code-link ju-var"><span class="ju-var">nextEffect</span></a></span><span class="ju-delimiter">;</span>
                          <span id="arch.node.integration.simulator:66"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:66" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:66" class="ju-code-link ju-function"><span class="ju-function">msgs</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                            <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#ActionEffect.msgs" class="ju-code-link ju-function"><span class="ju-function">ActionEffect<span class="ju-delimiter">.</span>msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:63" class="ju-code-link ju-var"><span class="ju-var">effect</span></a></span>
                              <span class="annot"><a href="https://specs.anoma.net/pr-355/Stdlib/Data/List/Base-src.html#++" class="ju-code-link ju-function"><span class="ju-function">++</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#ActionEffect.msgs" class="ju-code-link ju-function"><span class="ju-function">ActionEffect<span class="ju-delimiter">.</span>msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:64" class="ju-code-link ju-var"><span class="ju-var">nextEffect</span></a></span><span class="ju-delimiter">;</span>
                          <span id="arch.node.integration.simulator:67"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:67" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:67" class="ju-code-link ju-function"><span class="ju-function">timers</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                            <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#ActionEffect.timers" class="ju-code-link ju-function"><span class="ju-function">ActionEffect<span class="ju-delimiter">.</span>timers</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:63" class="ju-code-link ju-var"><span class="ju-var">effect</span></a></span>
                              <span class="annot"><a href="https://specs.anoma.net/pr-355/Stdlib/Data/List/Base-src.html#++" class="ju-code-link ju-function"><span class="ju-function">++</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#ActionEffect.timers" class="ju-code-link ju-function"><span class="ju-function">ActionEffect<span class="ju-delimiter">.</span>timers</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:64" class="ju-code-link ju-var"><span class="ju-var">nextEffect</span></a></span><span class="ju-delimiter">;</span>
                          <span id="arch.node.integration.simulator:68"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:68" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:68" class="ju-code-link ju-function"><span class="ju-function">engines</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                            <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#ActionEffect.engines" class="ju-code-link ju-function"><span class="ju-function">ActionEffect<span class="ju-delimiter">.</span>engines</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:63" class="ju-code-link ju-var"><span class="ju-var">effect</span></a></span>
                              <span class="annot"><a href="https://specs.anoma.net/pr-355/Stdlib/Data/List/Base-src.html#++" class="ju-code-link ju-function"><span class="ju-function">++</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#ActionEffect.engines" class="ju-code-link ju-function"><span class="ju-function">ActionEffect<span class="ju-delimiter">.</span>engines</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:64" class="ju-code-link ju-var"><span class="ju-var">nextEffect</span></a></span><span class="ju-delimiter">;</span>
                        <span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
      <span class="ju-keyword">in</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#executeAction" class="ju-code-link ju-function"><span class="ju-function">executeAction</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:56" class="ju-code-link ju-var"><span class="ju-var">actions</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine-src.html#Engine.env" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>Engine<span class="ju-delimiter">.</span>env</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:54" class="ju-code-link ju-var"><span class="ju-var">eng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">;</span>

<span class="ju-comment">-- Helper function to evaluate guards and execute actions for a specific engine type</span>
<span class="ju-keyword">terminating</span>
<span id="evaluateAndExecute"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span></a></span></span>
  <span class="ju-delimiter">{</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:73" class="ju-code-link ju-var"><span class="ju-var">C</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:74" class="ju-code-link ju-var"><span class="ju-var">S</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:75" class="ju-code-link ju-var"><span class="ju-var">B</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:76" class="ju-code-link ju-var"><span class="ju-var">H</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:77" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:78" class="ju-code-link ju-var"><span class="ju-var">AM</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:79" class="ju-code-link ju-var"><span class="ju-var">AC</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:80" class="ju-code-link ju-var"><span class="ju-var">AE</span></a></span> <span class="ju-keyword">:</span> <span class="ju-keyword">Type</span><span class="ju-delimiter">}</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:81" class="ju-code-link ju-var"><span class="ju-var">eng</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine-src.html#Engine" class="ju-code-link ju-inductive"><span class="ju-inductive">Engine</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:73" class="ju-code-link ju-var"><span class="ju-var">C</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:74" class="ju-code-link ju-var"><span class="ju-var">S</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:75" class="ju-code-link ju-var"><span class="ju-var">B</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:76" class="ju-code-link ju-var"><span class="ju-var">H</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:77" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:78" class="ju-code-link ju-var"><span class="ju-var">AM</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:79" class="ju-code-link ju-var"><span class="ju-var">AC</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:80" class="ju-code-link ju-var"><span class="ju-var">AE</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:82" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#EngineMsg" class="ju-code-link ju-inductive"><span class="ju-inductive">EngineMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:78" class="ju-code-link ju-var"><span class="ju-var">AM</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#Option" class="ju-code-link ju-var"><span class="ju-inductive">Option</span></a></span>
    <span class="annot"><a href="https://specs.anoma.net/pr-355/Stdlib/Data/Pair/Base-src.html#Pair" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>Pair</span></a></span>
      <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>List</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#EngineMsg" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>EngineMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:78" class="ju-code-link ju-var"><span class="ju-var">AM</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="annot"><a href="https://specs.anoma.net/pr-355/Stdlib/Data/Pair/Base-src.html#Pair" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>Pair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>List</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Stdlib/Data/Pair/Base-src.html#Pair" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>Pair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:79" class="ju-code-link ju-var"><span class="ju-var">AC</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:80" class="ju-code-link ju-var"><span class="ju-var">AE</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine-src.html#Engine" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>Engine</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:73" class="ju-code-link ju-var"><span class="ju-var">C</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:74" class="ju-code-link ju-var"><span class="ju-var">S</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:75" class="ju-code-link ju-var"><span class="ju-var">B</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:76" class="ju-code-link ju-var"><span class="ju-var">H</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:77" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:78" class="ju-code-link ju-var"><span class="ju-var">AM</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:79" class="ju-code-link ju-var"><span class="ju-var">AC</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:80" class="ju-code-link ju-var"><span class="ju-var">AE</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">let</span>
    <span id="trigger"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#trigger" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#trigger" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Create a trigger from the message</span>
    trigger</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#TimestampedTrigger.mkTimestampedTrigger" class="ju-code-link ju-constructor"><span class="ju-constructor">TimestampedTrigger<span class="ju-delimiter">.</span>mkTimestampedTrigger</span></a></span><span class="ju-keyword">@</span><span class="ju-delimiter">{</span>
        <span id="arch.node.integration.simulator:83"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:83" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:83" class="ju-code-link ju-function"><span class="ju-function">time</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#right" class="ju-code-link ju-var"><span class="ju-constructor">right</span></a></span> <span class="ju-number">0</span><span class="ju-delimiter">;</span>
        <span id="arch.node.integration.simulator:85"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:85" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:85" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Dummy time value for now</span>
        trigger</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#Trigger.MessageArrived" class="ju-code-link ju-constructor"><span class="ju-constructor">Trigger<span class="ju-delimiter">.</span>MessageArrived</span></a></span><span class="ju-keyword">@</span><span class="ju-delimiter">{</span>
            <span id="arch.node.integration.simulator:84"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:84" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:84" class="ju-code-link ju-function"><span class="ju-function">msg</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:82" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span><span class="ju-delimiter">;</span>
          <span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
      <span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
    <span id="behaviour"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#behaviour" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#behaviour" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Get the engine&#39;s behaviour</span>
    behaviour</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine-src.html#Engine.behaviour" class="ju-code-link ju-function"><span class="ju-function">Engine<span class="ju-delimiter">.</span>behaviour</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:81" class="ju-code-link ju-var"><span class="ju-var">eng</span></a></span><span class="ju-delimiter">;</span>
    <span id="guardResult"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#guardResult" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#guardResult" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Evaluate guards based on strategy</span>
    guardResult</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#EngineBehaviour.guards" class="ju-code-link ju-function"><span class="ju-function">EngineBehaviour<span class="ju-delimiter">.</span>guards</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#behaviour" class="ju-code-link ju-function"><span class="ju-function">behaviour</span></a></span> <span class="ju-keyword">of</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#GuardEval.First" class="ju-code-link ju-constructor"><span class="ju-constructor">GuardEval<span class="ju-delimiter">.</span>First</span></a></span> <span id="arch.node.integration.simulator:88"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:88" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:88" class="ju-code-link ju-var"><span class="ju-var">guards</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
          <span class="ju-keyword">let</span>
            <span class="ju-comment">-- Try each guard until one matches</span>
            <span class="ju-keyword">terminating</span>
            <span id="tryGuard"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#tryGuard" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#tryGuard" class="ju-code-link ju-function"><span class="ju-function">tryGuard</span></a></span></a></span></span>
              <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:90" class="ju-code-link ju-var"><span class="ju-var">gs</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List" class="ju-code-link ju-inductive"><span class="ju-inductive">List</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#Guard" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>Guard</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:73" class="ju-code-link ju-var"><span class="ju-var">C</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:74" class="ju-code-link ju-var"><span class="ju-var">S</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:75" class="ju-code-link ju-var"><span class="ju-var">B</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:76" class="ju-code-link ju-var"><span class="ju-var">H</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:77" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:78" class="ju-code-link ju-var"><span class="ju-var">AM</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:79" class="ju-code-link ju-var"><span class="ju-var">AC</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:80" class="ju-code-link ju-var"><span class="ju-var">AE</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
              <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#Option" class="ju-code-link ju-var"><span class="ju-inductive">Option</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#GuardOutput" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>GuardOutput</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:73" class="ju-code-link ju-var"><span class="ju-var">C</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:74" class="ju-code-link ju-var"><span class="ju-var">S</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:75" class="ju-code-link ju-var"><span class="ju-var">B</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:76" class="ju-code-link ju-var"><span class="ju-var">H</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:77" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:78" class="ju-code-link ju-var"><span class="ju-var">AM</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:79" class="ju-code-link ju-var"><span class="ju-var">AC</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:80" class="ju-code-link ju-var"><span class="ju-var">AE</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
              <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:90" class="ju-code-link ju-var"><span class="ju-var">gs</span></a></span> <span class="ju-keyword">of</span>
                <span class="ju-keyword">|</span> <span class="ju-delimiter">[</span><span class="ju-delimiter">]</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
                <span class="ju-keyword">|</span> <span id="arch.node.integration.simulator:91"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:91" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:91" class="ju-code-link ju-var"><span class="ju-var">g</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List.::" class="ju-code-link ju-constructor"><span class="ju-constructor">::</span></a></span> <span id="arch.node.integration.simulator:92"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:92" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:92" class="ju-code-link ju-var"><span class="ju-var">rest</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                  <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:91" class="ju-code-link ju-var"><span class="ju-var">g</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#trigger" class="ju-code-link ju-function"><span class="ju-function">trigger</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine-src.html#Engine.cfg" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>Engine<span class="ju-delimiter">.</span>cfg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:81" class="ju-code-link ju-var"><span class="ju-var">eng</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine-src.html#Engine.env" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>Engine<span class="ju-delimiter">.</span>env</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:81" class="ju-code-link ju-var"><span class="ju-var">eng</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">of</span>
                    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#tryGuard" class="ju-code-link ju-function"><span class="ju-function">tryGuard</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:92" class="ju-code-link ju-var"><span class="ju-var">rest</span></a></span>
                    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="arch.node.integration.simulator:93"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:93" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:93" class="ju-code-link ju-var"><span class="ju-var">output</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:93" class="ju-code-link ju-var"><span class="ju-var">output</span></a></span><span class="ju-delimiter">;</span>
          <span class="ju-keyword">in</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#tryGuard" class="ju-code-link ju-function"><span class="ju-function">tryGuard</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:88" class="ju-code-link ju-var"><span class="ju-var">guards</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#GuardEval.Any" class="ju-code-link ju-constructor"><span class="ju-constructor">GuardEval<span class="ju-delimiter">.</span>Any</span></a></span> <span id="arch.node.integration.simulator:94"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:94" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:94" class="ju-code-link ju-var"><span class="ju-var">guards</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
          <span class="ju-comment">-- What&#39;s this actually supposed to do?</span>
          <span class="ju-keyword">let</span>
            <span class="ju-comment">-- Try each guard until one matches</span>
            <span class="ju-keyword">terminating</span>
            <span id="tryGuard"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#tryGuard" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#tryGuard" class="ju-code-link ju-function"><span class="ju-function">tryGuard</span></a></span></a></span></span>
              <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:96" class="ju-code-link ju-var"><span class="ju-var">gs</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List" class="ju-code-link ju-inductive"><span class="ju-inductive">List</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#Guard" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>Guard</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:73" class="ju-code-link ju-var"><span class="ju-var">C</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:74" class="ju-code-link ju-var"><span class="ju-var">S</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:75" class="ju-code-link ju-var"><span class="ju-var">B</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:76" class="ju-code-link ju-var"><span class="ju-var">H</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:77" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:78" class="ju-code-link ju-var"><span class="ju-var">AM</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:79" class="ju-code-link ju-var"><span class="ju-var">AC</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:80" class="ju-code-link ju-var"><span class="ju-var">AE</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
              <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#Option" class="ju-code-link ju-var"><span class="ju-inductive">Option</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#GuardOutput" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>GuardOutput</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:73" class="ju-code-link ju-var"><span class="ju-var">C</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:74" class="ju-code-link ju-var"><span class="ju-var">S</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:75" class="ju-code-link ju-var"><span class="ju-var">B</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:76" class="ju-code-link ju-var"><span class="ju-var">H</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:77" class="ju-code-link ju-var"><span class="ju-var">A</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:78" class="ju-code-link ju-var"><span class="ju-var">AM</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:79" class="ju-code-link ju-var"><span class="ju-var">AC</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:80" class="ju-code-link ju-var"><span class="ju-var">AE</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
              <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:96" class="ju-code-link ju-var"><span class="ju-var">gs</span></a></span> <span class="ju-keyword">of</span>
                <span class="ju-keyword">|</span> <span class="ju-delimiter">[</span><span class="ju-delimiter">]</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
                <span class="ju-keyword">|</span> <span id="arch.node.integration.simulator:97"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:97" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:97" class="ju-code-link ju-var"><span class="ju-var">g</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List.::" class="ju-code-link ju-constructor"><span class="ju-constructor">::</span></a></span> <span id="arch.node.integration.simulator:98"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:98" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:98" class="ju-code-link ju-var"><span class="ju-var">rest</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                  <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:97" class="ju-code-link ju-var"><span class="ju-var">g</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#trigger" class="ju-code-link ju-function"><span class="ju-function">trigger</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine-src.html#Engine.cfg" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>Engine<span class="ju-delimiter">.</span>cfg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:81" class="ju-code-link ju-var"><span class="ju-var">eng</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine-src.html#Engine.env" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>Engine<span class="ju-delimiter">.</span>env</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:81" class="ju-code-link ju-var"><span class="ju-var">eng</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">of</span>
                    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#tryGuard" class="ju-code-link ju-function"><span class="ju-function">tryGuard</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:98" class="ju-code-link ju-var"><span class="ju-var">rest</span></a></span>
                    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="arch.node.integration.simulator:99"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:99" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:99" class="ju-code-link ju-var"><span class="ju-var">output</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:99" class="ju-code-link ju-var"><span class="ju-var">output</span></a></span><span class="ju-delimiter">;</span>
          <span class="ju-keyword">in</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#tryGuard" class="ju-code-link ju-function"><span class="ju-function">tryGuard</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:94" class="ju-code-link ju-var"><span class="ju-var">guards</span></a></span><span class="ju-delimiter">;</span>
    <span id="actionResult"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#actionResult" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#actionResult" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- If a guard matched, execute its action</span>
    actionResult</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#guardResult" class="ju-code-link ju-function"><span class="ju-function">guardResult</span></a></span> <span class="ju-keyword">of</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="arch.node.integration.simulator:101"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:101" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:101" class="ju-code-link ju-var"><span class="ju-var">output</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#executeGuardOutput" class="ju-code-link ju-function"><span class="ju-function">executeGuardOutput</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:101" class="ju-code-link ju-var"><span class="ju-var">output</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:81" class="ju-code-link ju-var"><span class="ju-var">eng</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#trigger" class="ju-code-link ju-function"><span class="ju-function">trigger</span></a></span><span class="ju-delimiter">;</span>
    <span id="updatedEngine"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#updatedEngine" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#updatedEngine" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- If an action was executed, update the engine with the new environment</span>
    updatedEngine</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#actionResult" class="ju-code-link ju-function"><span class="ju-function">actionResult</span></a></span> <span class="ju-keyword">of</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="arch.node.integration.simulator:103"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:103" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:103" class="ju-code-link ju-var"><span class="ju-var">effect</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:81" class="ju-code-link ju-var"><span class="ju-var">eng</span></a></span><span class="ju-keyword">@</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine-src.html#Engine" class="ju-code-link ju-inductive"><span class="ju-inductive">Engine</span></a></span><span class="ju-delimiter">{</span>env <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#ActionEffect.env" class="ju-code-link ju-function"><span class="ju-function">ActionEffect<span class="ju-delimiter">.</span>env</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:103" class="ju-code-link ju-var"><span class="ju-var">effect</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
  <span class="ju-keyword">in</span> <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#updatedEngine" class="ju-code-link ju-function"><span class="ju-function">updatedEngine</span></a></span> <span class="ju-keyword">of</span>
       <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
       <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="arch.node.integration.simulator:108"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:108" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:108" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
         <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#actionResult" class="ju-code-link ju-function"><span class="ju-function">actionResult</span></a></span> <span class="ju-keyword">of</span>
           <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
           <span class="ju-comment">-- Should this be all or nothing, like it is?</span>
           <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="arch.node.integration.simulator:109"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:109" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:109" class="ju-code-link ju-var"><span class="ju-var">effect</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
             <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span>
               <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span>
                 <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#ActionEffect.msgs" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>ActionEffect<span class="ju-delimiter">.</span>msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:109" class="ju-code-link ju-var"><span class="ju-var">effect</span></a></span><span class="ju-delimiter">)</span>
                 <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/engine_behaviour-src.html#ActionEffect.engines" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>ActionEffect<span class="ju-delimiter">.</span>engines</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:109" class="ju-code-link ju-var"><span class="ju-var">effect</span></a></span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:108" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">;</span>
<span id="evaluateAndExecuteEng"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecuteEng" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecuteEng" class="ju-code-link ju-function"><span class="ju-function">
<span class="ju-comment">-- Helper function to evaluate and execute for any engine type</span>
evaluateAndExecuteEng</span></a></span></a></span></span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:110" class="ju-code-link ju-var"><span class="ju-var">eng</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng" class="ju-code-link ju-inductive"><span class="ju-inductive">Eng</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#EngineMsg" class="ju-code-link ju-inductive"><span class="ju-inductive">EngineMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_message-src.html#Msg" class="ju-code-link ju-inductive"><span class="ju-inductive">Msg</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#Option" class="ju-code-link ju-var"><span class="ju-inductive">Option</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Stdlib/Data/Pair/Base-src.html#Pair" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>Pair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>List</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#EngineMsg" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>EngineMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_message-src.html#Msg" class="ju-code-link ju-inductive"><span class="ju-inductive">Msg</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Stdlib/Data/Pair/Base-src.html#Pair" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>Pair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>List</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Stdlib/Data/Pair/Base-src.html#Pair" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>Pair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_config-src.html#Cfg" class="ju-code-link ju-inductive"><span class="ju-inductive">Cfg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_environment-src.html#Env" class="ju-code-link ju-inductive"><span class="ju-inductive">Env</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng" class="ju-code-link ju-inductive"><span class="ju-inductive">Eng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:110" class="ju-code-link ju-var"><span class="ju-var">eng</span></a></span> <span class="ju-keyword">of</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.IdentityManagement" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>IdentityManagement</span></a></span> <span id="arch.node.integration.simulator:112"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:112" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:112" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:112" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:113"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:113" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:113" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:114"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:114" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:114" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:115"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:115" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:115" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span>
            <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:113" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:114" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.IdentityManagement" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>IdentityManagement</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:115" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Decryption" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>Decryption</span></a></span> <span id="arch.node.integration.simulator:116"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:116" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:116" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:116" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:117"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:117" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:117" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:118"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:118" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:118" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:119"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:119" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:119" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:117" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:118" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Decryption" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>Decryption</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:119" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Encryption" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>Encryption</span></a></span> <span id="arch.node.integration.simulator:120"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:120" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:120" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:120" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:121"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:121" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:121" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:122"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:122" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:122" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:123"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:123" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:123" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:121" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:122" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Encryption" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>Encryption</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:123" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Commitment" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>Commitment</span></a></span> <span id="arch.node.integration.simulator:124"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:124" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:124" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:124" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:125"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:125" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:125" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:126"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:126" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:126" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:127"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:127" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:127" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:125" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:126" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Commitment" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>Commitment</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:127" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Verification" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>Verification</span></a></span> <span id="arch.node.integration.simulator:128"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:128" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:128" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:128" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:129"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:129" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:129" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:130"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:130" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:130" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:131"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:131" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:131" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:129" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:130" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Verification" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>Verification</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:131" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.ReadsFor" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>ReadsFor</span></a></span> <span id="arch.node.integration.simulator:132"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:132" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:132" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:132" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:133"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:133" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:133" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:134"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:134" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:134" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:135"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:135" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:135" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:133" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:134" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.ReadsFor" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>ReadsFor</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:135" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.SignsFor" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>SignsFor</span></a></span> <span id="arch.node.integration.simulator:136"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:136" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:136" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:136" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:137"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:137" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:137" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:138"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:138" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:138" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:139"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:139" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:139" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:137" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:138" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.SignsFor" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>SignsFor</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:139" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Naming" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>Naming</span></a></span> <span id="arch.node.integration.simulator:140"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:140" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:140" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:140" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:141"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:141" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:141" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:142"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:142" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:142" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:143"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:143" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:143" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:141" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:142" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Naming" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>Naming</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:143" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.LocalKeyValueStorage" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>LocalKeyValueStorage</span></a></span> <span id="arch.node.integration.simulator:144"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:144" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:144" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:144" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:145"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:145" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:145" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:146"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:146" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:146" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:147"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:147" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:147" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span>
            <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:145" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:146" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.LocalKeyValueStorage" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>LocalKeyValueStorage</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:147" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Logging" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>Logging</span></a></span> <span id="arch.node.integration.simulator:148"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:148" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:148" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:148" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:149"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:149" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:149" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:150"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:150" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:150" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:151"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:151" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:151" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:149" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:150" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Logging" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>Logging</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:151" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.WallClock" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>WallClock</span></a></span> <span id="arch.node.integration.simulator:152"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:152" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:152" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:152" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:153"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:153" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:153" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:154"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:154" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:154" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:155"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:155" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:155" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:153" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:154" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.WallClock" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>WallClock</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:155" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.LocalTSeries" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>LocalTSeries</span></a></span> <span id="arch.node.integration.simulator:156"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:156" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:156" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:156" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:157"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:157" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:157" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:158"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:158" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:158" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:159"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:159" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:159" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:157" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:158" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.LocalTSeries" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>LocalTSeries</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:159" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Router" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>Router</span></a></span> <span id="arch.node.integration.simulator:160"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:160" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:160" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:160" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:161"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:161" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:161" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:162"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:162" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:162" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:163"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:163" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:163" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:161" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:162" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Router" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>Router</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:163" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.TransportProtocol" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>TransportProtocol</span></a></span> <span id="arch.node.integration.simulator:164"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:164" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:164" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:164" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:165"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:165" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:165" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:166"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:166" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:166" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:167"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:167" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:167" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:165" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:166" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.TransportProtocol" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>TransportProtocol</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:167" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.TransportConnection" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>TransportConnection</span></a></span> <span id="arch.node.integration.simulator:168"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:168" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:168" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:168" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:169"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:169" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:169" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:170"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:170" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:170" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:171"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:171" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:171" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span>
            <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:169" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:170" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.TransportConnection" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>TransportConnection</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:171" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.PubSubTopic" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>PubSubTopic</span></a></span> <span id="arch.node.integration.simulator:172"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:172" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:172" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:172" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:173"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:173" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:173" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:174"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:174" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:174" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:175"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:175" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:175" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:173" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:174" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.PubSubTopic" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>PubSubTopic</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:175" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Storage" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>Storage</span></a></span> <span id="arch.node.integration.simulator:176"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:176" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:176" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:176" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:177"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:177" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:177" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:178"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:178" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:178" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:179"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:179" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:179" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:177" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:178" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Storage" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>Storage</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:179" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.MempoolWorker" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>MempoolWorker</span></a></span> <span id="arch.node.integration.simulator:180"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:180" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:180" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:180" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:181"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:181" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:181" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:182"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:182" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:182" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:183"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:183" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:183" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:181" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:182" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.MempoolWorker" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>MempoolWorker</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:183" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Executor" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>Executor</span></a></span> <span id="arch.node.integration.simulator:184"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:184" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:184" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:184" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:185"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:185" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:185" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:186"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:186" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:186" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:187"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:187" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:187" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:185" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:186" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Executor" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>Executor</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:187" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Shard" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>Shard</span></a></span> <span id="arch.node.integration.simulator:188"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:188" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:188" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:188" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:189"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:189" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:189" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:190"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:190" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:190" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:191"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:191" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:191" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:189" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:190" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Shard" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>Shard</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:191" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Ticker" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>Ticker</span></a></span> <span id="arch.node.integration.simulator:192"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:192" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:192" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:192" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:193"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:193" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:193" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:194"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:194" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:194" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:195"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:195" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:195" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:193" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:194" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Ticker" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>Ticker</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:195" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Template" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>Template</span></a></span> <span id="arch.node.integration.simulator:196"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:196" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:196" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:196" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span> <span class="ju-delimiter">{</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:197"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:197" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:197" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:198"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:198" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:198" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:199"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:199" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:199" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:197" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:198" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.Template" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>Template</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:199" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
      <span class="ju-delimiter">}</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.TemplateMinimum" class="ju-code-link ju-constructor"><span class="ju-constructor">Eng<span class="ju-delimiter">.</span>TemplateMinimum</span></a></span> <span id="arch.node.integration.simulator:200"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:200" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:200" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecute" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecute</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:200" class="ju-code-link ju-var"><span class="ju-var">e</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:111" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span> <span class="ju-keyword">of</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:201"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:201" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:201" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:202"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:202" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:202" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:203"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:203" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:203" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:201" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:202" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng.TemplateMinimum" class="ju-code-link ju-constructor"><span class="ju-constructor"><span class="ju-delimiter">(</span>Eng<span class="ju-delimiter">.</span>TemplateMinimum</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:203" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span><span class="ju-delimiter">;</span>
<span id="addNewEngine"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#addNewEngine" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#addNewEngine" class="ju-code-link ju-function"><span class="ju-function">
<span class="ju-comment">-- Helper function to add a single new engine to a node</span>
addNewEngine</span></a></span></a></span></span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:204" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState" class="ju-code-link ju-inductive"><span class="ju-inductive">NetworkState</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:205" class="ju-code-link ju-var"><span class="ju-var">nodeId</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/identities-src.html#NodeID" class="ju-code-link ju-var"><span class="ju-inductive">NodeID</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:206" class="ju-code-link ju-var"><span class="ju-var">cfg</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_config-src.html#Cfg" class="ju-code-link ju-inductive"><span class="ju-inductive">Cfg</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:207" class="ju-code-link ju-var"><span class="ju-var">env</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_environment-src.html#Env" class="ju-code-link ju-inductive"><span class="ju-inductive">Env</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState" class="ju-code-link ju-inductive"><span class="ju-inductive">NetworkState</span></a></span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#OMap.lookup" class="ju-code-link ju-function"><span class="ju-function">OMap<span class="ju-delimiter">.</span>lookup</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:205" class="ju-code-link ju-var"><span class="ju-var">nodeId</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState.nodes" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>NetworkState<span class="ju-delimiter">.</span>nodes</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:204" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">of</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:204" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="arch.node.integration.simulator:208"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:208" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:208" class="ju-code-link ju-var"><span class="ju-var">node</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#mkEng" class="ju-code-link ju-function"><span class="ju-function">mkEng</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:205" class="ju-code-link ju-var"><span class="ju-var">nodeId</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:206" class="ju-code-link ju-var"><span class="ju-var">cfg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:207" class="ju-code-link ju-var"><span class="ju-var">env</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">of</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:204" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:209"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:209" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:209" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span> <span id="arch.node.integration.simulator:210"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:210" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:210" class="ju-code-link ju-var"><span class="ju-var">newEngineId</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="ju-keyword">let</span>
            <span id="engineName"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#engineName" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#engineName" class="ju-code-link ju-function"><span class="ju-function">engineName</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#snd" class="ju-code-link ju-function"><span class="ju-function">snd</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:210" class="ju-code-link ju-var"><span class="ju-var">newEngineId</span></a></span><span class="ju-delimiter">;</span>
            <span id="updatedNode"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#updatedNode" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#updatedNode" class="ju-code-link ju-function"><span class="ju-function">updatedNode</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
              <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:208" class="ju-code-link ju-var"><span class="ju-var">node</span></a></span><span class="ju-keyword">@</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#Node" class="ju-code-link ju-inductive"><span class="ju-inductive">Node</span></a></span><span class="ju-delimiter">{</span>engines <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#OMap.insert" class="ju-code-link ju-function"><span class="ju-function">OMap<span class="ju-delimiter">.</span>insert</span></a></span>
                <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#engineName" class="ju-code-link ju-function"><span class="ju-function">engineName</span></a></span>
                <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:209" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span>
                <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#Node.engines" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>Node<span class="ju-delimiter">.</span>engines</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:208" class="ju-code-link ju-var"><span class="ju-var">node</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
          <span class="ju-keyword">in</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:204" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span><span class="ju-keyword">@</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState" class="ju-code-link ju-inductive"><span class="ju-inductive">NetworkState</span></a></span><span class="ju-delimiter">{</span>nodes <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#OMap.insert" class="ju-code-link ju-function"><span class="ju-function">OMap<span class="ju-delimiter">.</span>insert</span></a></span>
            <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:205" class="ju-code-link ju-var"><span class="ju-var">nodeId</span></a></span>
            <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#updatedNode" class="ju-code-link ju-function"><span class="ju-function">updatedNode</span></a></span>
            <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState.nodes" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>NetworkState<span class="ju-delimiter">.</span>nodes</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:204" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
<span id="updateNetworkState"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#updateNetworkState" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#updateNetworkState" class="ju-code-link ju-function"><span class="ju-function">
<span class="ju-comment">-- Helper function to update an engine&#39;s state, add new messages, and create new engines</span>
updateNetworkState</span></a></span></a></span></span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:219" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState" class="ju-code-link ju-inductive"><span class="ju-inductive">NetworkState</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:220" class="ju-code-link ju-var"><span class="ju-var">target</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/identities-src.html#EngineID" class="ju-code-link ju-function"><span class="ju-function">EngineID</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:221" class="ju-code-link ju-var"><span class="ju-var">eng</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_engines-src.html#Eng" class="ju-code-link ju-inductive"><span class="ju-inductive">Eng</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:222" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List" class="ju-code-link ju-inductive"><span class="ju-inductive">List</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#EngineMsg" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>EngineMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_message-src.html#Msg" class="ju-code-link ju-inductive"><span class="ju-inductive">Msg</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:223" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List" class="ju-code-link ju-inductive"><span class="ju-inductive">List</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Stdlib/Data/Pair/Base-src.html#Pair" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>Pair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_config-src.html#Cfg" class="ju-code-link ju-inductive"><span class="ju-inductive">Cfg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_environment-src.html#Env" class="ju-code-link ju-inductive"><span class="ju-inductive">Env</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span>
  <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState" class="ju-code-link ju-inductive"><span class="ju-inductive">NetworkState</span></a></span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">let</span>
    <span id="nodeId"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#nodeId" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#nodeId" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Get the node ID from the target engine ID</span>
    nodeId</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:220" class="ju-code-link ju-var"><span class="ju-var">target</span></a></span> <span class="ju-keyword">of</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor">mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor">mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>some</span></a></span> <span id="arch.node.integration.simulator:224"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:224" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:224" class="ju-code-link ju-var"><span class="ju-var">nid</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:224" class="ju-code-link ju-var"><span class="ju-var">nid</span></a></span><span class="ju-delimiter">;</span>
    <span id="engineName"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#engineName" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#engineName" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Get the engine name from the target engine ID</span>
    engineName</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#snd" class="ju-code-link ju-function"><span class="ju-function">snd</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:220" class="ju-code-link ju-var"><span class="ju-var">target</span></a></span><span class="ju-delimiter">;</span>
    <span id="state&#39;"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#state&#39;" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#state&#39;" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Look up the target node and update it</span>
    state&#39;</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#nodeId" class="ju-code-link ju-function"><span class="ju-function">nodeId</span></a></span> <span class="ju-keyword">of</span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:219" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span>
        <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="arch.node.integration.simulator:227"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:227" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:227" class="ju-code-link ju-var"><span class="ju-var">nid</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
          <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#OMap.lookup" class="ju-code-link ju-function"><span class="ju-function">OMap<span class="ju-delimiter">.</span>lookup</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:227" class="ju-code-link ju-var"><span class="ju-var">nid</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState.nodes" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>NetworkState<span class="ju-delimiter">.</span>nodes</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:219" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">of</span>
            <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:219" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span>
            <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="arch.node.integration.simulator:228"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:228" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:228" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
              <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:219" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span><span class="ju-keyword">@</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState" class="ju-code-link ju-inductive"><span class="ju-inductive">NetworkState</span></a></span><span class="ju-delimiter">{</span>nodes <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#OMap.insert" class="ju-code-link ju-function"><span class="ju-function">OMap<span class="ju-delimiter">.</span>insert</span></a></span>
                <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:227" class="ju-code-link ju-var"><span class="ju-var">nid</span></a></span>
                <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:228" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span><span class="ju-keyword">@</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#Node" class="ju-code-link ju-inductive"><span class="ju-inductive">Node</span></a></span><span class="ju-delimiter">{</span>engines <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#OMap.insert" class="ju-code-link ju-function"><span class="ju-function">OMap<span class="ju-delimiter">.</span>insert</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#engineName" class="ju-code-link ju-function"><span class="ju-function">engineName</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:221" class="ju-code-link ju-var"><span class="ju-var">eng</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#Node.engines" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>Node<span class="ju-delimiter">.</span>engines</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:228" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span>
                <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState.nodes" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>NetworkState<span class="ju-delimiter">.</span>nodes</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:219" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
    <span id="stateWithMessages"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#stateWithMessages" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#stateWithMessages" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Then fold over the config/env pairs to create new engines in the target node</span>
    stateWithMessages</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#state&#39;" class="ju-code-link ju-function"><span class="ju-function">state&#39;</span></a></span><span class="ju-keyword">@</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState" class="ju-code-link ju-inductive"><span class="ju-inductive">NetworkState</span></a></span><span class="ju-delimiter">{</span>messages <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState.messages" class="ju-code-link ju-function"><span class="ju-function">NetworkState<span class="ju-delimiter">.</span>messages</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:219" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Stdlib/Data/List/Base-src.html#++" class="ju-code-link ju-function"><span class="ju-function">++</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:222" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
    <span id="finalState"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#finalState" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#finalState" class="ju-code-link ju-function"><span class="ju-function">finalState</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="annot"><a href="https://specs.anoma.net/pr-355/Stdlib/Trait/Foldable/Monomorphic-src.html#foldl" class="ju-code-link ju-function"><span class="ju-function">foldl</span></a></span>
        <span class="ju-keyword">\</span><span class="ju-delimiter">{</span><span id="arch.node.integration.simulator:242"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:242" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:242" class="ju-code-link ju-var"><span class="ju-var">s</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:243"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:243" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:243" class="ju-code-link ju-var"><span class="ju-var">cfg</span></a></span></a></span></span> <span id="arch.node.integration.simulator:244"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:244" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:244" class="ju-code-link ju-var"><span class="ju-var">env</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
          <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#nodeId" class="ju-code-link ju-function"><span class="ju-function">nodeId</span></a></span> <span class="ju-keyword">of</span>
            <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:242" class="ju-code-link ju-var"><span class="ju-var">s</span></a></span>
            <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="arch.node.integration.simulator:245"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:245" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:245" class="ju-code-link ju-var"><span class="ju-var">nid</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#addNewEngine" class="ju-code-link ju-function"><span class="ju-function">addNewEngine</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:242" class="ju-code-link ju-var"><span class="ju-var">s</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:245" class="ju-code-link ju-var"><span class="ju-var">nid</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:243" class="ju-code-link ju-var"><span class="ju-var">cfg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:244" class="ju-code-link ju-var"><span class="ju-var">env</span></a></span><span class="ju-delimiter">}</span>
        <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#stateWithMessages" class="ju-code-link ju-function"><span class="ju-function">stateWithMessages</span></a></span>
        <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:223" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span><span class="ju-delimiter">;</span>
  <span class="ju-keyword">in</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#finalState" class="ju-code-link ju-function"><span class="ju-function">finalState</span></a></span><span class="ju-delimiter">;</span>
<span id="step"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#step" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#step" class="ju-code-link ju-function"><span class="ju-function">
<span class="ju-comment">-- Step function that processes one message and updates network state</span>
step</span></a></span></a></span></span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:247" class="ju-code-link ju-var"><span class="ju-var">selector</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#MessageSelector" class="ju-code-link ju-function"><span class="ju-function">MessageSelector</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:248" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState" class="ju-code-link ju-inductive"><span class="ju-inductive">NetworkState</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Stdlib/Data/Pair/Base-src.html#Pair" class="ju-code-link ju-inductive"><span class="ju-inductive">Pair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState" class="ju-code-link ju-inductive"><span class="ju-inductive">NetworkState</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#Option" class="ju-code-link ju-var"><span class="ju-inductive"><span class="ju-delimiter">(</span>Option</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#EngineMsg" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>EngineMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_message-src.html#Msg" class="ju-code-link ju-inductive"><span class="ju-inductive">Msg</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">let</span>
    <span id="selected"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#selected" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#selected" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Try to select a message using the selector</span>
    selected</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:247" class="ju-code-link ju-var"><span class="ju-var">selector</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState.messages" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>NetworkState<span class="ju-delimiter">.</span>messages</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:248" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">;</span>
  <span class="ju-keyword">in</span> <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#selected" class="ju-code-link ju-function"><span class="ju-function">selected</span></a></span> <span class="ju-keyword">of</span>
       <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor">mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:248" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
       <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:250"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:250" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:250" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span></a></span></span> <span id="arch.node.integration.simulator:251"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:251" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:251" class="ju-code-link ju-var"><span class="ju-var">rest</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
         <span class="ju-keyword">let</span>
           <span id="state&#39;"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#state&#39;" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#state&#39;" class="ju-code-link ju-function"><span class="ju-function">state&#39;</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:248" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span><span class="ju-keyword">@</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState" class="ju-code-link ju-inductive"><span class="ju-inductive">NetworkState</span></a></span><span class="ju-delimiter">{</span>messages <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:251" class="ju-code-link ju-var"><span class="ju-var">rest</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
           <span id="target"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#target" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#target" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Get the target engine ID from the message</span>
           target</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#EngineMsg.target" class="ju-code-link ju-function"><span class="ju-function">EngineMsg<span class="ju-delimiter">.</span>target</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:250" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span><span class="ju-delimiter">;</span>
           <span id="nodeId"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#nodeId" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#nodeId" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Get the node ID and engine name from the target engine ID</span>
           nodeId</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
             <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#target" class="ju-code-link ju-function"><span class="ju-function">target</span></a></span> <span class="ju-keyword">of</span>
               <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor">mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
               <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor">mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>some</span></a></span> <span id="arch.node.integration.simulator:259"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:259" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:259" class="ju-code-link ju-var"><span class="ju-var">nid</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span class="ju-keyword">_</span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:259" class="ju-code-link ju-var"><span class="ju-var">nid</span></a></span><span class="ju-delimiter">;</span>
           <span id="engineName"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#engineName" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#engineName" class="ju-code-link ju-function"><span class="ju-function">engineName</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#snd" class="ju-code-link ju-function"><span class="ju-function">snd</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#target" class="ju-code-link ju-function"><span class="ju-function">target</span></a></span><span class="ju-delimiter">;</span>
           <span id="engine"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#engine" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#engine" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Look up the target engine</span>
           engine</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
             <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#nodeId" class="ju-code-link ju-function"><span class="ju-function">nodeId</span></a></span> <span class="ju-keyword">of</span>
               <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
               <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="arch.node.integration.simulator:262"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:262" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:262" class="ju-code-link ju-var"><span class="ju-var">nid</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                 <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#OMap.lookup" class="ju-code-link ju-function"><span class="ju-function">OMap<span class="ju-delimiter">.</span>lookup</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:262" class="ju-code-link ju-var"><span class="ju-var">nid</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState.nodes" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>NetworkState<span class="ju-delimiter">.</span>nodes</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:248" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">of</span>
                   <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
                   <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="arch.node.integration.simulator:263"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:263" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:263" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#OMap.lookup" class="ju-code-link ju-function"><span class="ju-function">OMap<span class="ju-delimiter">.</span>lookup</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#engineName" class="ju-code-link ju-function"><span class="ju-function">engineName</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#Node.engines" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>Node<span class="ju-delimiter">.</span>engines</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:263" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">;</span>
         <span class="ju-keyword">in</span> <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#engine" class="ju-code-link ju-function"><span class="ju-function">engine</span></a></span> <span class="ju-keyword">of</span>
              <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor">mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#state&#39;" class="ju-code-link ju-function"><span class="ju-function">state&#39;</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
              <span class="ju-comment">-- Target engine not found, remove message and return state</span>
              <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="arch.node.integration.simulator:265"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:265" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:265" class="ju-code-link ju-var"><span class="ju-var">eng</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                <span class="ju-keyword">let</span>
                  <span id="result"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#result" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#result" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Try to evaluate and execute for the engine</span>
                  result</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#evaluateAndExecuteEng" class="ju-code-link ju-function"><span class="ju-function">evaluateAndExecuteEng</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:265" class="ju-code-link ju-var"><span class="ju-var">eng</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:250" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span><span class="ju-delimiter">;</span>
                <span class="ju-keyword">in</span> <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#result" class="ju-code-link ju-function"><span class="ju-function">result</span></a></span> <span class="ju-keyword">of</span>
                     <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor">mkPair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#state&#39;" class="ju-code-link ju-function"><span class="ju-function">state&#39;</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span>
                     <span class="ju-comment">-- No action to execute, remove message and return state</span>
                     <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:267"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:267" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:267" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span></a></span></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:268"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:268" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:268" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span></a></span></span> <span id="arch.node.integration.simulator:269"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:269" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:269" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span></a></span></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
                       <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor">mkPair</span></a></span>
                         <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#updateNetworkState" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>updateNetworkState</span></a></span>
                           <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#state&#39;" class="ju-code-link ju-function"><span class="ju-function">state&#39;</span></a></span>
                           <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#target" class="ju-code-link ju-function"><span class="ju-function">target</span></a></span>
                           <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:269" class="ju-code-link ju-var"><span class="ju-var">newEng</span></a></span>
                           <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:267" class="ju-code-link ju-var"><span class="ju-var">msgs</span></a></span>
                           <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:268" class="ju-code-link ju-var"><span class="ju-var">cfgEnvPairs</span></a></span><span class="ju-delimiter">)</span>
                         <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:250" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">;</span>

<span class="ju-comment">-- Simulate function that runs for a specified number of steps and collects successfully delivered messages</span>
<span class="ju-keyword">terminating</span>
<span id="simulate"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#simulate" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#simulate" class="ju-code-link ju-function"><span class="ju-function">simulate</span></a></span></a></span></span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:270" class="ju-code-link ju-var"><span class="ju-var">selector</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#MessageSelector" class="ju-code-link ju-function"><span class="ju-function">MessageSelector</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:271" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState" class="ju-code-link ju-inductive"><span class="ju-inductive">NetworkState</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:272" class="ju-code-link ju-var"><span class="ju-var">steps</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/Nat/Base-src.html#Nat" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List" class="ju-code-link ju-inductive"><span class="ju-inductive">List</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#EngineMsg" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>EngineMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_message-src.html#Msg" class="ju-code-link ju-inductive"><span class="ju-inductive">Msg</span></a></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:272" class="ju-code-link ju-var"><span class="ju-var">steps</span></a></span> <span class="ju-keyword">of</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/Nat/Base-src.html#Nat.zero" class="ju-code-link ju-constructor"><span class="ju-constructor">zero</span></a></span> <span class="ju-keyword">:=</span> <span class="ju-delimiter">[</span><span class="ju-delimiter">]</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/Nat/Base-src.html#Nat.suc" class="ju-code-link ju-constructor"><span class="ju-constructor">suc</span></a></span> <span id="arch.node.integration.simulator:273"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:273" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:273" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">let</span>
        <span id="nextPair"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#nextPair" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#nextPair" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Apply one step</span>
        nextPair</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#step" class="ju-code-link ju-function"><span class="ju-function">step</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:270" class="ju-code-link ju-var"><span class="ju-var">selector</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:271" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span><span class="ju-delimiter">;</span>
        <span id="newState"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#newState" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#newState" class="ju-code-link ju-function"><span class="ju-function">newState</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#fst" class="ju-code-link ju-function"><span class="ju-function">fst</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#nextPair" class="ju-code-link ju-function"><span class="ju-function">nextPair</span></a></span><span class="ju-delimiter">;</span>
        <span id="processedMsgOpt"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#processedMsgOpt" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#processedMsgOpt" class="ju-code-link ju-function"><span class="ju-function">processedMsgOpt</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#snd" class="ju-code-link ju-function"><span class="ju-function">snd</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#nextPair" class="ju-code-link ju-function"><span class="ju-function">nextPair</span></a></span><span class="ju-delimiter">;</span>
        <span id="restMsgs"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#restMsgs" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#restMsgs" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Recursively simulate remaining steps</span>
        restMsgs</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#simulate" class="ju-code-link ju-function"><span class="ju-function">simulate</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:270" class="ju-code-link ju-var"><span class="ju-var">selector</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#newState" class="ju-code-link ju-function"><span class="ju-function">newState</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:273" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span><span class="ju-delimiter">;</span>
      <span class="ju-keyword">in</span> <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#processedMsgOpt" class="ju-code-link ju-function"><span class="ju-function">processedMsgOpt</span></a></span> <span class="ju-keyword">of</span>
           <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#restMsgs" class="ju-code-link ju-function"><span class="ju-function">restMsgs</span></a></span>
           <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="arch.node.integration.simulator:278"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:278" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:278" class="ju-code-link ju-var"><span class="ju-var">processedMsg</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:278" class="ju-code-link ju-var"><span class="ju-var">processedMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List.::" class="ju-code-link ju-constructor"><span class="ju-constructor">::</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#restMsgs" class="ju-code-link ju-function"><span class="ju-function">restMsgs</span></a></span><span class="ju-delimiter">;</span>

<span class="ju-comment">-- Simulate function that runs for a specified number of steps and collects both</span>
<span class="ju-comment">-- successfully delivered and failed messages.</span>
<span class="ju-keyword">terminating</span>
<span id="simulateWithFailures"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#simulateWithFailures" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#simulateWithFailures" class="ju-code-link ju-function"><span class="ju-function">simulateWithFailures</span></a></span></a></span></span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:279" class="ju-code-link ju-var"><span class="ju-var">selector</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#MessageSelector" class="ju-code-link ju-function"><span class="ju-function">MessageSelector</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:280" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState" class="ju-code-link ju-inductive"><span class="ju-inductive">NetworkState</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-delimiter">(</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:281" class="ju-code-link ju-var"><span class="ju-var">steps</span></a></span> <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/Nat/Base-src.html#Nat" class="ju-code-link ju-inductive"><span class="ju-inductive">Nat</span></a></span><span class="ju-delimiter">)</span>
  <span class="ju-keyword">:</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Stdlib/Data/Pair/Base-src.html#Pair" class="ju-code-link ju-inductive"><span class="ju-inductive">Pair</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>List</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#EngineMsg" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>EngineMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_message-src.html#Msg" class="ju-code-link ju-inductive"><span class="ju-inductive">Msg</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>List</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/messages-src.html#EngineMsg" class="ju-code-link ju-inductive"><span class="ju-inductive"><span class="ju-delimiter">(</span>EngineMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/types/anoma_message-src.html#Msg" class="ju-code-link ju-inductive"><span class="ju-inductive">Msg</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
  <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:281" class="ju-code-link ju-var"><span class="ju-var">steps</span></a></span> <span class="ju-keyword">of</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/Nat/Base-src.html#Nat.zero" class="ju-code-link ju-constructor"><span class="ju-constructor">zero</span></a></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor">mkPair</span></a></span> <span class="ju-delimiter">[</span><span class="ju-delimiter">]</span> <span class="ju-delimiter">[</span><span class="ju-delimiter">]</span>
    <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/Nat/Base-src.html#Nat.suc" class="ju-code-link ju-constructor"><span class="ju-constructor">suc</span></a></span> <span id="arch.node.integration.simulator:282"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:282" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:282" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
      <span class="ju-keyword">let</span>
        <span id="selected"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#selected" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#selected" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Try to select a message using the selector</span>
        selected</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:279" class="ju-code-link ju-var"><span class="ju-var">selector</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState.messages" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-delimiter">(</span>NetworkState<span class="ju-delimiter">.</span>messages</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:280" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span><span class="ju-delimiter">)</span><span class="ju-delimiter">;</span>
      <span class="ju-keyword">in</span> <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#selected" class="ju-code-link ju-function"><span class="ju-function">selected</span></a></span> <span class="ju-keyword">of</span>
           <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span>
             <span class="ju-comment">-- No message selected, continue simulation</span>
             <span class="ju-keyword">let</span>
               <span id="recursiveResult"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#recursiveResult" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#recursiveResult" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Recursively simulate remaining steps</span>
               recursiveResult</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#simulateWithFailures" class="ju-code-link ju-function"><span class="ju-function">simulateWithFailures</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:279" class="ju-code-link ju-var"><span class="ju-var">selector</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:280" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:282" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span><span class="ju-delimiter">;</span>
             <span class="ju-keyword">in</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#recursiveResult" class="ju-code-link ju-function"><span class="ju-function">recursiveResult</span></a></span>
           <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-delimiter">(</span>mkPair</span></a></span> <span id="arch.node.integration.simulator:285"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:285" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:285" class="ju-code-link ju-var"><span class="ju-var">msg</span></a></span></a></span></span> <span id="arch.node.integration.simulator:286"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:286" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:286" class="ju-code-link ju-var"><span class="ju-var">rest</span></a></span></a></span></span><span class="ju-delimiter">)</span> <span class="ju-keyword">:=</span>
             <span class="ju-comment">-- Message selected</span>
             <span class="ju-keyword">let</span>
               <span id="state&#39;"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#state&#39;" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#state&#39;" class="ju-code-link ju-function"><span class="ju-function">state&#39;</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:280" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span><span class="ju-keyword">@</span><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#NetworkState" class="ju-code-link ju-inductive"><span class="ju-inductive">NetworkState</span></a></span><span class="ju-delimiter">{</span>messages <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:286" class="ju-code-link ju-var"><span class="ju-var">rest</span></a></span><span class="ju-delimiter">}</span><span class="ju-delimiter">;</span>
               <span id="nextPair"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#nextPair" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#nextPair" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Apply one step for the selected message</span>
               nextPair</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#step" class="ju-code-link ju-function"><span class="ju-function">step</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:279" class="ju-code-link ju-var"><span class="ju-var">selector</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:280" class="ju-code-link ju-var"><span class="ju-var">state</span></a></span><span class="ju-delimiter">;</span>
               <span id="newState"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#newState" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#newState" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Need to use the original state here for step</span>
               newState</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#fst" class="ju-code-link ju-function"><span class="ju-function">fst</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#nextPair" class="ju-code-link ju-function"><span class="ju-function">nextPair</span></a></span><span class="ju-delimiter">;</span>
               <span id="processedMsgOpt"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#processedMsgOpt" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#processedMsgOpt" class="ju-code-link ju-function"><span class="ju-function">processedMsgOpt</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#snd" class="ju-code-link ju-function"><span class="ju-function">snd</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#nextPair" class="ju-code-link ju-function"><span class="ju-function">nextPair</span></a></span><span class="ju-delimiter">;</span>
               <span id="recursiveResult"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#recursiveResult" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#recursiveResult" class="ju-code-link ju-function"><span class="ju-function"><span class="ju-comment">-- Recursively simulate remaining steps with the new state</span>
               recursiveResult</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#simulateWithFailures" class="ju-code-link ju-function"><span class="ju-function">simulateWithFailures</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:279" class="ju-code-link ju-var"><span class="ju-var">selector</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#newState" class="ju-code-link ju-function"><span class="ju-function">newState</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:282" class="ju-code-link ju-var"><span class="ju-var">n</span></a></span><span class="ju-delimiter">;</span>
               <span id="successMsgs"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#successMsgs" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#successMsgs" class="ju-code-link ju-function"><span class="ju-function">successMsgs</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#fst" class="ju-code-link ju-function"><span class="ju-function">fst</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#recursiveResult" class="ju-code-link ju-function"><span class="ju-function">recursiveResult</span></a></span><span class="ju-delimiter">;</span>
               <span id="failedMsgs"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#failedMsgs" class="ju-code-link ju-function"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#failedMsgs" class="ju-code-link ju-function"><span class="ju-function">failedMsgs</span></a></span></a></span></span> <span class="ju-keyword">:=</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#snd" class="ju-code-link ju-function"><span class="ju-function">snd</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#recursiveResult" class="ju-code-link ju-function"><span class="ju-function">recursiveResult</span></a></span><span class="ju-delimiter">;</span>
             <span class="ju-keyword">in</span> <span class="ju-keyword">case</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#processedMsgOpt" class="ju-code-link ju-function"><span class="ju-function">processedMsgOpt</span></a></span> <span class="ju-keyword">of</span>
                  <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#none" class="ju-code-link ju-var"><span class="ju-constructor">none</span></a></span> <span class="ju-keyword">:=</span>
                    <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-comment">-- Message failed to deliver</span>
                      mkPair</span></a></span>
                      <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#successMsgs" class="ju-code-link ju-function"><span class="ju-function">successMsgs</span></a></span>
                      <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:285" class="ju-code-link ju-var"><span class="ju-var"><span class="ju-delimiter">(</span>msg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List.::" class="ju-code-link ju-constructor"><span class="ju-constructor">::</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#failedMsgs" class="ju-code-link ju-function"><span class="ju-function">failedMsgs</span></a></span><span class="ju-delimiter">)</span>
                  <span class="ju-keyword">|</span> <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#some" class="ju-code-link ju-var"><span class="ju-constructor">some</span></a></span> <span id="arch.node.integration.simulator:299"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:299" class="ju-code-link ju-var"><span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:299" class="ju-code-link ju-var"><span class="ju-var">processedMsg</span></a></span></a></span></span> <span class="ju-keyword">:=</span>
                    <span class="annot"><a href="https://specs.anoma.net/pr-355/prelude-src.html#mkPair" class="ju-code-link ju-var"><span class="ju-constructor"><span class="ju-comment">-- Message delivered successfully</span>
                      mkPair</span></a></span>
                      <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#arch.node.integration.simulator:299" class="ju-code-link ju-var"><span class="ju-var"><span class="ju-delimiter">(</span>processedMsg</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/Juvix/Builtin/V1/List-src.html#List.::" class="ju-code-link ju-constructor"><span class="ju-constructor">::</span></a></span> <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#successMsgs" class="ju-code-link ju-function"><span class="ju-function">successMsgs</span></a></span><span class="ju-delimiter">)</span>
                      <span class="annot"><a href="https://specs.anoma.net/pr-355/arch/node/integration/simulator-src.html#failedMsgs" class="ju-code-link ju-function"><span class="ju-function">failedMsgs</span></a></span><span class="ju-delimiter">;</span>
</pre><footer><pre>Powered by <a href="https://juvix.org">Juvix </a><a href="https://github.com/anoma/juvix/commit/b935467">0.6.10-b935467</a></pre></footer><footer><pre>Last modified on 2025-06-03 6:24 UTC</pre></footer></html>